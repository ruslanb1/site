/*!
* © by Sitsanlis Ilias
* This notice shall be included in all copies or substantial portions of the Software.
* Creative Commons 4.0/CC BY - NC - SA 4.0. 
*/

function round(e,t){return Number(e.toFixed(t))}function fixPeriod(e,t){return e-t*Math.floor(e/t)}function rnd(e,t){return Math.floor(Math.random()*(t-e+1))+e}function toExp(e){for(var t=e.toExponential(1),a=t.indexOf("e"),r=t.substr(0,a),i=t.substr(a+2),n="",s=t.substr(a+1,1),o=0;o<=i.length-1;o++){var c=i.substr(o,1);if("0"==c)return r;n+="1"==c?"¹":"2"==c?"²":"3"==c?"³":String.fromCharCode("0x207"+c)}return r+"·10"+("-"==s?"⁻":"")+n}function sngNumber(e){return e<=0?e.toString():"+"+e.toString()}function makeDragLine(e,t,a){null==e&&(e="#000000"),null==t&&(t="dragPoint"),null==a&&(a=100);var r=new createjs.Shape,i=r.graphics;return i.setStrokeStyle(2),i.beginStroke(e),i.mt(0,0).lt(0,a),i.endStroke(),i.endFill(),r.hitArea=new createjs.Shape,r.hitArea.graphics.setStrokeStyle(2),r.hitArea.graphics.beginStroke("#FFFFFF"),r.hitArea.graphics.beginFill("#FFFFFF"),r.hitArea.graphics.dr(-20,0,40,a),r.hitArea.graphics.endFill(),r.hitArea.graphics.endStroke(),r.hitArea.alpha=.1,r.name=t,r}function makeDragPoint(e,t,a){null==e&&(e="#000000"),null==t&&(t="dragPoint"),null==a&&(a=5);var r=new createjs.Shape,i=r.graphics;return i.setStrokeStyle(1),i.beginStroke(e),i.beginFill(e),i.dc(0,0,a),i.endStroke(),i.endFill(),r.hitArea=new createjs.Shape,r.hitArea.graphics.beginStroke("#FFFFFF"),r.hitArea.graphics.beginFill("#FFFFFF"),r.hitArea.graphics.dc(0,0,20),r.hitArea.graphics.endStroke(),r.hitArea.alpha=.01,r.name=t,r}function makePoint(e,t,a){null==e&&(e="#000000"),null==t&&(t="dragPoint"),null==a&&(a=5);var r=new createjs.Shape,i=r.graphics;return i.setStrokeStyle(1),i.beginStroke(e),i.beginFill(e),i.dc(0,0,a),i.endStroke(),i.endFill(),r.name=t,r}function createVector(e,t,a){null==e&&(e="#000000"),null==t&&(t=!1),null==a&&(a=!1);var r=new createjs.Container,i=new createjs.Shape;i=createLineVector(e),r.addChild(i);var n=new createjs.Shape;if(n=createArrowVector(e),r.addChild(n),t){var s=new createjs.Shape;s=createDragLineVector(),r.addChild(s)}if(a){var o=new createjs.Shape;o=createCircleVector(e),r.addChild(o)}return r}function createLineVector(e){null==e&&(e="#000000");var t=new createjs.Shape,a=t.graphics;return a.setStrokeStyle(2.5),a.beginStroke(e),a.moveTo(0,0),a.lineTo(100,0),a.endStroke(),t}function createDragLineVector(){var e=new createjs.Shape,t=e.graphics;return t.setStrokeStyle(25),t.beginStroke("#ffffff"),t.moveTo(0,0),t.lineTo(100,0),t.endStroke(),e.alpha=.01,e.name="dragLine",e}function createCircleVector(e){null==e&&(e="#000000");var t=new createjs.Shape,a=t.graphics;return a.beginFill("#000000"),a.dc(0,0,3),t.name="startVector",t}function createArrowVector(e){null==e&&(e="#000000");var t=new createjs.Shape,a=t.graphics;return a.setStrokeStyle(1.5,"round","round"),a.beginStroke(e),a.beginFill(e),a.moveTo(0,0),a.lineTo(8*Math.cos(155*toRad),-8*Math.sin(155*toRad)),a.lineTo(-5.5,0),a.lineTo(8*Math.cos(205*toRad),-8*Math.sin(205*toRad)),a.closePath(),a.endFill(),a.endStroke(),t}function updateTextVector(e,t,a,r){var i=t.rotation;arrowVec=t.getChildAt(1),(n=arrowVec.x)<0&&(n=Math.abs(n),i+=180);var n,s=(n=Math.abs(n))*Math.cos(i*toRad),o=n*Math.sin(i*toRad),c=t.x+s+a*Math.cos(i*toRad)+r*Math.cos((i+90)*toRad),h=t.y+o+a*Math.sin(i*toRad)+r*Math.sin((i+90)*toRad);e.x=c,e.y=h,e.textBaseline="alphabetic",e.textAlign="center",Math.abs(n)<5?e.alpha=0:e.alpha=1}function mouseDownVector(e){var t=canvas.width,a=canvas.height;e.target.pos={x:e.target.x,y:e.target.y},e.target.offset={x:e.target.x-e.stageX*(720/t),y:e.target.y-e.stageY*(420/a)},e.target.addEventListener("pressmove",pressMoveVector)}function pressMoveVector(e){var t=canvas.width,a=canvas.height,r=e.stageX*(720/t)+e.target.offset.x,i=e.stageY*(420/a)+e.target.offset.y;e.target.x=r,e.target.y=i,updateTextVector(p1Text,p1Vec,10,0),updateTextVector(p2Text,p2Vec,10,0),stage.update()}function pressUpVector(e){e.target.x=e.target.pos.x,e.target.y=e.target.pos.y,updateTextVector(p1Text,p1Vec,10,0),updateTextVector(p2Text,p2Vec,10,0),stage.update(),e.target.removeEventListener("pressmove",pressMoveVector)}createjs.Container.prototype.setScaleX=function(e){var t,a=this.getChildAt(0),r=this.getChildAt(1),i=this.getChildByName("dragLine");this.getChildByName("startVector");t=(r.x=e)<0?-1:1,25<=Math.abs(e)?(r.scaleX=t,a.scaleX=(e-t)/100,null!=i&&(i.scaleX=(e-t)/100)):(r.scaleX=4*e/100,a.scaleX=e/100-4*e/100/100,null!=i&&(i.scaleX=e/100-4*e/100/100))};var shifted=!(createjs.Shape.prototype.drawDistance=function(e,t,a,r,i,n){null==e&&(e="#000000");var s=this.graphics;s.clear();var o=Math.sqrt((r-t)*(r-t)+(i-a)*(i-a)),c=Math.atan2(-(i-a),r-t);if(2<o){var h=8*(25<o?1:4*o/100);s.setStrokeStyle(1,"round","round"),s.beginStroke(e),s.mt(h*Math.cos(25*toRad),-h*Math.sin(25*toRad)).lt(0,0).lt(h*Math.cos(25*toRad),h*Math.sin(25*toRad)),s.mt(0,0).lt(o,0).lt(o+h*Math.cos(155*toRad),-h*Math.sin(155*toRad)).mt(o,0).lt(o+h*Math.cos(205*toRad),-h*Math.sin(205*toRad)),s.setStrokeStyle(1),s.setStrokeDash([2,2],2),s.beginStroke(e),s.mt(0,n/2).lt(0,-n/2),s.mt(o,n/2).lt(o,-n/2),s.endStroke(),s.beginFill("#FFFFFF"),s.dr(o/2-20,-6,40,12),this.rotation=-c*toDeg,this.regX=n*Math.cos(Math.PI/2),this.regY=-n*Math.sin(Math.PI/2),this.x=t,this.y=a}});function drawGround(){var e=ground.graphics;e.clear();for(ground.y=Y0,e.setStrokeStyle(1),e.beginStroke("#ccc"),i=0;i<=720;i+=10)e.mt(i,0).lt(i-15*.707,15*.707);e.setStrokeStyle(2),e.beginStroke("#ccc"),e.mt(0,0).lt(720,0),ground.hitArea=new createjs.Shape,ground.hitArea.graphics.f("#FFF").dr(0,0,720,12)}function drawRuler(e){ruler.removeAllChildren();var t=e*xScale,a=xScale/10,r=new createjs.Shape;r.graphics.ss(1).f("#FFFFCC").dr(0,0,t,25).s("#999").mt(0,0).lt(t,0).mt(0,25).lt(t,25),ruler.addChild(r);for(var i=a;i<=t;i+=a)i%(5*a)!=0&&r.graphics.ss(1).s("#666").mt(i,0).lt(i,3).mt(i,25).lt(i,22);for(i=0;i<=t;i+=5*a)i%xScale!=0&&r.graphics.ss(1).s("#666").mt(i,0).lt(i,4.5).mt(i,25).lt(i,20.5);for(i=0;i<=t;i+=xScale)r.graphics.ss(1.5).s("#666").mt(i,0).lt(i,6).mt(i,25).lt(i,19);for(i=0;i<=t;i+=xScale){var n=new createjs.Text((i/xScale).toFixed(0)+(i==t?"m":""),"10px Trebuchet MS ","#333");n.set({x:i,y:8,textAlign:"center"}),ruler.addChild(n)}r.name="shape";for(i=0;i<=1;i++){var s=new createjs.Shape;s.hitArea=new createjs.Shape,s.hitArea.graphics.f("#CCC").dc(0,0,25),s.set({x:i*t,y:10,name:"rotator"}),ruler.addChild(s)}}$(document).on("keyup keydown",function(e){shifted=e.shiftKey}),createjs.Container.prototype.slider=function(s){var e=new createjs.Shape,a=e.graphics;this.addChild(e);canvas.width,canvas.height;a.setStrokeStyle(1),a.beginStroke("#aaa");for(var r=s/12,i=0;i<=12;i++)a.mt(i*r,-2).lt(i*r,-6);a.beginFill("#eee"),a.r(0,-2,s,4),a.endFill(),e.hitArea=new createjs.Shape,e.hitArea.graphics.beginStroke("#FFFFFF"),e.hitArea.graphics.beginFill("#FFFFFF"),e.hitArea.graphics.r(0,-10,s,20),e.hitArea.graphics.endStroke(),e.hitArea.alpha=.01;var n=new createjs.Shape;this.addChild(n),(a=n.graphics).setStrokeStyle(1),a.beginStroke("#aaa"),a.beginFill("#eee"),a.r(-4,-4,8,8),n.hitArea=new createjs.Shape,n.hitArea.graphics.beginStroke("#FFFFFF"),n.hitArea.graphics.beginFill("#FFFFFF"),n.hitArea.graphics.dc(0,0,20),n.hitArea.graphics.endStroke(),n.hitArea.alpha=.01;for(i=0;i<=4;i++){if(0==i)var o=new createjs.Text("0","10px Trebuchet MS","#666666");else if(1==i)o=new createjs.Text("T/4","10px Trebuchet MS","#666666");else if(2==i)o=new createjs.Text("T/2","10px Trebuchet MS","#666666");else if(3==i)o=new createjs.Text("3T/4","10px Trebuchet MS","#666666");else if(4==i)o=new createjs.Text("T","10px Trebuchet MS","#666666");o.set({textAlign:"center"}),o.x=i*s/4,o.y=-18,this.addChild(o)}function c(e){var a=canvas.width,r=canvas.height,i=e.stageX*(720/a)+e.target.offset.x;e.stageY,e.target.offset.y;i<0&&(i=0),s<i&&(i=s),t=T*(e.target.kT+i/s),calculations(),positions()}e.on("click",function(e){if(!isNaN(T)&&isFinite(T)){var a=canvas.width,r=Math.floor(t/T);t=T*(r+(e.stageX*(720/a)-160)/s);var i=T/12,n=t-T*r;Math.abs(n-i*Math.round(n/i))<=.05&&(t=T*r+Math.round(n/i)*i),calculations(),positions()}}),n.on("mousedown",function(e){if(!isNaN(T)&&isFinite(T)){var a=canvas.width,r=canvas.height;e.target.offset={x:e.target.x-e.stageX*(720/a),y:e.target.y-e.stageY*(420/r)},e.target.addEventListener("pressmove",c),e.target.kT=Math.floor(t/T)}}),n.on("pressup",function(e){if(!isNaN(T)&&isFinite(T)){if(e.target.x==s&&(e.target.x=0),!shifted){var a=T/12,r=t-T*e.target.kT,i=Math.abs(r-a*Math.round(r/a));Math.abs(t-T*Math.round(t/T))<1e-10?t=T*Math.round(t/T)+1e-10:i<=a/2&&(t=a*Math.round(t/a))}calculations(),positions(),e.target.removeEventListener("pressmove",c)}})},createjs.Shape.prototype.addArrow=function(e,t,a,r){var i=this.graphics;i.ss(1),i.s(e),i.mt(t,a).lt(t+8*Math.cos((155+r)*toRad),a-8*Math.sin((155+r)*toRad)).mt(t,a).lt(t+8*Math.cos((205+r)*toRad),a-8*Math.sin((205+r)*toRad))};