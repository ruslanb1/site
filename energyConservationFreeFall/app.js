/*!
* © by Sitsanlis Ilias
* This notice shall be included in all copies or substantial portions of the Software.
* Creative Commons 4.0/CC BY - NC - SA 4.0. 
*/

helpText.text = "Εφαρμογή με την οποία μπορούμε να μελετήσουμε την διατήρηση της ενέργειας κατά την ελεύθερη πτώση ενός σώματος. Μπορούμε να σύρουμε το σώμα και το διάνυσμα της ταχύτητας για να αλλάξουμε την θέση και την ταχύτητα του σώματος. Μπορούμε να επαναλάβουμε το πείραμα στην Γη και στην Σελήνη με ή χωρίς τριβές."

var canvas,stage,self,controlBoxContainer,marginVarNumber=140,marginVar=marginVarNumber,PI=Math.PI,toDeg=180/PI,toRad=PI/180,X0=230,Y0=350,t=0,dt=1/60,dtInitial=dt,dtSlow=dt,factor=.5,playMovie=!1,framePlay=!1,xScale=50,yScale=-xScale,vScale=8,FScale=5,vectorScale=1,valuesText=new createjs.Text("","12px Trebuchet MS");valuesText.set({x:360,y:375,textAlign:"center"});var KTextScale=new createjs.Text("","12px Trebuchet MS");KTextScale.set({x:12.5,y:375,rotation:-90});var UTextScale=new createjs.Text("","12px Trebuchet MS");UTextScale.set({x:42.5,y:375,rotation:-90});var QTextScale=new createjs.Text("","12px Trebuchet MS");QTextScale.set({x:102.5,y:375,rotation:-90});var ball=ballShape();ball.name="ball",ball.addEventListener("mousedown",mouseDownGen),ball.addEventListener("pressup",pressUpGen),ball.mouseChildren=!1,ball.set({x:X0,y:Y0});var X,Y,x,y,v,K,U,E,Ei,Q,vText_mc=vVecTextShape(),wText=wVecTextShape(),gText=gVecTextShape(),TText=TVecTextShape(),KText=KTextShape(),UText=UTextShape(),EText=ETextShape(),QText=QTextShape(),yText=yTextShape(),yGraphText=yTextShape(),ESCALE=.0375,g=10,yi=5,vi=0,Yg=350,yg=toy(Yg),b=0,m=1,ε=1,E2_mc=new createjs.Shape,E3_mc=new createjs.Shape,E4_mc=new createjs.Shape,E5_mc=new createjs.Shape,KBox_mc=new createjs.Shape,UBox_mc=new createjs.Shape,EBox_mc=new createjs.Shape,ground=new createjs.Shape;vVec=createVector("#0000FF",!0,!1),vVec.rotation=-90,vVec.x=X0+20,vVec.y=ball.y-20,vVec.name="vVec",vVec.addEventListener("mousedown",mouseDownVector),vVec.addEventListener("pressup",pressUpVector),vVec.mouseChildren=!1,wVec=createVector("#008000",!0,!0),wVec.rotation=90,wVec.x=X0,wVec.y=ball.y-20;var TVec=createVector("#800000",!1,!1);TVec.rotation=-90,TVec.x=X0,TVec.y=ball.y-20,gVec=createVector("#990066",!1,!1),gVec.rotation=90,gVec.x=X0-20,gVec.y=ball.y-60,gVec.name="gVec";var ruler=new createjs.Container;ruler.set({x:X0+65,y:Yg-3*xScale,rotation:-90,alpha:.85,visible:!0}),ruler.name="ruler",ruler.addEventListener("mousedown",mouseDownRuler),ruler.addEventListener("pressup",pressUpRuler);var yAxis=new createjs.Container;yAxis.addEventListener("mousedown",mouseDownGen),yAxis.addEventListener("pressup",pressUpGen),yAxis.mouseChildren=!1,yAxis.set({x:X0-50,visible:!1,name:"yAxis"}),yText.set({x:X0-50+10,y:32,visible:!1,name:"yAxis"});var ballPoint=makePoint("#000","point",2);ballPoint.visible=yAxis.visible;var firstColitionFlag=!1,graphContainer=new createjs.Container;graphContainer.visible=!0;var barsContainer=new createjs.Container;barsContainer.visible=!0;var Hpx=122.5,Lpx=240,XG=410,YG=195,Yx=YG+(Hpx-16),DYMin=YG+Hpx-Yx,DYMax=2*Hpx-DYMin,xAxisGraph=new createjs.Container;xAxisGraph.set({x:XG,y:Yx});var energyAxisGraph=new createjs.Container;energyAxisGraph.set({x:XG,y:Yx});var KPlot=new createjs.Shape;KPlot.set({x:XG,y:Yx});var UPlot=new createjs.Shape;UPlot.set({x:XG,y:Yx});var EPlot=new createjs.Shape;EPlot.set({x:XG,y:Yx});var xSCALE=40,energySCALE=-3.8,gridFlag=!0,UPoint=makePoint("#000","Upoint",2),KPoint=makePoint("#000","Upoint",2),EPoint=makePoint("#000","Upoint",2),energyShapeMask=new createjs.Shape;energyShapeMask.graphics.drawRect(XG-15,YG-Hpx-3,Lpx+15+3,2*Hpx+12),KPlot.mask=energyShapeMask,UPlot.mask=energyShapeMask,EPlot.mask=energyShapeMask,KPoint.mask=energyShapeMask,UPoint.mask=energyShapeMask,EPoint.mask=energyShapeMask;var xShapeMask=new createjs.Shape;xShapeMask.graphics.drawRect(XG-5,YG-Hpx,Lpx+50,2*Hpx),xAxisGraph.mask=xShapeMask;var UGraphText=UGraphTextShape(),KGraphText=KGraphTextShape(),EGraphText=EGraphTextShape();function init(){stage=new createjs.Stage(document.getElementById("demoCanvas")),createjs.Touch.enable(stage),stage.enableMouseOver(),stage.enableDOMEvents(!0),canvas=document.getElementById("demoCanvas"),self=stage,controlBoxContainer=new createjs.Container,self.addChild(controlBoxContainer);var e=new createjs.DOMElement("foo");controlBoxContainer.addChild(e),controlBoxContainer.x=2.5,controlBoxContainer.y=2.5,stage.addChild(ground),stage.addChild(yAxis),stage.addChild(yText),stage.addChild(ruler),stage.addChild(ball),stage.addChild(vVec),stage.addChild(wVec),stage.addChild(TVec),stage.addChild(gVec),stage.addChild(vText_mc),stage.addChild(wText),stage.addChild(TText),stage.addChild(gText),barsContainer.addChild(KBox_mc),barsContainer.addChild(E2_mc),barsContainer.addChild(UBox_mc),barsContainer.addChild(E3_mc),barsContainer.addChild(EBox_mc),barsContainer.addChild(E4_mc),barsContainer.addChild(E5_mc),barsContainer.addChild(KTextScale),barsContainer.addChild(UTextScale),barsContainer.addChild(QTextScale),barsContainer.addChild(KText),barsContainer.addChild(UText),barsContainer.addChild(EText),barsContainer.addChild(QText),stage.addChild(ballPoint),stage.addChild(barsContainer),stage.addChild(graphContainer),graphContainer.addChild(xAxisGraph),graphContainer.addChild(energyAxisGraph),graphContainer.addChild(energyShapeMask),graphContainer.addChild(KPlot),graphContainer.addChild(UPlot),graphContainer.addChild(EPlot),graphContainer.addChild(KPoint),graphContainer.addChild(UPoint),graphContainer.addChild(EPoint),graphContainer.addChild(UGraphText),graphContainer.addChild(KGraphText),graphContainer.addChild(EGraphText),graphContainer.addChild(yGraphText),stage.addChild(valuesText),createRegister(),stage.addChild(Ψ),addFunction(),showHideVariables(),handleComplete(),initialize(),createjs.Ticker.timingMode=createjs.Ticker.RAF,createjs.Ticker.addEventListener("tick",tick),canvas.style.visibility="visible",document.getElementById("variables").style.visibility="visible"}function initialize(){UGraphText.set({x:XG-25,y:47,visible:!0}),KGraphText.set({x:XG+25,y:47,visible:!0}),EGraphText.set({x:XG,y:47,visible:!0}),yGraphText.set({x:XG+Lpx+20,y:Yx}),drawAllGraphs(),yAxis.yMainAxisCreate((Yg-Y0)/yScale,(40-Y0)/yScale,yScale),TVec.visible=TText.visible=wVec.visible=wText.visible=gVec.visible=gText.visible=vVec.visible=vText_mc.visible=!1,KText.set({x:18,y:Yg-15}),UText.set({x:48,y:Yg-15}),EText.set({x:78,y:Yg-14}),QText.set({x:108,y:Yg-14.5}),drawGraoud(),drawRuler(6,xScale);var e=30;drawBox(KBox_mc,"#ddd"),drawBox(E2_mc,"#0000ff"),drawBox(UBox_mc,"#ddd"),drawBox(E3_mc,"#ff0000"),drawBox(EBox_mc,"#ddd"),drawBox(E4_mc,"#FF9900"),drawBox(E5_mc,"#666"),KBox_mc.set({x:18,y:Yg-e,rotation:180}),E2_mc.set({x:18,y:Yg-e,rotation:180}),UBox_mc.set({x:48,y:Yg-e,rotation:180}),E3_mc.set({x:48,y:Yg-e,rotation:180}),EBox_mc.set({x:78,y:Yg-e,rotation:180}),E4_mc.set({x:78,y:Yg-e,rotation:180}),E5_mc.set({x:108,y:Yg-e,rotation:180}),restart()}function restart(){isOk||stage.removeAllChildren(),firstColitionFlag=!1,t=0,v=vi,y=yi,wVec.setScaleX(m*g*FScale*vectorScale),gVec.setScaleX(g*FScale*vectorScale),KPlot.graphics.clear().ss(2,"round","round").s("#0000ff").mt(y*xSCALE,.5*m*v*v*energySCALE),UPlot.graphics.clear().ss(2,"round","round").s("#FF0000").mt(y*xSCALE,m*g*(y-yg)*energySCALE),EPlot.graphics.clear().ss(2,"round","round").s("#ff9900").mt(y*xSCALE,(.5*m*v*v+m*g*(y-yg))*energySCALE),initializeEnergy(),positions()}function tick(e){if(playMovie){if(framePlay=framePlay&&(playMovie=!1),0<=t+dt&&t<=20){var a=v,r=y,i=t;if(calculations(),t+=dt,y<yg&&v<0&&0<dt){var n=dt,s=0;do{y=r,v=a,t-=dt,dt/=2;do{if(r=y,a=v,calculations(),t+=dt,50<=++s)break}while(yg<y);if(50<=s)break}while(1e-6<Math.abs(y-yg));dt=n;var l=.5*m*v*v,o=m*g*((y=yg)-yg);KPlot.graphics.lt(y*xSCALE,l*energySCALE),EPlot.graphics.lt(y*xSCALE,(l+o)*energySCALE),v*=-ε,firstColitionFlag=!0}}Math.abs(y-yg)<.005&&Math.abs(v)<.5&&0<dt&&(v=0),y<yg&&dt<0&&(y=r,v=a,t=i),positions()}}function positions(){Y=Y0+y*yScale,ball.y=Y,ballPoint.x=yAxis.x,ballPoint.y=Y,vVec.y=Y+v*vScale*vectorScale/2-15,vVec.x=ball.x+20,vVec.setScaleX(v*vScale*vectorScale),updateTextVector(vText_mc,vVec,12,0),wVec.x=ball.x,wVec.y=ball.y-15,updateTextVector(wText,wVec,10,0),gVec.x=ball.x-20,gVec.y=Y-g*FScale*vectorScale/2-15,updateTextVector(gText,gVec,12,0),TVec.x=ball.x,TVec.setScaleX(-b*v*FScale*vectorScale),TVec.y=ball.y-15,updateTextVector(TText,TVec,10,0);var e=.5*m*v*v,a=m*g*(y-yg);E2_mc.scaleY=e*ESCALE,E3_mc.scaleY=a*ESCALE,E4_mc.scaleY=(e+a)*ESCALE,E5_mc.scaleY=Math.abs(Ei-e-a)*ESCALE,ruler.visible&&!yAxis.visible?valuesText.text="t = "+t.toFixed(2)+" s, υ = "+v.toFixed(1)+" m/s":(valuesText.text="t = "+t.toFixed(2)+" s,  y = "+y.toFixed(2)+" m,  υ = "+v.toFixed(2)+" m/s",valuesText.text+=", K = "+round(e,1).toFixed(1)+" J,  U = "+round(a,1).toFixed(1)+" J,  E = "+round(e+a,1).toFixed(1)+" J,  Eαπ = "+round(Ei-e-a,1).toFixed(1)+" J"),KTextScale.text=(100*e/Ei).toFixed(0)+" %",UTextScale.text=(100*a/Ei).toFixed(0)+" %";var r=Math.round(100*Math.abs(Ei-e-a)/Ei);QTextScale.text=r.toFixed(0)+" %",QText.visible=QTextScale.visible=0!=r,KPoint.set({x:XG+y*xSCALE,y:Yx+e*energySCALE}),UPoint.set({x:XG+y*xSCALE,y:Yx+a*energySCALE}),EPoint.set({x:XG+y*xSCALE,y:Yx+(e+a)*energySCALE}),0==b&&1==ε&&1==firstColitionFlag?(KPlot.graphics.mt(y*xSCALE,e*energySCALE),UPlot.graphics.mt(y*xSCALE,a*energySCALE),EPlot.graphics.mt(y*xSCALE,(e+a)*energySCALE)):(KPlot.graphics.lt(y*xSCALE,e*energySCALE),UPlot.graphics.lt(y*xSCALE,a*energySCALE),EPlot.graphics.lt(y*xSCALE,(e+a)*energySCALE)),stage.update()}function drawBox(e,a){e.graphics.clear().f(a).dr(-10,0,20,100)}function drawAllGraphs(){xEnd=Lpx/xSCALE,xAxisGraph.tAxisCreate(Lpx/xSCALE,xSCALE),energyAxisGraph.yAxisCreate(DYMin/energySCALE,-DYMax/energySCALE,energySCALE)}