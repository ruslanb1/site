
function round(e,t){return Number(e.toFixed(t))}function rnd(e,t){return Math.floor(Math.random()*(t-e+1))+e}function toExp(e){for(var t=e.toExponential(1),a=t.indexOf("e"),r=t.substr(0,a),n=t.substr(a+2),i="",o=t.substr(a+1,1),s=0;s<=n.length-1;s++){var h=n.substr(s,1);if("0"==h)return r;i+="1"==h?"¹":"2"==h?"²":"3"==h?"³":String.fromCharCode("0x207"+h)}return r+"·10"+("-"==o?"⁻":"")+i}function sngNumber(e){return e<=0?e.toString():"+"+e.toString()}function makeDragLine(e,t,a){null==e&&(e="#000000"),null==t&&(t="dragPoint"),null==a&&(a=100);var r=new createjs.Shape,n=r.graphics;return n.setStrokeStyle(2),n.beginStroke(e),n.mt(0,0).lt(0,a),n.endStroke(),n.endFill(),r.hitArea=new createjs.Shape,r.hitArea.graphics.setStrokeStyle(2),r.hitArea.graphics.beginStroke("#FFFFFF"),r.hitArea.graphics.beginFill("#FFFFFF"),r.hitArea.graphics.dr(-20,0,40,a),r.hitArea.graphics.endFill(),r.hitArea.graphics.endStroke(),r.hitArea.alpha=.1,r.name=t,r}function makeDragPoint(e,t,a){null==e&&(e="#000000"),null==t&&(t="dragPoint"),null==a&&(a=5);var r=new createjs.Shape,n=r.graphics;return n.setStrokeStyle(1),n.beginStroke(e),n.beginFill(e),n.dc(0,0,a),n.endStroke(),n.endFill(),r.hitArea=new createjs.Shape,r.hitArea.graphics.beginStroke("#FFFFFF"),r.hitArea.graphics.beginFill("#FFFFFF"),r.hitArea.graphics.dc(0,0,10),r.hitArea.graphics.endStroke(),r.hitArea.alpha=.01,r.name=t,r}function makePoint(e,t,a){null==e&&(e="#000000"),null==t&&(t="dragPoint"),null==a&&(a=5);var r=new createjs.Shape,n=r.graphics;return n.setStrokeStyle(1),n.beginStroke(e),n.beginFill(e),n.dc(0,0,a),n.endStroke(),n.endFill(),r.name=t,r}function createVector(e,t,a){null==e&&(e="#000000"),null==t&&(t=!1),null==a&&(a=!1);var r=new createjs.Container,n=new createjs.Shape;n=createLineVector(e),r.addChild(n);var i=new createjs.Shape;if(i=createArrowVector(e),r.addChild(i),t){var o=new createjs.Shape;o=createDragLineVector(),r.addChild(o)}if(a){var s=new createjs.Shape;s=createCircleVector(e),r.addChild(s)}return r}function createLineVector(e){null==e&&(e="#000000");var t=new createjs.Shape,a=t.graphics;return a.setStrokeStyle(2.5),a.beginStroke(e),a.moveTo(0,0),a.lineTo(100,0),a.endStroke(),t}function createDragLineVector(){var e=new createjs.Shape,t=e.graphics;return t.setStrokeStyle(25),t.beginStroke("#ffffff"),t.moveTo(0,0),t.lineTo(100,0),t.endStroke(),e.alpha=.01,e.name="dragLine",e}function createCircleVector(e){null==e&&(e="#000000");var t=new createjs.Shape,a=t.graphics;return a.beginFill("#000000"),a.dc(0,0,3),t.name="startVector",t}function createArrowVector(e){null==e&&(e="#000000");var t=new createjs.Shape,a=t.graphics;return a.setStrokeStyle(1.5,"round","round"),a.beginStroke(e),a.beginFill(e),a.moveTo(0,0),a.lineTo(8*Math.cos(155*toRad),-8*Math.sin(155*toRad)),a.lineTo(-5.5,0),a.lineTo(8*Math.cos(205*toRad),-8*Math.sin(205*toRad)),a.closePath(),a.endFill(),a.endStroke(),t}function updateTextVector(e,t,a,r){var n=t.rotation;arrowVec=t.getChildAt(1),(i=arrowVec.x)<0&&(i=Math.abs(i),n+=180);var i,o=(i=Math.abs(i))*Math.cos(n*toRad),s=i*Math.sin(n*toRad),h=t.x+o+a*Math.cos(n*toRad)+r*Math.cos((n+90)*toRad),c=t.y+s+a*Math.sin(n*toRad)+r*Math.sin((n+90)*toRad);e.x=h,e.y=c,e.textBaseline="alphabetic",e.textAlign="center",Math.abs(i)<5?e.alpha=0:e.alpha=1}function mouseDownVector(e){var t=canvas.width,a=canvas.height;e.target.offset={x:e.target.x-e.stageX*(720/t),y:e.target.y-e.stageY*(420/a)},e.target.addEventListener("pressmove",pressMoveVector)}function pressMoveVector(e){var t=canvas.width,a=canvas.height,r=e.stageX*(720/t)+e.target.offset.x,n=e.stageY*(420/a)+e.target.offset.y;e.target.x=r,e.target.y=n,stage.update()}function pressUpVector(e){e.target.removeEventListener("pressmove",pressMoveVector)}function fixPeriod(e,t){return e-t*Math.floor(e/t)}createjs.Container.prototype.setScaleX=function(e){var t,a=this.getChildAt(0),r=this.getChildAt(1),n=this.getChildByName("dragLine");this.getChildByName("startVector");t=(r.x=e)<0?-1:1,25<=Math.abs(e)?(r.scaleX=t,a.scaleX=(e-t)/100,null!=n&&(n.scaleX=(e-t)/100)):(r.scaleX=4*e/100,a.scaleX=e/100-4*e/100/100,null!=n&&(n.scaleX=e/100-4*e/100/100))};var shifted=!(createjs.Shape.prototype.drawDistance=function(e,t,a,r,n,i){null==e&&(e="#000000");var o=this.graphics;o.clear();var s=Math.sqrt((r-t)*(r-t)+(n-a)*(n-a)),h=Math.atan2(-(n-a),r-t);if(2<s){var c=8*(25<s?1:4*s/100);o.setStrokeStyle(1,"round","round"),o.beginStroke(e),o.mt(c*Math.cos(25*toRad),-c*Math.sin(25*toRad)).lt(0,0).lt(c*Math.cos(25*toRad),c*Math.sin(25*toRad)),o.mt(0,0).lt(s,0).lt(s+c*Math.cos(155*toRad),-c*Math.sin(155*toRad)).mt(s,0).lt(s+c*Math.cos(205*toRad),-c*Math.sin(205*toRad)),o.setStrokeStyle(1),o.setStrokeDash([2,2],2),o.beginStroke(e),o.mt(0,i/2).lt(0,-i/2),o.mt(s,i/2).lt(s,-i/2),o.endStroke(),o.beginFill("#FFFFFF"),o.dr(s/2-20,-6,40,12),this.rotation=-h*toDeg,this.regX=i*Math.cos(Math.PI/2),this.regY=-i*Math.sin(Math.PI/2),this.x=t,this.y=a}});$(document).on("keyup keydown",function(e){shifted=e.shiftKey}),createjs.Container.prototype.slider=function(o){var e=new createjs.Shape,a=e.graphics;this.addChild(e);canvas.width,canvas.height;a.setStrokeStyle(1),a.beginStroke("#aaa");for(var r=o/12,n=0;n<=12;n++)a.mt(n*r,-2).lt(n*r,-6);a.beginFill("#eee"),a.r(0,-2,o,4),a.endFill(),e.hitArea=new createjs.Shape,e.hitArea.graphics.beginStroke("#FFFFFF"),e.hitArea.graphics.beginFill("#FFFFFF"),e.hitArea.graphics.r(0,-10,o,20),e.hitArea.graphics.endStroke(),e.hitArea.alpha=.01;var i=new createjs.Shape;this.addChild(i),(a=i.graphics).setStrokeStyle(1),a.beginStroke("#aaa"),a.beginFill("#eee"),a.r(-4,-4,8,8),i.hitArea=new createjs.Shape,i.hitArea.graphics.beginStroke("#FFFFFF"),i.hitArea.graphics.beginFill("#FFFFFF"),i.hitArea.graphics.dc(0,0,20),i.hitArea.graphics.endStroke(),i.hitArea.alpha=.01;for(n=0;n<=4;n++){if(0==n)var s=new createjs.Text("0","10px Trebuchet MS","#666666");else if(1==n)s=new createjs.Text("T/4","10px Trebuchet MS","#666666");else if(2==n)s=new createjs.Text("T/2","10px Trebuchet MS","#666666");else if(3==n)s=new createjs.Text("3T/4","10px Trebuchet MS","#666666");else if(4==n)s=new createjs.Text("T","10px Trebuchet MS","#666666");s.set({textAlign:"center"}),s.x=n*o/4,s.y=-18,this.addChild(s)}function h(e){var a=canvas.width,r=canvas.height,n=e.stageX*(720/a)+e.target.offset.x;e.stageY,e.target.offset.y;n<0&&(n=0),o<n&&(n=o),t=T*(e.target.kT+n/o),calculations(),positions()}e.on("click",function(e){if(!isNaN(T)&&isFinite(T)){var a=canvas.width,r=Math.floor(t/T);t=T*(r+(e.stageX*(720/a)-160)/o);var n=T/12,i=t-T*r;Math.abs(i-n*Math.round(i/n))<=.05&&(t=T*r+Math.round(i/n)*n),calculations(),positions()}}),i.on("mousedown",function(e){if(!isNaN(T)&&isFinite(T)){var a=canvas.width,r=canvas.height;e.target.offset={x:e.target.x-e.stageX*(720/a),y:e.target.y-e.stageY*(420/r)},e.target.addEventListener("pressmove",h),e.target.kT=Math.floor(t/T)}}),i.on("pressup",function(e){if(!isNaN(T)&&isFinite(T)){if(e.target.x==o&&(e.target.x=0),!shifted){var a=T/12,r=t-T*e.target.kT,n=Math.abs(r-a*Math.round(r/a));Math.abs(t-T*Math.round(t/T))<1e-10?t=T*Math.round(t/T)+1e-10:n<=a/2&&(t=a*Math.round(t/a))}calculations(),positions(),e.target.removeEventListener("pressmove",h)}})},createjs.Shape.prototype.addArrow=function(e,t,a,r){var n=this.graphics;n.ss(1),n.s(e).f(e),n.mt(t,a).lt(t+6*Math.cos((160+r)*toRad),a-6*Math.sin((160+r)*toRad)).lt(t+6*Math.cos((200+r)*toRad),a-6*Math.sin((200+r)*toRad)).cp()};