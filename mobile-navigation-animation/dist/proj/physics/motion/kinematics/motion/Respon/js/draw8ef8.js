/*! For license information please see draw.js.LICENSE.txt */
(function(){var __webpack_modules__={215:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{$:function(){return $},F6:function(){return inRad},Io:function(){return listenerMoveUp},ON:function(){return dialogWindow},Sz:function(){return fixCoords},ZY:function(){return radToDeg},_M:function(){return removePointerEvent},aM:function(){return addPointerEvent},dQ:function(){return eventDelegation},hj:function(){return ajax},r7:function(){return getCoords},sT:function(){return clickDelegation},sZ:function(){return getRandom}});var _babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(687),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);function $(t){-1===["complete","loaded","interactive"].indexOf(document.readyState)?document.addEventListener("DOMContentLoaded",t):setTimeout((function(){t()}),0)}function ajax(t){var e=t.method||"POST",i=t.type_response||"text",r="object"===(0,_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_1__.Z)(t.data)?serialize(t.data):t.data,a=new XMLHttpRequest;return a.open(e,t.url,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.send(r),a.onreadystatechange=function(){if(4==a.readyState){if(200==a.status)if("json"===i)try{t.complete(JSON.parse(a.responseText))}catch(e){t.error&&t.error(e.message)}else t.complete(a.responseText);else 0==a.status?t.abort&&t.abort():t.error&&t.error(a.statusText);t.always&&t.always()}},a}function postData(t){return _postData.apply(this,arguments)}function _postData(){return(_postData=_asyncToGenerator(_regeneratorRuntime.mark((function t(e){var i,r,a,n;return _regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.url,r=e.data,a=objToFormData(r),t.next=4,fetch(i,{method:"POST",mode:"same-origin",cache:"no-cache",credentials:"same-origin",headers:{},body:a});case 4:return n=t.sent,t.next=7,n.json();case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function objToFormData(t){var e=new FormData;return Object.keys(t).forEach((function(i){return e.append(i,t[i])})),e}function serialize(t,e){var i,r=[];for(i in t)if(t.hasOwnProperty(i)){var a=e?e+"["+i+"]":i,n=t[i];r.push(null!==n&&"object"===(0,_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_1__.Z)(n)?serialize(n,a):encodeURIComponent(a)+"="+encodeURIComponent(n))}return r.join("&")}function isJson(t){if(!t)return!1;try{JSON.parse(t)}catch(t){return!1}return!0}function autoResizeTextarea(t){if(t){var e=parseInt(getComputedStyle(t,null).getPropertyValue("border-top-width"));t.addEventListener("input",(function(){t.style.height="1px",t.style.height=t.scrollHeight+2*e+"px"}))}}function getCoords(t){var e=t.getBoundingClientRect(),i=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,r=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,a=document.documentElement.clientTop||document.body.clientTop||0,n=document.documentElement.clientLeft||document.body.clientLeft||0;return{left:Math.round(e.left+r-n),top:Math.round(e.top+i-a)}}function fixCoords(t,e){var i=getCoords(e),r=t.pageX-i.left,a=t.pageY-i.top;return{x:Math.round(r),y:Math.round(a)}}function addClass(t,e){for(var i=t.className.split(" "),r=i.length,a=0;a<r;a++)if(i[a]==e)return;""==t.className?t.className=e:t.className+=" "+e}function hasClass(t,e){for(var i=t.className.split(" "),r=i.length,a=0;a<r;a++)if(i[a]==e)return!0;return!1}function removeClass(t,e){for(var i=t.className.split(" "),r=i.length,a=0;a<r;a++)i[a]==e&&i.splice(a,1);t.className=i.join(" ")}function inRad(t){return t*Math.PI/180}function radToDeg(t){return t/Math.PI*180}function addOnWheel(t,e){t.addEventListener?"onwheel"in document?t.addEventListener("wheel",e):"onmousewheel"in document?t.addEventListener("mousewheel",e):t.addEventListener("MozMousePixelScroll",e):t.attachEvent("onmousewheel",e)}function getRandom(t,e){return Math.floor(t+Math.random()*(e+1-t))}function dropMenuHeader(t,e){var i=document.getElementById(t),r=document.getElementById(e);return!(!i||!r||(i.addEventListener("click",(function(t){t.preventDefault(),"none"==r.style.display||""==r.style.display?r.style.display="block":r.style.display="none",r.focus()}),!1),r.addEventListener("click",(function(){r.focus()}),!1),r.addEventListener("blur",(function(t){null==t.relatedTarget&&(r.style.display="none")})),0))}function clickDelegation(t,e,i){t.addEventListener("click",(function(t){for(var r=t.target;r!=this;){if(r.classList.contains(e))return t.preventDefault(),t.stopPropagation(),i(r,t),!1;r=r.parentNode}}))}function eventDelegation(t,e,i,r){e.addEventListener(t,(function(t){for(var a=t.target;a&&e.contains(a);){if(a.classList.contains(i))return t.preventDefault(),t.stopPropagation(),r(a,t),!1;a=a.parentNode}}))}function dialogWindow(t,e){var i=document.getElementById(t),r=i.querySelector(".content_modal"),a=i.querySelector(".loading_modal"),n=i.querySelector(".close_modal");function s(){i.style.display="none"}return(e=e||{}).width&&(r.style.width=e.width+"px"),e.height&&(r.style.height=e.height+"px"),i.addEventListener("click",(function(t){t.target==i&&s()})),n.addEventListener("click",(function(){s()})),{show:function(){i.style.display="block"},hide:s,loading:function(t){t?(r.style.display="none",a.style.display="block"):(r.style.display="block",a.style.display="none")}}}function loadImage(t,e,i){var r=new Image;r.onload=function(){e&&e()},r.onerror=function(t){i&&i(t)},r.src=t}function innerHtmlAndExecute($box,html){$box&&($box.innerHTML=html,setTimeout((function(){for(var scripts=Array.prototype.slice.call($box.getElementsByTagName("script")),script,tag,i=0;i<scripts.length;i++)script=scripts[i],script.src?(tag=document.createElement("script"),tag.src=script.src,document.querySelector("head").appendChild(tag)):eval(script.innerHTML)}),0))}function commentsShowFull(){var t=document.querySelectorAll(".body_comment");t&&t.length&&t.forEach((function(t){initCommentShowFull(t)}))}function initCommentShowFull(e){var i=e.querySelector(".body_comment_text"),r=e.querySelector(".body_comment_btn_full");if(isOverflowDown(i)){if(!r){var a=document.createElement("DIV");a.classList.add("body_comment_cont_btn"),(r=document.createElement("SPAN")).classList.add("body_comment_btn_full"),r.innerHTML=t("main.show_full"),a.appendChild(r),insertAfter(a,i)}r.onclick=function(){i.style.maxHeight="none",r.style.display="none"}}}function isOverflowDown(t){return!!t&&t.scrollHeight>t.clientHeight}function insertAfter(t,e){e.parentNode.insertBefore(t,e.nextSibling)}function addPointerEvent(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=(window.PointerEvent?"pointer":"mouse")+e;r?t["on"+a]=i:t.addEventListener(a,i)}function removePointerEvent(t,e,i,r){var a=(window.PointerEvent?"pointer":"mouse")+e;r?t["on"+a]=null:t.removeEventListener(a,i)}function listenerMoveUp(t,e,i){var r=null;function a(t){r=t,e(t)}function n(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{r||i(e)}catch(t){window.scriptError(t)}document.removeEventListener("blur",s),document.removeEventListener("visibilitychange",s),removePointerEvent(t,"move",a),removePointerEvent(t,"up",n)}function s(){n(r,!0)}return addPointerEvent(t,"move",a),addPointerEvent(t,"up",n),document.addEventListener("blur",s),document.addEventListener("visibilitychange",s),{upFunc:n,moveFunc:a,skipUpFunc:s}}function isObject(t){return t&&"object"===_typeof(t)&&!Array.isArray(t)}function mergeDeep(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];if(!i.length)return t;var a=i.shift();if(isObject(t)&&isObject(a))for(var n in a)isObject(a[n])?(t[n]||Object.assign(t,_defineProperty({},n,{})),mergeDeep(t[n],a[n])):Object.assign(t,_defineProperty({},n,a[n]));return mergeDeep.apply(void 0,[t].concat(i))}var DeferredPromise=null},61:function(t,e,i){var r=i(698).default;function a(){"use strict";t.exports=a=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var e={},i=Object.prototype,n=i.hasOwnProperty,s=Object.defineProperty||function(t,e,i){t[e]=i.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",h=o.toStringTag||"@@toStringTag";function u(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,i){return t[e]=i}}function A(t,e,i,r){var a=e&&e.prototype instanceof d?e:d,n=Object.create(a.prototype),o=new T(r||[]);return s(n,"_invoke",{value:C(t,i,o)}),n}function _(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}e.wrap=A;var y={};function d(){}function v(){}function f(){}var p={};u(p,c,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(E([])));m&&m!==i&&n.call(m,c)&&(p=m);var x=f.prototype=d.prototype=Object.create(p);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function i(a,s,o,c){var l=_(t[a],t,s);if("throw"!==l.type){var h=l.arg,u=h.value;return u&&"object"==r(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){i("next",t,o,c)}),(function(t){i("throw",t,o,c)})):e.resolve(u).then((function(t){h.value=t,o(h)}),(function(t){return i("throw",t,o,c)}))}c(l.arg)}var a;s(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,a){i(t,r,e,a)}))}return a=a?a.then(n,n):n()}})}function C(t,e,i){var r="suspendedStart";return function(a,n){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw n;return{value:void 0,done:!0}}for(i.method=a,i.arg=n;;){var s=i.delegate;if(s){var o=b(s,i);if(o){if(o===y)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var c=_(t,e,i);if("normal"===c.type){if(r=i.done?"completed":"suspendedYield",c.arg===y)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r="completed",i.method="throw",i.arg=c.arg)}}}function b(t,e){var i=e.method,r=t.iterator[i];if(void 0===r)return e.delegate=null,"throw"===i&&t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),y;var a=_(r,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,y;var n=a.arg;return n?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,y):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,y)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function E(t){if(t){var e=t[c];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=f,s(x,"constructor",{value:f,configurable:!0}),s(f,"constructor",{value:v,configurable:!0}),v.displayName=u(f,h,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,u(t,h,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},k(w.prototype),u(w.prototype,l,(function(){return this})),e.AsyncIterator=w,e.async=function(t,i,r,a,n){void 0===n&&(n=Promise);var s=new w(A(t,i,r,a),n);return e.isGeneratorFunction(i)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},k(x),u(x,h,"Generator"),u(x,c,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),i=[];for(var r in e)i.push(r);return i.reverse(),function t(){for(;i.length;){var r=i.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(i,r){return s.type="throw",s.arg=t,e.next=i,r&&(e.method="next",e.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var o=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(o&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=t,s.arg=e,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),S(i),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var a=r.arg;S(i)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:E(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),y}},e}t.exports=a,t.exports.__esModule=!0,t.exports.default=t.exports},698:function(t){function e(i){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},687:function(t,e,i){var r=i(61)();t.exports=r;try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},2:function(t,e,i){"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}i.d(e,{Z:function(){return r}})}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](i,i.exports,__webpack_require__),i.exports}__webpack_require__.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=function(t,e){for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};var __webpack_exports__={};!function(){"use strict";function e(t,e,i,r,a,n,s){try{var o=t[n](s),c=o.value}catch(t){return void i(t)}o.done?e(c):Promise.resolve(c).then(r,a)}function i(t){return function(){var i=this,r=arguments;return new Promise((function(a,n){var s=t.apply(i,r);function o(t){e(s,a,n,o,c,"next",t)}function c(t){e(s,a,n,o,c,"throw",t)}o(void 0)}))}}var r=__webpack_require__(687),a=__webpack_require__.n(r),n=__webpack_require__(215);function s(t){var e=t.width,i=t.height,r=document.createElement("canvas");return r.width=e,r.height=i,r}function o(t){return c.apply(this,arguments)}function c(){return(c=i(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){try{e.toBlob((function(e){try{var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsDataURL(e)}catch(e){t("")}}))}catch(e){t("")}}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var h=__webpack_require__(2);function u(t){var e=function(t,e){if("object"!==(0,h.Z)(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==(0,h.Z)(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===(0,h.Z)(e)?e:String(e)}function A(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,u(r.key),r)}}function _(t,e,i){return e&&A(t.prototype,e),i&&A(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var y=function(){function t(e,i){l(this,t),this.value=null,this.callbacks=[],this.affect(e,i)}return _(t,[{key:"affect",value:function(t,e){var i=this;Object.defineProperty(t,e,{set:function(t){i.value=t,i.callbacks.forEach((function(t){return t()}))},get:function(){return i.value}})}},{key:"add",value:function(t){"function"==typeof t&&this.callbacks.push(t)}},{key:"clear",value:function(){this.callbacks=[]}}]),t}(),d=function(){function t(){l(this,t),this.affect_layers=new y(this,"layers"),this.affect_params_layer=null,this.initData()}return _(t,[{key:"initData",value:function(){this.layers=[]}},{key:"getLayers",value:function(){return this.layers}},{key:"getUserLayers",value:function(t){return this.layers.filter((function(e){return e.id_user==t}))}},{key:"affectLayers",value:function(t){this.affect_layers.add(t)}},{key:"affectParamsLayer",value:function(t){this.affect_params_layer=t}},{key:"getLayerOnId",value:function(t,e){return this.layers.find((function(i){return i.index==e&&i.id_user==t}))}},{key:"checkExistsLayer",value:function(t,e){return!!this.getLayerOnId(t,e)}},{key:"addLayer",value:function(t){var e=this.layers;e.unshift(t),this.layers=e}},{key:"delLayerOnId",value:function(t,e){var i=this.getPosOneLayer(t,e);if(!(i<0)){var r=this.layers;r.splice(i,1),this.layers=r}}},{key:"clearLayers",value:function(){this.initData()}},{key:"setPositionLayers",value:function(t){var e=this,i=[];t.forEach((function(t){var r=t.id_user,a=t.index_layer,n=e.getLayerOnId(r,a);n&&i.push(n)})),this.layers=i}},{key:"setPositionUserLayers",value:function(t){var e=this;t.forEach((function(t,i){var r=t.id_user,a=t.index_layer;e.movePositionUserLayer(r,a,i)}))}},{key:"getPositionLayers",value:function(){return this.layers.map((function(t){return{id_user:t.id_user,index_layer:t.index}}))}},{key:"getPositionUserLayers",value:function(t){return this.getUserLayers(t).map((function(t){return{id_user:t.id_user,index:t.index}}))}},{key:"getPosOneLayer",value:function(t,e){return this.layers.findIndex((function(i){return i.id_user==t&&i.index==e}))}},{key:"getPosOneUserLayer",value:function(t,e){return this.getUserLayers(t).findIndex((function(t){return t.index==e}))}},{key:"movePositionLayer",value:function(t,e,i){var r=this.getPosOneLayer(t,e);if(!(r<0)){var a=this.layers,n=a.splice(r,1)[0];a.splice(i,0,n),this.layers=a}}},{key:"movePositionUserLayer",value:function(t,e,i){var r=this.getPosOneLayer(t,e);if(!(r<0)){var a=this.realPositionUserLayer(t,e,i);if(!(a<0)){var n=this.layers,s=n.splice(r,1)[0];n.splice(a,0,s),this.layers=n}}}},{key:"realPositionUserLayer",value:function(t,e,i){var r=this.getUserLayers(t)[i];return r?this.getPosOneLayer(t,r.index):-1}},{key:"changeParamsLayer",value:function(t,e,i){var r=this.getLayerOnId(t,e);if(r){var a=r.params;for(var n in i)i.hasOwnProperty(n)&&(a[n]=i[n]);this.affect_params_layer&&this.affect_params_layer(t,e)}}}]),t}(),v=function(){function t(e,i){l(this,t),this.parent_context=e,this.initData(),this.initElems(i),this.initHandlers(),this.initColors(),this.drawWheel()}return _(t,[{key:"initData",value:function(){this.COLOR_MODEL_HSV="hsv",this.COLOR_MODEL_RGB="rgb",this.ITEM_CIRCLE="circle",this.ITEM_HSV="hsv",this.ITEM_RGB="rgb",this.ITEM_HEX="hex",this.affect_color=new y(this,"current_color"),this.affect_opacity=new y(this,"opacity_color"),this.current_color={model:this.COLOR_MODEL_HSV,data:{}},this.opacity_color=1,this.active_type_model=this.ITEM_CIRCLE}},{key:"affectColor",value:function(t){this.affect_color.add(t)}},{key:"affectOpacity",value:function(t){this.affect_opacity.add(t)}},{key:"initElems",value:function(t){this.$color_model_choice=t.querySelector(".color-model__choice"),this.$color_model_menu=t.querySelector(".color-model__menu"),this.$colorpicker_models=t.querySelector(".colorpicker__models"),this.$circle_picker=t.querySelector(".circle-picker"),this.$circle_picker_wheel=t.querySelector(".circle-picker__wheel"),this.$circle_picker_dot_wheel=t.querySelector(".circle-picker__dot-wheel"),this.$circle_picker_gradient=t.querySelector(".circle-picker__gradient"),this.$circle_picker_dot_gradient=t.querySelector(".circle-picker__dot-gradient"),this.$sample_colorpicker_color=t.querySelector(".sample-colorpicker__color"),this.$model_box_rgb=t.querySelector('.colorpicker__model-box[data-type-model="rgb"]'),this.$model_box_hsv=t.querySelector('.colorpicker__model-box[data-type-model="hsv"]'),this.$model_box_hex=t.querySelector('.colorpicker__model-box[data-type-model="hex"]'),this.$model_hex_input=t.querySelector(".js--hex-input")}},{key:"initHandlers",value:function(){var t=this;this.initMenuHandlers(),this.initCircleHandlers(),this.initRgbHandlers(),this.initHsvHandlers(),this.initHexHandlers(),this.affectColor((function(){t.setColorModels()})),this.affectOpacity((function(){t.setSampleColor()}))}},{key:"initMenuHandlers",value:function(){var t=this;this.$color_model_choice.addEventListener("click",(function(){t.clickColorModelChoice()})),document.addEventListener("click",(function(e){t.clickOutOfMenu(e)})),(0,n.sT)(this.$color_model_menu,"color-model__item",(function(e){t.clickColorModelItem(e)}))}},{key:"initCircleHandlers",value:function(){var t=this;(0,n.aM)(this.$circle_picker_gradient,"down",(function(e){t.downGradient(e)})),(0,n.aM)(this.$circle_picker,"down",(function(e){t.downCircle(e)})),this.$circle_picker.ondragstart=function(t){t.preventDefault()}}},{key:"initRgbHandlers",value:function(){var t=this;(0,n.aM)(this.$model_box_rgb,"down",(function(e){t.downColorSlider(e)})),this.$model_box_rgb.addEventListener("input",(function(e){t.inputColorSlider(e)})),this.$model_box_rgb.addEventListener("wheel",(function(e){t.wheelColorSlider(e)}))}},{key:"initHsvHandlers",value:function(){var t=this;(0,n.aM)(this.$model_box_hsv,"down",(function(e){t.downColorSlider(e)})),this.$model_box_hsv.addEventListener("input",(function(e){t.inputColorSlider(e)})),this.$model_box_hsv.addEventListener("wheel",(function(e){t.wheelColorSlider(e)}))}},{key:"initHexHandlers",value:function(){var t=this;this.$model_hex_input.addEventListener("input",(function(e){t.inputHex(e)}))}},{key:"clickColorModelChoice",value:function(){var t=!this.$color_model_menu.classList.contains("hidden");this.toggleColorModelMenu(t)}},{key:"toggleColorModelMenu",value:function(t){this.$color_model_menu.classList.toggle("hidden",t)}},{key:"clickOutOfMenu",value:function(t){t.target.closest(".color-model")||this.toggleColorModelMenu(!0)}},{key:"clickColorModelItem",value:function(t){var e=t.getAttribute("data-type-model");this.setActiveMenuItem(e),this.setActiveModelBox(e),this.toggleColorModelMenu(!0),this.active_type_model=e,this.setColorModels()}},{key:"setActiveMenuItem",value:function(t){var e=this.$color_model_menu.querySelector('[data-type-model="'+t+'"]');e&&(this.$color_model_menu.querySelectorAll(".color-model__item--active").forEach((function(t){return t.classList.remove("color-model__item--active")})),e.classList.add("color-model__item--active"))}},{key:"setActiveModelBox",value:function(t){var e=this.$colorpicker_models.querySelector('[data-type-model="'+t+'"]');e&&(this.$colorpicker_models.querySelectorAll(".colorpicker__model-box--active").forEach((function(t){return t.classList.remove("colorpicker__model-box--active")})),e.classList.add("colorpicker__model-box--active"))}},{key:"initColors",value:function(){this.setCurrentHsv({hue:0,saturation:0,value:0})}},{key:"drawWheel",value:function(){var t=parseInt(getComputedStyle(this.$circle_picker).getPropertyValue("width")),e=t-2-4;this.$circle_picker_wheel.width=t,this.$circle_picker_wheel.height=t;var i=this.$circle_picker_wheel.getContext("2d"),r=t/2,a=e/2-11,s=e/2+2,o=e/2-22-2;i.lineWidth=1,i.strokeStyle="#c8c8c8",i.beginPath(),i.arc(r,r,s,0,2*Math.PI),i.stroke(),i.beginPath(),i.arc(r,r,o,0,2*Math.PI),i.stroke(),i.lineWidth=22;for(var c=0;c<360;c++)i.beginPath(),i.arc(r,r,a,(0,n.F6)(c-90.7),(0,n.F6)(c-89.3)),i.strokeStyle="hsl("+c+",100%,50%)",i.stroke()}},{key:"downGradient",value:function(t){var e=this;this.caseColorGradient(t),(0,n.Io)(document,(function(t){e.caseColorGradient(t)}),(function(t){e.caseColorGradient(t)}))}},{key:"caseColorGradient",value:function(t){var e=this.getCoordsGradient(t),i=this.getSaturationValueFromCoords(e),r=i.saturation,a=i.value;this.setCurrentHsv({saturation:r,value:a})}},{key:"getCoordsGradient",value:function(t){var e=(0,n.Sz)(t,this.$circle_picker_gradient),i=this.$circle_picker_gradient.offsetHeight,r=this.$circle_picker_gradient.offsetWidth;return e.x<0&&(e.x=0),e.x>i&&(e.x=i),e.y<0&&(e.y=0),e.y>r&&(e.y=r),e}},{key:"getSaturationValueFromCoords",value:function(t){var e=this.$circle_picker_gradient.offsetWidth,i=this.$circle_picker_gradient.offsetHeight;return{saturation:Math.round(100*t.x/e),value:Math.abs(Math.round(100*t.y/i)-100)}}},{key:"getCurrentColorData",value:function(e){var i=this.current_color,r=i.model,a=i.data;return e===r?a:r===this.COLOR_MODEL_HSV?t.hsvToRgb(a.hue,a.saturation,a.value):r===this.COLOR_MODEL_RGB?t.rgbToHsv(a.r,a.g,a.b):void 0}},{key:"setCurrentHsv",value:function(t){var e=t.hue,i=t.saturation,r=t.value,a=this.getCurrentColorData(this.COLOR_MODEL_HSV);(e=void 0!==e?e:a.hue)<0&&(e=0),e>360&&(e=360),(i=void 0!==i?i:a.saturation)<0&&(i=0),i>100&&(i=100),(r=void 0!==r?r:a.value)<0&&(r=0),r>100&&(r=100),this.current_color={model:this.COLOR_MODEL_HSV,data:{hue:e,saturation:i,value:r}}}},{key:"setCurrentRgb",value:function(t){var e=t.r,i=t.g,r=t.b,a=this.getCurrentColorData(this.COLOR_MODEL_RGB);(e=void 0!==e?e:a.r)<0&&(e=0),e>255&&(e=255),(i=void 0!==i?i:a.g)<0&&(i=0),i>255&&(i=255),(r=void 0!==r?r:a.b)<0&&(r=0),r>255&&(r=255),this.current_color={model:this.COLOR_MODEL_RGB,data:{r:e,g:i,b:r}}}},{key:"setColorModels",value:function(){this.active_type_model===this.ITEM_CIRCLE?this.setColorCircleModel():this.active_type_model===this.ITEM_RGB?this.setColorRgbModel():this.active_type_model===this.ITEM_HSV?this.setColorHsvModel():this.active_type_model===this.ITEM_HEX&&this.setColorHexModel(),this.setSampleColor()}},{key:"setColorCircleModel",value:function(){this.setCircleGradient(),this.setCircleWheel()}},{key:"setCircleGradient",value:function(){var e=this.getCurrentColorData(this.COLOR_MODEL_HSV),i=e.hue,r=e.saturation,a=e.value,n=this.$circle_picker_gradient.offsetWidth,s=this.$circle_picker_gradient.offsetHeight,o=Math.round(this.$circle_picker_dot_gradient.offsetWidth/2),c=Math.round(this.$circle_picker_dot_gradient.offsetHeight/2),l=r/100*n,h=(100-a)/100*s;this.$circle_picker_dot_gradient.style.left=l-o+"px",this.$circle_picker_dot_gradient.style.top=h-c+"px";var u=t.hsvToRgb(i,100,100);this.$circle_picker_gradient.style.backgroundColor="rgb(".concat(u.r,", ").concat(u.g,", ").concat(u.b,")")}},{key:"setCircleWheel",value:function(){var t=this.getCurrentColorData(this.COLOR_MODEL_HSV).hue,e=Math.round(this.$circle_picker_dot_wheel.offsetWidth/2),i=Math.round(this.$circle_picker_dot_wheel.offsetHeight/2),r=t,a=Math.round(this.$circle_picker.offsetWidth/2),s=Math.round(this.$circle_picker.offsetHeight/2),o=a-15,c=a+Math.cos((0,n.F6)(r-90))*o,l=s+Math.sin((0,n.F6)(r-90))*o;this.$circle_picker_dot_wheel.style.left=c-e+"px",this.$circle_picker_dot_wheel.style.top=l-i+"px"}},{key:"setSampleColor",value:function(){var t=this.getCurrentRgb(),e=t.r,i=t.g,r=t.b;this.$sample_colorpicker_color.style.backgroundColor="rgba(".concat(e,", ").concat(i,", ").concat(r,", ").concat(this.opacity_color,")")}},{key:"setColorRgbModel",value:function(){var t=this.getCurrentRgb();for(var e in t)t.hasOwnProperty(e)&&this.setCoordsColorSlider(this.$model_box_rgb,e,t[e])}},{key:"setColorHsvModel",value:function(){var t=this.getCurrentHsv(),e={hue:"h",saturation:"s",value:"v"};for(var i in t)t.hasOwnProperty(i)&&this.setCoordsColorSlider(this.$model_box_hsv,e[i],t[i])}},{key:"downCircle",value:function(t){var e=this;t.target.closest("."+this.$circle_picker_gradient.className)||(this.caseColorWheel(t),(0,n.Io)(document,(function(t){e.caseColorWheel(t)}),(function(t){e.caseColorWheel(t)})))}},{key:"caseColorWheel",value:function(t){var e,i=(0,n.Sz)(t,this.$circle_picker),r=Math.round(this.$circle_picker.offsetWidth/2),a=Math.round(this.$circle_picker.offsetHeight/2),s=i.x-r,o=i.y-a;0===s?e=o>0?180:0:(e=Math.round(180*Math.atan(o/s)/Math.PI),e=s>0?e+90:e+270),this.setCurrentHsv({hue:e})}},{key:"getCurrentRgb",value:function(){var e=this.current_color,i=e.model,r=e.data;return i===this.COLOR_MODEL_RGB?r:t.hsvToRgb(r.hue,r.saturation,r.value)}},{key:"getCurrentHsv",value:function(){var e=this.current_color,i=e.model,r=e.data;return i===this.COLOR_MODEL_HSV?r:t.rgbToHsv(r.r,r.g,r.b)}},{key:"setColorRgb",value:function(e){e=e.split(",");var i=this.current_color,r=i.model;if(i.data,r!==this.COLOR_MODEL_RGB){var a=t.rgbToHsv(e[0],e[1],e[2]);this.setCurrentHsv(a)}else this.setCurrentRgb({r:e[0],g:e[1],b:e[2]})}},{key:"setOpacityColor",value:function(t){this.opacity_color=t}},{key:"downColorSlider",value:function(t){var e=this;if(t.target.closest(".color-slider__move")){var i=t.target.closest(".color-slider");this.caseColorSlider(t,i),(0,n.Io)(document,(function(t){e.caseColorSlider(t,i)}),(function(t){e.caseColorSlider(t,i)}))}}},{key:"caseColorSlider",value:function(t,e){var i=this.getValueFromCoordsSlider(t,e);this.saveColorSlider(e,i)}},{key:"getValueFromCoordsSlider",value:function(t,e){var i=this.getMaxSlider(e),r=i.max_x,a=i.max_value,n=this.processCoordsColorSlider(t,e,r);return Math.round(n/r*a)}},{key:"processCoordsColorSlider",value:function(t,e,i){var r=e.querySelector(".color-slider__move"),a=(0,n.Sz)(t,r).x;return a<0&&(a=0),a>i&&(a=i),a}},{key:"getMaxSlider",value:function(t){var e=t.querySelector(".color-slider__move"),i=t.getAttribute("data-type-value");return{max_x:e.offsetWidth,max_value:this.getMaxTypeValue(i)}}},{key:"getMaxTypeValue",value:function(t){return{h:360,s:100,v:100,r:255,g:255,b:255}[t]}},{key:"setCoordsColorSlider",value:function(t,e,i){var r=t.querySelector('.color-slider[data-type-value="'+e+'"]');this.setOneColorSlider(r,i),this.setGradientSlider(r,e),this.setInputSlider(r,i)}},{key:"setOneColorSlider",value:function(t,e){var i=t.querySelector(".color-slider__current"),r=this.getMaxSlider(t),a=r.max_x,n=r.max_value,s=Math.round(e/n*a),o=Math.round(s/a*100);i.style.left=o+"%"}},{key:"setGradientSlider",value:function(t,e){var i=t.querySelector(".color-slider__move"),r=t.querySelector(".color-slider__gradient"),a=r.getContext("2d");r.width=i.offsetWidth,r.height=i.offsetHeight,a.fillStyle=this.getGradientSlider(r,e),a.fillRect(0,0,r.width,r.height)}},{key:"getGradientSlider",value:function(t,e){return["r","g","b"].includes(e)?this.getGradientRgb(t,e):["h","s","v"].includes(e)?this.getGradientHsv(t,e):void 0}},{key:"getGradientRgb",value:function(t,e){var i,r,a=t.getContext("2d"),n=this.getCurrentRgb(),s=n.r,o=n.g,c=n.b;"r"===e?(i="rgb(0, "+o+", "+c+")",r="rgb(255, "+o+", "+c+")"):"g"===e?(i="rgb("+s+", 0, "+c+")",r="rgb("+s+", 255, "+c+")"):"b"===e&&(i="rgb("+s+", "+o+", 0)",r="rgb("+s+", "+o+", 255)");var l=a.createLinearGradient(0,0,t.width,0);return l.addColorStop(0,i),l.addColorStop(1,r),l}},{key:"getGradientHsv",value:function(e,i){var r,a,n=e.getContext("2d"),s=this.getCurrentHsv(),o=s.hue,c=s.saturation,l=s.value,h=n.createLinearGradient(0,0,e.width,0);if("h"===i){for(var u=0;u<=360;u+=30)h.addColorStop(u/360,"hsl("+u+",100%,50%)");return h}"s"===i?(r=t.hsvToRgb(o,0,l),a=t.hsvToRgb(o,100,l)):"v"===i&&(r=t.hsvToRgb(o,c,0),a=t.hsvToRgb(o,c,100));var A="rgb(".concat(r.r,", ").concat(r.g,", ").concat(r.b,")"),_="rgb(".concat(a.r,", ").concat(a.g,", ").concat(a.b,")");return h.addColorStop(0,A),h.addColorStop(1,_),h}},{key:"setInputSlider",value:function(t,e){t.querySelector(".color-slider__value").value=e}},{key:"saveColorSlider",value:function(t,e){var i=t.getAttribute("data-type-value");["r","g","b"].includes(i)?this.saveRgbColorSlider(i,e):["h","s","v"].includes(i)&&this.saveHsvColorSlider(i,e)}},{key:"saveRgbColorSlider",value:function(t,e){var i=this.getCurrentRgb(),r=i.r,a=i.g,n=i.b;"r"===t?r=e:"g"===t?a=e:"b"===t&&(n=e),this.setCurrentRgb({r:r,g:a,b:n})}},{key:"saveHsvColorSlider",value:function(t,e){var i=this.getCurrentHsv(),r=i.hue,a=i.saturation,n=i.value;"h"===t?r=e:"s"===t?a=e:"v"===t&&(n=e),this.setCurrentHsv({hue:r,saturation:a,value:n})}},{key:"inputColorSlider",value:function(t){var e=t.target,i=e.closest(".color-slider");if(i){var r=this.getMaxSlider(i).max_value,a=parseInt(e.value)||0;a<0&&(a=0),a>r&&(a=r),this.saveColorSlider(i,a)}}},{key:"wheelColorSlider",value:function(t){var e=t.target.closest(".color-slider");if(e){t.preventDefault();var i,r=e.getAttribute("data-type-value");if(["r","g","b"].includes(r)){var a=this.getCurrentRgb(),n=a.r,s=a.g,o=a.b;"r"===r?i=n:"g"===r?i=s:"b"===r&&(i=o)}else if(["h","s","v"].includes(r)){var c=this.getCurrentHsv(),l=c.hue,h=c.saturation,u=c.value;"h"===r?i=l:"s"===r?i=h:"v"===r&&(i=u)}var A=t.deltaY<0?i+1:i-1;this.saveColorSlider(e,A)}}},{key:"setColorHexModel",value:function(){var t=this.getCurrentHex();this.$model_hex_input.value=t}},{key:"getCurrentHex",value:function(){var e=this.current_color,i=e.model,r=e.data;if(i===this.COLOR_MODEL_RGB)return t.rgbToHex(r.r,r.g,r.b);var a=t.hsvToRgb(r.hue,r.saturation,r.value);return t.rgbToHex(a.r,a.g,a.b)}},{key:"inputHex",value:function(e){var i=e.target,r=i.value,a=t.hexToRgb(r);i.classList.toggle("hex-box__input--error",!a),a&&this.setCurrentRgb({r:a.r,g:a.g,b:a.b})}}],[{key:"hsvToRgb",value:function(t,e,i){var r,a,n;t/=360,e/=100,i/=100;var s=Math.floor(6*t),o=6*t-s,c=i*(1-e),l=i*(1-o*e),h=i*(1-(1-o)*e);switch(s%6){case 0:r=i,a=h,n=c;break;case 1:r=l,a=i,n=c;break;case 2:r=c,a=i,n=h;break;case 3:r=c,a=l,n=i;break;case 4:r=h,a=c,n=i;break;case 5:r=i,a=c,n=l}return{r:Math.round(255*r),g:Math.round(255*a),b:Math.round(255*n)}}},{key:"rgbToHsv",value:function(t,e,i){t/=255,e/=255,i/=255;var r,a,n=Math.max(t,e,i),s=Math.min(t,e,i),o=n,c=n-s;if(a=0==n?0:c/n,n==s)r=0;else{switch(n){case t:r=(e-i)/c+(e<i?6:0);break;case e:r=(i-t)/c+2;break;case i:r=(t-e)/c+4}r/=6}return{hue:Math.round(360*r),saturation:Math.round(100*a),value:Math.round(100*o)}}},{key:"hexToRgb",value:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}},{key:"componentToHex",value:function(t){var e=t.toString(16);return 1===e.length?"0"+e:e}},{key:"rgbToHex",value:function(e,i,r){return"#"+t.componentToHex(e)+t.componentToHex(i)+t.componentToHex(r)}}]),t}(),f="mouse_move",p="mouse_enter",g="mouse_leave",m="start_draw",x="move_draw",k="finish_draw",w="history_abort",C="history_repeat",b="reset_selection",L="transform_area",S="add_layer",T="del_layer",E="lock_layer",I="mask_layer",O="safe_layer_down",M="safe_layers",R="copy_layer",P="clear_layer",D="visible_layer",N="active_layer",z="position_layer",B="name_layer",U="config_layer",H="selection_cut",$="selection_copy",q="resize_canvas",K=function(){function t(e){var i=e.main_context,r=e.$panel;l(this,t),this.main_context=i,this.$panel=r}return _(t,[{key:"init",value:function(){this.$panel&&(this.initElems(),this.initHandlers())}},{key:"initElems",value:function(){this.$add_layer=this.$panel.querySelector(".js--add-layer"),this.$del_layer=this.$panel.querySelector(".js--del-layer"),this.$lock_layer=this.$panel.querySelector(".js--lock-layer"),this.$mask_layer=this.$panel.querySelector(".js--mask-layer"),this.$safe_layer_down=this.$panel.querySelector(".js--safe-layer-down"),this.$copy_layer=this.$panel.querySelector(".js--copy-layer"),this.$clear_layer=this.$panel.querySelector(".js--clear-layer")}},{key:"initHandlers",value:function(){var t=this.main_context.users_canvas.getMyUser().events_layer;this.$add_layer.addEventListener("click",(function(){t.clickAddLayer()})),this.$del_layer.addEventListener("click",(function(){t.clickDelLayer()})),this.$lock_layer.addEventListener("click",(function(){t.clickLockLayer()})),this.$mask_layer.addEventListener("click",(function(){t.clickMaskLayer()})),this.$safe_layer_down.addEventListener("click",(function(){t.clickSafeLayerDown()})),this.$copy_layer.addEventListener("click",(function(){t.clickCopyLayer()})),this.$clear_layer.addEventListener("click",(function(){t.clickClearLayer()}))}}]),t}();function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function V(t){return function(t){if(Array.isArray(t))return j(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return j(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?j(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var W=function(){function t(e){var i=e.main_context,r=e.$box,a=e.list_layers;l(this,t),this.main_context=i,this.$box=r,this.list_layers=a,this.$box&&this.initHandlers()}return _(t,[{key:"initHandlers",value:function(){var t=this;(0,n.aM)(this.$box,"down",(function(e){t.mouseDownListLayers(e)})),this.$box.ondragstart=function(t){t.preventDefault()},(0,n.dQ)("click",this.$box,"one-layer__vis",(function(e){t.clickIconVisLayer(e)})),this.$box.addEventListener("dblclick",(function(e){t.doubleClickNameLayer(e)}))}},{key:"mouseDownListLayers",value:function(t){var e=this,i=t.target.closest(".one-layer");if(i){var r,a,s=(0,n.Sz)(t,i),o=t.pageY-(0,n.r7)(i).top,c=!1,l=i.getAttribute("data-id_layer");(0,n.Io)(document,(function(t){var a=Math.abs(s.y-(0,n.Sz)(t,i).y);!c&&a<8||(c||(c=!0,r=e.getPosLayer(i),e.startDragLayer(i)),e.moveDragLayer(t,i,o))}),(function(t){c?(e.endDragLayer(t,i),a=e.getPosLayer(i),r!==a&&e.main_context.users_canvas.getMyUser().user_events.trigger(z,{index_layer:l,start_position_layer:r,end_position_layer:a})):e.clickNameLayer(t)}))}}},{key:"getPosLayer",value:function(t){return V(t.parentElement.children).indexOf(t)}},{key:"startDragLayer",value:function(t){this.$under_layer=document.createElement("DIV"),this.$under_layer.className="under_layer",this.$under_layer.style.height=t.clientHeight+"px",this.$box.insertBefore(this.$under_layer,t),t.style.position="absolute",t.style.opacity=.75,t.style.zIndex=10}},{key:"moveDragLayer",value:function(t,e,i){this.$box.querySelector(".under_layer")||this.$box.insertBefore(this.$under_layer,e);var r=(0,n.Sz)(t,this.$box),a=this.$under_layer.clientHeight,s=r.y-i;s<0?s=0:s>this.$box.offsetHeight-a-2&&(s=this.$box.offsetHeight-a-2);var o=(0,n.r7)(this.$under_layer).top-(0,n.r7)(this.$box).top+a;if(s<o-Math.round(1.5*a)){for(var c=this.$under_layer.previousSibling;null!=c&&c==e;)c=c.previousSibling;c&&this.$box.insertBefore(this.$under_layer,c)}else if(s>o-Math.round(.5*a)){for(var l=this.$under_layer.nextElementSibling;null!=l&&l==e;)l=l.nextElementSibling;if(l){var h=l.nextElementSibling;h?this.$box.insertBefore(this.$under_layer,h):this.$box.appendChild(this.$under_layer)}}e.style.top=s+this.$box.scrollTop-1+"px"}},{key:"endDragLayer",value:function(t,e){this.$box.insertBefore(e,this.$under_layer);for(var i=this.$box.getElementsByClassName("under_layer"),r=0;r<i.length;r++)this.$box.removeChild(i[r]);e.style.position="relative",e.style.top="0px",e.style.opacity=1,e.style.zIndex=1}},{key:"clickIconVisLayer",value:function(t){var e=t.closest(".one-layer"),i=e.getAttribute("data-id_layer"),r=!t.classList.contains("one-layer__vis--not"),a=e.getAttribute("data-id_user");this.main_context.users_canvas.getUser(a).user_events.trigger(D,i,r)}},{key:"doubleClickNameLayer",value:function(t){var e=t.target;e.classList.contains("one-layer__name")&&this.changeNameLayer(e)}},{key:"changeNameLayer",value:function(t){var e=this,i=t.innerHTML,r=t.closest(".one-layer").getAttribute("data-id_layer");t.innerHTML="";var a=document.createElement("input");a.setAttribute("type","text"),a.value=i,a.onblur=function(){e.newNameLayer(r,a.value,i)},a.onkeyup=function(t){13==t.keyCode&&(a.onblur=null,e.newNameLayer(r,a.value,i))},t.appendChild(a),a.focus()}},{key:"newNameLayer",value:function(t,e,i){(e=e.trim())||(e=i),this.main_context.users_canvas.getMyUser().user_events.trigger(B,t,e,i)}},{key:"renderListLayers",value:function(t){var e=this;this.$box.innerHTML="",t.forEach((function(t){t.$box_layer&&e.$box.appendChild(t.$box_layer)}))}},{key:"renderParamsLayer",value:function(t,e){var i=this.list_layers.getLayerOnId(t,e);if(i){var r=i.params,a=r.name,n=r.hide,s=r.is_lock,o=r.is_mask;this.toggleVisLayer(t,e,n),this.setNewNameLayer(t,e,a),this.toggleLockLayer(t,e,s),this.toggleMaskLayer(t,e,o)}}},{key:"toggleVisLayer",value:function(t,e,i){var r=this.list_layers.getLayerOnId(t,e);r&&r.$box_layer.querySelector(".one-layer__vis").classList.toggle("one-layer__vis--not",i)}},{key:"setNewNameLayer",value:function(t,e,i){var r=this.list_layers.getLayerOnId(t,e);if(r){var a=r.$box_layer.querySelector(".one-layer__name");a.setAttribute("title",i),a.innerHTML=i}}},{key:"activeLayerAction",value:function(t){this.selectActiveLayer(t),this.main_context.config_layers&&this.main_context.config_layers.setConfigLayer(t)}},{key:"selectActiveLayer",value:function(){var t=this.main_context.users_canvas.getMyUser().user_layers.getActiveLayer();if(this.$box&&t){var e=this.$box.querySelectorAll(".one-layer--active");e.length&&V(e).forEach((function(t){return t.classList.remove("one-layer--active")})),t.$box_layer.classList.add("one-layer--active")}}},{key:"toggleLockLayer",value:function(t,e,i){var r=this.list_layers.getLayerOnId(t,e);if(r){var a=r.$box_layer.querySelector(".one-layer__lock");a&&a.classList.toggle("one-layer__lock--not",!0!==i)}}},{key:"toggleMaskLayer",value:function(t,e,i){var r=this.list_layers.getLayerOnId(t,e);if(r){var a=r.$box_layer.querySelector(".one-layer__mask");a&&a.classList.toggle("one-layer__mask--not",!0!==i)}}},{key:"clickNameLayer",value:function(t){var e=t.target;if(e.classList.contains("one-layer__name")){var i=e.parentNode.getAttribute("data-id_layer"),r=this.main_context.users_canvas.getMyUser(),a=r.user_layers.getActiveIndexLayer();r.user_events.trigger(N,a,i)}}}]),t}();var F=function(){function t(){l(this,t),this.timeout_preview_layer={}}return _(t,[{key:"savePreviewLayer",value:function(t){var e=this;if(t){var i=t.id_user+"_"+t.index;this.timeout_preview_layer[i]&&clearTimeout(this.timeout_preview_layer[i]),this.timeout_preview_layer[i]=setTimeout((function(){e.actionSavePreviewLayer(t),e.timeout_preview_layer[i]=null}),1e3)}}},{key:"actionSavePreviewLayer",value:function(t){var e=this;this.getPreviewBox(t,(function(i){e.drawPreviewBox(t,i)}))}},{key:"drawPreviewBox",value:function(t,e){var i,r,a,n,s,o,c=t.$box_layer.querySelector(".one-layer__preview-canvas"),l=c.width,h=c.height,u=c.getContext("2d",{willReadFrequently:!0});e.width>0&&e.height>0?(a=e.x,n=e.y,i=e.width,r=e.height):(a=0,n=0,i=t.$layer.width,r=t.$layer.height),i>=r?(s=l,o=h*(r/i)):(s=l*(i/r),o=h);var A=s<l?(l-s)/2:0,_=o<h?(h-o)/2:0;u.clearRect(0,0,l,h),u.fillStyle="white",u.fillRect(A,_,s,o),u.drawImage(t.$layer,a,n,i,r,A,_,s,o)}},{key:"getPreviewBox",value:function(t,e){var i=this,r=t.$layer.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,t.$layer.width,t.$layer.height),a=r.width,n=r.height,s=0,o=n,c=0,l=a,h=0;!function t(){try{for(var u={break_lazy:!1,cnt_for:0,max_cnt_for:2e4};!u.break_lazy&&s<o&&i.rowFor(r,a,s,u);)s+=10;for(;!u.break_lazy&&o-1>s&&i.rowFor(r,a,o-1,u);)o-=10;for(;!u.break_lazy&&c<l&&i.columnFor(r,a,c,s,o,u);)c+=10;for(;!u.break_lazy&&l-1>c&&i.columnFor(r,a,l-1,s,o,u);)l-=10;if(!u.break_lazy)return void e(i.processPreviewBox({top:s,bottom:o,left:c,right:l,width:a,height:n,step_for:10}));if(++h>30)return}catch(t){return void window.scriptError(t)}setTimeout((function(){t()}),0)}()}},{key:"processPreviewBox",value:function(t){var e=t.top,i=t.bottom,r=t.left,a=t.right,n=t.width,s=t.height,o=t.step_for;(r-=o)<0&&(r=0),(e-=o)<0&&(e=0),(a+=o)>=n&&(a=n-1),(i+=o)>=s&&(i=s-1);var c=a-r;c<0&&(c=0);var l=i-e;return l<0&&(l=0),{x:r,y:e,width:c,height:l}}},{key:"rowFor",value:function(t,e,i,r){for(var a=0;a<e;a++){if(r.cnt_for++,r.cnt_for>=r.max_cnt_for)return r.break_lazy=!0,!1;if(0!==t.data[i*e*4+4*a+3])return!1}return!0}},{key:"columnFor",value:function(t,e,i,r,a,n){for(var s=r;s<a;s++){if(n.cnt_for++,n.cnt_for>=n.max_cnt_for)return n.break_lazy=!0,!1;if(0!==t.data[s*e*4+4*i+3])return!1}return!0}}]),t}(),Y="move",G="selection",Z="lasso",J="transform",Q="grab",X="crop",tt="eraser",et="pipet",it="fillbrush",rt="loupe",at="rotate",nt="brush",st="softbrush",ot="pencil",ct="calligr",lt="sketch",ht="shaggy",ut="pixel_brush";function At(t,e){this.canva=t,this.user_context=e,this.is_draw={},this.config_tool={},this.$canvas_source=this.createTmpCanvas(),this.ctx_canvas_source=this.$canvas_source.getContext("2d"),this.$canvas_over=this.createTmpCanvas(),this.ctx_canvas_over=this.$canvas_over.getContext("2d")}At.prototype.createTmpCanvas=function(){var t=document.createElement("canvas");return t.width=0,t.height=0,t},At.prototype.startDraw=function(t,e){this.obj_layer=this.user_context.user_layers.getActiveLayer(),this.ctx=this.ctx_canvas_over,this.clearIsDraw(),this.is_draw.start=!0,this.saveConfigTool(e),this.saveCanvasTemp(this.obj_layer.$layer),this.saveContext(),this.clipSelection(),this.createBuffer(),this.start(t),this.renderCanvas(),this.canva.updateArtCanvas()},At.prototype.saveConfigTool=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config_tool=Object.assign({},t)},At.prototype.getConfigTool=function(t){return this.config_tool[t]},At.prototype.saveCanvasTemp=function(t){var e=t.width,i=t.height,r=this.$canvas_source,a=this.$canvas_over,n=this.ctx_canvas_source,s=this.ctx_canvas_over;r.width=e,r.height=i,n.clearRect(0,0,e,i),n.drawImage(t,0,0,e,i),a.width=e,a.height=i,s.clearRect(0,0,e,i),this.contextDefault(s),this.contextDefault(n)},At.prototype.renderCanvas=function(){if(this.$canvas_source.width&&this.$canvas_source.height&&this.$canvas_over.width&&this.$canvas_over.height){var t=this.user_context.user_layers.getActiveLayer(),e=t.$layer,i=e.width,r=e.height,a=t.ctx;a.clearRect(0,0,i,r),a.drawImage(this.$canvas_source,0,0,i,r),a.drawImage(this.$canvas_over,0,0,i,r)}},At.prototype.clearCanvasOver=function(){var t=this.$canvas_over,e=t.width,i=t.height;this.ctx_canvas_over.clearRect(0,0,e,i)},At.prototype.clearIsDraw=function(){this.is_draw={start:!1,move:!1,finish:!1}},At.prototype.saveContext=function(){this.ctx.save(),this.ctx_canvas_source.save()},At.prototype.restoreContext=function(){this.ctx.restore(),this.ctx_canvas_source.restore()},At.prototype.contextDefault=function(t){var e="black";t.lineCap="round",t.lineJoin="round",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.shadowColor=e,t.strokeStyle=e,t.fillStyle=e,t.lineWidth=1,t.globalCompositeOperation="source-over",t.setLineDash([]),t.lineDashOffset=0,t.filter=""},At.prototype.clipSelection=function(){if(![J,Y].includes(this.user_context.tools_draw.getNameCurrentTool())){var t=this.user_context.events_draw.getSelectionPoints();t&&(this.clipContext(this.ctx,t),this.clipContext(this.ctx_canvas_source,t))}},At.prototype.clipContext=function(t,e){if(e&&!(e.length<=1)){var i=e[0];t.beginPath(),t.moveTo(i.x,i.y);for(var r=1;r<e.length;r++)i=e[r],t.lineTo(i.x,i.y);t.clip(),t.closePath()}},At.prototype.moveDraw=function(t){this.obj_layer=this.user_context.user_layers.getActiveLayer(),this.ctx=this.ctx_canvas_over,this.is_draw.start&&(this.is_draw.move=!0,this.move(t),this.renderCanvas(),this.canva.updateArtCanvas())},At.prototype.finishDraw=function(t){this.obj_layer=this.user_context.user_layers.getActiveLayer(),this.ctx=this.ctx_canvas_over,this.is_draw.finish=!0,this.finish(t),this.renderCanvas(),this.clearIsDraw(),this.restoreContext(),this.resetBuffer(),this.canva.updateArtCanvas()},At.prototype.choiceTool=function(t,e,i){this.choice(i)},At.prototype.unchoiceTool=function(t,e,i){this.is_draw.start&&!this.is_draw.finish&&this.finishDraw({}),this.unchoice(i)},At.prototype.start=function(){},At.prototype.move=function(){},At.prototype.finish=function(){},At.prototype.choice=function(){},At.prototype.unchoice=function(){},At.prototype.drawSpacing=function(t){this.canva;var e,i,r=this.points,a=t,n=r.length-a-1;for(this.sum_dist=this.buffer_sum_dist,this.clearCanvasOver(),this.buffer_index?(this.drawBuffer(),i=this.buffer_prev_point):(i=r[0],this.drawPoint(i),this.buffer_index++),e=this.buffer_index;e<n;e+=a){var s=r[e],o=r[e+a],c=this.midPointBetween(s,o);this.drawCurve(i,s,c),i=c}this.saveBuffer(e,this.sum_dist,i),e<r.length&&r.length>=2&&this.drawCurve(i,r[e],r[r.length-1]),this.redrawOpacity(this.getConfigTool("opacity"))},At.prototype.createBuffer=function(){this.buffer_canvas=document.createElement("canvas"),this.buffer_canvas.width=this.ctx.canvas.width,this.buffer_canvas.height=this.ctx.canvas.height,this.buffer_index=0,this.buffer_sum_dist=0,this.buffer_prev_point=null},At.prototype.resetBuffer=function(){this.buffer_canvas=null},At.prototype.drawBuffer=function(){this.buffer_canvas&&this.ctx.drawImage(this.buffer_canvas,0,0)},At.prototype.saveBuffer=function(t,e,i){var r=this.buffer_canvas.getContext("2d");r.clearRect(0,0,this.buffer_canvas.width,this.buffer_canvas.height),r.drawImage(this.$canvas_over,0,0),this.buffer_index=t,this.buffer_sum_dist=e,this.buffer_prev_point=i},At.prototype.drawCurve=function(t,e,i){for(var r=this.getCurvePoint(t,e,i,0),a=.25;a<=1;a+=.25){var n=this.getCurvePoint(t,e,i,a),s=this.distanceBetween(r,n),o=this.getPressureSpacing(n);if(this.sum_dist+=s,this.sum_dist>=o){var c=o-(this.sum_dist-s);this.drawBetween(r,n,c,o),this.sum_dist=this.sum_dist-Math.floor(this.sum_dist/o)*o}r=n}},At.prototype.drawBetween=function(t,e,i,r){for(var a=this.distanceBetween(t,e),n=this.angleBetween(t,e),s=i;s<=a;s+=r){var o=this.getAnglePoint(t,e,n,s,a);this.drawPoint(o,n)}},At.prototype.getCurvePoint=function(t,e,i,r){return{x:this.getBezierCoord(t.x,e.x,i.x,r),y:this.getBezierCoord(t.y,e.y,i.y,r),pressure:this.getStabilizePressure(t.pressure,i.pressure,r,1)}},At.prototype.getBezierCoord=function(t,e,i,r){return Math.pow(1-r,2)*t+2*(1-r)*r*e+Math.pow(r,2)*i},At.prototype.getStabilizePressure=function(t,e,i,r){if(void 0!==t&&void 0!==e)return(r?i/r:0)*(e-t)+t},At.prototype.drawPoint=function(){},At.prototype.redrawOpacity=function(t){var e=this.ctx,i=e.globalAlpha;e.globalAlpha=t,e.globalCompositeOperation="copy",e.drawImage(this.$canvas_over,0,0),e.globalAlpha=i,e.globalCompositeOperation="source-over"},At.prototype.getSpacingWidth=function(t){var e=this.getConfigTool("spacing");return Math.ceil(t/100*e)},At.prototype.distanceBetween=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},At.prototype.angleBetween=function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},At.prototype.getAnglePoint=function(t,e,i,r,a){return{x:t.x+Math.sin(i)*r,y:t.y+Math.cos(i)*r,pressure:this.getStabilizePressure(t.pressure,e.pressure,r,a)}},At.prototype.midPointBetween=function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2,pressure:e.pressure}},At.prototype.getPressureLineWidth=function(t){var e=this.getConfigTool("line_width"),i=this.getConfigTool("pressure_size"),r=this.getConfigTool("min_size");if(!t)return e;var a=t.pressure;if(!i||void 0===a)return e;var n=e*(r/100),s=(e-n)*a+n;return s<1&&(s=1),s},At.prototype.getPressureDensity=function(t){this.canva;var e=t.pressure,i=this.getConfigTool("density"),r=this.getConfigTool("pressure_density"),a=this.getConfigTool("min_density");if(!r||void 0===e)return i;var n=i*(a/100),s=(i-n)*e+n;return s<1&&(s=1),s},At.prototype.getColorDensity=function(t){return"rgba("+this.getConfigTool("color")+","+t/100+")"},At.prototype.getPressureColorDensity=function(t){var e=this.getPressureDensity(t);return this.getColorDensity(e)},At.prototype.getPressureSpacing=function(t){var e=this.getPressureLineWidth(t);return this.getSpacingWidth(e)},At.prototype.getRadialGradient=function(t,e,i,r){var a=this.ctx,n=(this.canva,this.getConfigTool("soft")),s=i,o=Math.ceil(s-s*(n/100))-1;o<0&&(o=0);var c=a.createRadialGradient(t,e,o,t,e,s),l=this.getConfigTool("color"),h=0;for(r/=100;h<=1;){var u=parseFloat((r-r*this.easeOut(h)).toFixed(3));u>1&&(u=1),c.addColorStop(h,"rgba("+l+","+u+")"),h=parseFloat((h+.05).toFixed(3))}return c},At.prototype.easeOut=function(t){return 1-(t=1-t)*t};var _t=["name"],yt=function(){function e(t){var i=t.main_context,r=t.list_layers,a=t.handlers;l(this,e),this.main_context=i,this.list_layers=r,this.handlers=a,this.preview_layer=new F}return _(e,[{key:"selectionCutAction",value:function(t,e,i,r){if(!this.checkLockLayerAction(t,e)){var a=this.actionSelectionCopyLayer(t,e,i,r).duplicate_new_layer,n=this.main_context.list_layers.getLayerOnId(t,e);return n.ctx.save(),At.prototype.clipContext.apply(this,[n.ctx,r]),this.clearCanvasAction(t,e),n.ctx.restore(),{duplicate_layer:this.getDuplicateLayer(t,e),duplicate_new_layer:a}}}},{key:"selectionCopyAction",value:function(t,e,i,r){var a=this.actionSelectionCopyLayer(t,e,i,r);return{duplicate_layer:a.duplicate_layer,duplicate_new_layer:a.duplicate_new_layer}}},{key:"actionSelectionCopyLayer",value:function(t,e,i,r){this.newLayerWithName(t,i).name_layer;var a=this.main_context.list_layers.getLayerOnId(t,i),n=this.main_context.list_layers.getLayerOnId(t,e),s=this.getDuplicateLayer(t,e);return a.ctx.save(),At.prototype.clipContext.apply(this,[a.ctx,r]),this.drawCanvasAction(t,i,n.$layer),a.ctx.restore(),{duplicate_layer:s,duplicate_new_layer:this.getDuplicateLayer(t,i)}}},{key:"newLayerWithName",value:function(e,i){var r=t("draw.layer_name")+" "+i;return this.actionNewLayer(e,i,{name:r}),{name_layer:r}}},{key:"actionNewLayer",value:function(t,e,i){this.newLayer(t,e,i);var r=this.main_context.users_canvas.getUser(t),a=r.user_layers.getActiveIndexLayer(),n=this.list_layers.getPosOneLayer(t,a);this.list_layers.movePositionLayer(t,e,n-1),r.user_layers.setActiveLayer(e),this.actionSavePreviewLayer(t,e)}},{key:"newLayer",value:function(t,e,i){var r=this.handlers.getSizeCanvas(),a=s({width:r.width,height:r.height}),n=a.getContext("2d");i=this.setDefaultParamsLayer(i);var o=this.createBoxLayerList(t,e,i);this.list_layers.addLayer({id_user:t,index:e,$layer:a,ctx:n,$box_layer:o,params:i})}},{key:"setDefaultParamsLayer",value:function(e){return e||(e={}),e.name=void 0!==e.name?e.name:t("draw.layer_name"),e.hide=void 0!==e.hide&&e.hide,e.opacity=void 0!==e.opacity?e.opacity:100,e.is_lock=void 0!==e.is_lock&&e.is_lock,e.is_mask=void 0!==e.is_mask&&e.is_mask,e.blending=void 0!==e.blending?e.blending:"source-over",e}},{key:"setParamsLayer",value:function(t,e,i){var r=this.list_layers.getLayerOnId(t,e);if(r&&i){i.name;var a=function(t,e){if(null==t)return{};var i,r,a=function(t,e){if(null==t)return{};var i,r,a={},n=Object.keys(t);for(r=0;r<n.length;r++)i=n[r],e.indexOf(i)>=0||(a[i]=t[i]);return a}(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)i=n[r],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(a[i]=t[i])}return a}(i,_t);a.name=r.params.name,this.list_layers.changeParamsLayer(t,e,a)}}},{key:"createBoxLayerList",value:function(e,i,r){var a=document.createElement("div");return a.className="one-layer",a.setAttribute("data-id_layer",i),a.setAttribute("data-id_user",e),a.innerHTML='\n            <div class="one-layer__lock one-layer__lock--not"\n                 title="'.concat(t("draw.layer_is_locked"),'"\n            >\n                <span class="icon-lock-gray"></span>\n            </div>\n            <div class="one-layer__mask one-layer__mask--not"\n                 title="').concat(t("draw.layer_mask"),'"\n            >\n                <span class="icon-mask-down-gray"></span>\n            </div>\n            <div class="one-layer__preview-box">\n                <canvas class="one-layer__preview-canvas" width="100" height="100"></canvas>\n            </div>\n            <div class="one-layer__name" \n                 title="').concat(r.name,'"\n             >\n                ').concat(r.name,'\n            </div>\n            <div class="one-layer__vis"\n                 title="').concat(t("draw.layer_show_hide"),'"\n             ></div>\n        '),a}},{key:"savePreviewLayer",value:function(t,e){var i=this.list_layers.getLayerOnId(t,e);this.preview_layer.savePreviewLayer(i)}},{key:"actionSavePreviewLayer",value:function(t,e){var i=this.list_layers.getLayerOnId(t,e);this.preview_layer.actionSavePreviewLayer(i)}},{key:"delLayerAction",value:function(t,e){if(this.list_layers.getUserLayers(t).length<=1)return!1;if(this.checkLockLayerAction(t,e))return!1;var i=this.getDuplicateLayer(t,e);return this.delLayer(t,e),{next_index_layer:this.setNextActiveLayer(t,i.position),duplicate_layer:i}}},{key:"delLayer",value:function(t,e){if(!this.list_layers.checkExistsLayer(t,e))return!1;this.list_layers.delLayerOnId(t,e)}},{key:"getDuplicateLayer",value:function(t,e){if(!this.list_layers.checkExistsLayer(t,e))return!1;var i=this.list_layers.getLayerOnId(t,e);return{id_user:t,index_layer:e,position:this.list_layers.getPosOneUserLayer(t,e),image_layer:this.getImageLayer(i.$layer),params:Object.assign({},i.params)}}},{key:"setNextActiveLayer",value:function(t,e){var i=this.list_layers.getUserLayers(t);if(!i.length)return!1;for(;e>0&&e>=i.length;)e--;var r=i[e].index;return this.main_context.users_canvas.getUser(t).user_layers.setActiveLayer(r),r}},{key:"getImageLayer",value:function(t){var e=new Image;return e.src=t.toDataURL("image/png"),e}},{key:"safeLayers",value:function(t){var e=this.list_layers.getUserLayers(t),i=e[0].index,r=this.main_context.users_canvas.getUser(t);r.user_layers.setActiveLayer(i);for(var a=[this.getDuplicateLayer(t,i)],n=this.list_layers.getPositionUserLayers(t),s=0,o=e.length;e.length>1&&s<o-1;){var c=r.user_layers.getActiveIndexLayer(),l=this.safeLayerDown(t,c);l&&a.unshift(l),s++}return{data_layers:a,positions_layers:n}}},{key:"safeLayerDownAction",value:function(t,e){var i=[],r=this.list_layers.getPositionUserLayers(t),a=this.getDuplicateLayer(t,e),n=this.safeLayerDown(t,e);return!!n&&(i.push(n,a),this.savePreviewLayer(t,n.index_layer),{data_layers:i,positions_layers:r})}},{key:"safeLayerDown",value:function(t,e){var i=this.list_layers.getUserLayers(t),r=this.list_layers.getPosOneUserLayer(t,e)+1;if(r>=i.length)return!1;var a=i[r].index;if(this.checkLockLayerAction(t,e)||this.checkLockLayerAction(t,a))return!1;var n=this.getDuplicateLayer(t,a);return this.safeTwoLayers(t,a,e),n}},{key:"safeLayerTop",value:function(t,e){var i=this.list_layers.getUserLayers(t),r=this.list_layers.getPosOneUserLayer(t,e)-1;if(r<0)return!1;var a=i[r].index;if(this.checkLockLayerAction(t,e)||this.checkLockLayerAction(t,a))return!1;var n=this.getDuplicateLayer(t,a);return this.safeTwoLayers(t,e,a),n}},{key:"safeTwoLayers",value:function(t,e,i){var r=this.list_layers.getLayerOnId(t,e),a=this.list_layers.getLayerOnId(t,i);if(!r||!a)return!1;this.main_context.users_canvas.getUser(t).user_layers.setActiveLayer(e);var n=a.params.opacity/100,s=r.ctx.globalAlpha,o=r.ctx.globalCompositeOperation;if(r.ctx.globalAlpha=n,a.params.blending&&(r.ctx.globalCompositeOperation=a.params.blending),a.params.is_mask){var c=this.main_context.art_canvas.renderMaskTmpCanvas(a.$layer,r.$layer);r.ctx.drawImage(c,0,0)}else r.ctx.drawImage(a.$layer,0,0);r.ctx.globalAlpha=s,r.ctx.globalCompositeOperation=o,this.list_layers.delLayerOnId(t,i),this.main_context.updateArtCanvas()}},{key:"copyLayerAction",value:function(t,e,i){var r=this.copyLayer(t,e,i);return!!r&&{copy_layer:r}}},{key:"copyLayer",value:function(e,i,r){var a=this.list_layers.getLayerOnId(e,i),n=this.list_layers.getPosOneUserLayer(e,i),s=a.params.name+" "+t("draw.a_copy");return!!a&&(this.newLayer(e,r,{name:s}),this.list_layers.movePositionUserLayer(e,r,n+1),this.drawCanvasAction(e,r,a.$layer),this.setParamsLayer(e,r,a.params),this.main_context.updateArtCanvas(),this.getDuplicateLayer(e,r))}},{key:"clearLayerAction",value:function(t,e){if(this.checkLockLayerAction(t,e))return!1;var i=this.clearLayer(t,e);return!!i&&{layer:i}}},{key:"clearLayer",value:function(t,e){if(!this.list_layers.getLayerOnId(t,e))return!1;var i=this.getDuplicateLayer(t,e);return this.clearCanvasAction(t,e),i}},{key:"drawCanvasAction",value:function(t,e,i){var r=this.list_layers.getLayerOnId(t,e);r&&(this.drawCanvas(r.ctx,i),this.savePreviewLayer(t,e),this.main_context.updateArtCanvas())}},{key:"drawCanvas",value:function(t,e){t.drawImage(e,0,0)}},{key:"clearCanvasAction",value:function(t,e){var i=this.list_layers.getLayerOnId(t,e);i&&(this.clearCanvas(i.ctx),this.savePreviewLayer(t,e),this.main_context.updateArtCanvas())}},{key:"clearCanvas",value:function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}},{key:"lockLayerAction",value:function(t,e){var i=this.list_layers.getLayerOnId(t,e);if(!i)return!1;var r=!i.params.is_lock;return this.lockLayer(t,e,r),{is_lock:r}}},{key:"lockLayer",value:function(t,e,i){this.list_layers.changeParamsLayer(t,e,{is_lock:i})}},{key:"checkLockLayerAction",value:function(t,e){return!!this.checkLockLayer(t,e)&&(this.showLayerIsLock(t,e),!0)}},{key:"showLayerIsLock",value:function(e,i){var r=this.list_layers.getLayerOnId(e,i);if(r){var a=t("draw.show_layer_is_locked");a=a.replace("%name_layer%",r.params.name),alert(a)}}},{key:"checkLockLayer",value:function(t,e){var i=this.list_layers.getLayerOnId(t,e);return!i||!!i.params.is_lock}},{key:"maskLayerAction",value:function(t,e){var i=this.list_layers.getLayerOnId(t,e);if(!i)return!1;var r=!i.params.is_mask;return this.maskLayer(t,e,r),{is_mask:r}}},{key:"maskLayer",value:function(t,e,i){this.list_layers.changeParamsLayer(t,e,{is_mask:i})}}]),e}(),dt=function(){function t(e){var i=e.main_context,r=e.$box;l(this,t),r&&(this.main_context=i,this.$box=r,this.$sliders_config=this.$box.querySelectorAll(".move_slider"),this.$blending_select=this.$box.querySelector(".js--blending-select"),this.initHandlers())}return _(t,[{key:"initHandlers",value:function(){var t=this;V(this.$sliders_config).forEach((function(e){t.initHandlersSliderConfig(e)})),this.$blending_select.addEventListener("change",(function(e){t.changeBlendingMode(e)}))}},{key:"initHandlersSliderConfig",value:function(t){var e=this;(0,n.aM)(t,"down",(function(i){e.mouseDownSliderConfig(i,t)}),!0),t.addEventListener("wheel",(function(i){e.wheelSliderConfig(i,t)}))}},{key:"mouseDownSliderConfig",value:function(t,e){var i=this,r=(0,n.Sz)(t,e),a=e.getAttribute("data-conf");this.main_context.config_tools.sliderMove(r,e),(0,n.aM)(document,"move",(function(t){var r=(0,n.Sz)(t,e);i.main_context.config_tools.sliderMove(r,e,(function(t){i.setValConfig(a,t)}))}),!0),(0,n.aM)(document,"up",(function(t){var r=(0,n.Sz)(t,e);i.main_context.config_tools.sliderMove(r,e,(function(t){i.setValConfig(a,t)})),(0,n._M)(document,"move",(function(){}),!0),(0,n._M)(document,"up",(function(){}),!0)}),!0)}},{key:"setValConfig",value:function(t,e){var i=this.main_context.users_canvas.getMyUser(),r=i.user_layers.getActiveIndexLayer();i.user_events.trigger(U,r,t,e)}},{key:"wheelSliderConfig",value:function(t,e){var i=this;t.preventDefault();var r,a=t.deltaY,n=e.querySelector(".val_slider"),s=parseInt(n.innerHTML),o=e.getAttribute("data-conf"),c=this.main_context.config_tools.getMaxValConf(o),l=c>100?2:1,h=this.main_context.config_tools.getWidthSlider(e);r=a<0?s+l:s-l;var u=Math.round(r/c*h);this.main_context.config_tools.sliderMove({x:u},e,(function(t){i.setValConfig(o,t)}))}},{key:"setConfigLayer",value:function(t){if(this.$box){var e=this.main_context.users_canvas.getMyIdUser(),i=this.main_context.list_layers.getLayerOnId(e,t);i&&(this.setConfigBlending(i),this.setConfigSliders(i))}}},{key:"setConfigBlending",value:function(t){this.$blending_select.value=t.params.blending||"source-over"}},{key:"setConfigSliders",value:function(t){for(var e,i,r,a=this,n=0;n<this.$sliders_config.length;n++)e=this.$sliders_config[n],r=e.getAttribute("data-conf"),e.querySelector(".cur_slider"),e.querySelector(".val_slider"),i=Math.round(t.params[r]/100*(e.offsetWidth-2)),this.main_context.config_tools.sliderMove({x:i},e,(function(t){a.setValConfig(r,t)}))}},{key:"changeBlendingMode",value:function(t){var e=t.target.value,i=this.main_context.users_canvas.getMyUser(),r=i.user_layers.getActiveIndexLayer();i.user_events.trigger(U,r,"blending",e),this.main_context.local_save_canvas&&this.main_context.local_save_canvas.timeoutSave()}}]),t}(),vt=function(){function t(e){var i=e.main_context,r=e.$canvas;l(this,t),this.main_context=i,this.$canvas=r,this.ctx_canvas=this.$canvas.getContext("2d"),this.is_render=!1,this.updateSizeCanvas()}return _(t,[{key:"updateSizeCanvas",value:function(){var t=this.main_context.drawing_area.getSizeContainerWork();this.setSizeCanvas(t)}},{key:"setSizeCanvas",value:function(t){var e=t.width,i=t.height;this.$canvas.width=e,this.$canvas.height=i}},{key:"getSizeCanvas",value:function(){return{width:this.$canvas.width,height:this.$canvas.height}}},{key:"toggleSmoothing",value:function(t){this.ctx_canvas.imageSmoothingEnabled=!!t}},{key:"render",value:function(){var t=this;this.is_render||(this.is_render=!0,window.requestAnimationFrame((function(){t.is_render=!1,t.renderAll()})))}},{key:"renderAll",value:function(){this.resetTransform(),this.clearCanvas(),this.setTransform(),this.renderArt(),this.resetTransform(),this.renderCursor(),this.renderSelection(),this.renderTransformation(),this.renderCrop()}},{key:"setTransform",value:function(){var t=this.main_context.transform_canvas.getTransform();this.ctx_canvas.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])}},{key:"clearCanvas",value:function(){this.ctx_canvas.clearRect(0,0,this.$canvas.width,this.$canvas.height)}},{key:"resetTransform",value:function(){this.ctx_canvas.resetTransform()}},{key:"renderArt",value:function(){this.main_context.art_canvas.renderLayers(this.main_context.list_layers.getLayers());var t=this.main_context.art_canvas.getCanvas(),e=t.width,i=t.height;this.renderShadowArt({x:0,y:0,width:e,height:i}),this.ctx_canvas.drawImage(t,0,0,e,i)}},{key:"renderShadowArt",value:function(t){var e=t.x,i=t.y,r=t.width,a=t.height;this.ctx_canvas.shadowColor="#c8c8c8",this.ctx_canvas.shadowBlur=3,this.ctx_canvas.fillStyle="rgba(255,255,255,1)",this.ctx_canvas.fillRect(e,i,r,a),this.ctx_canvas.shadowBlur=0}},{key:"renderSelection",value:function(){var t=this.main_context.users_canvas.getMyUser().events_draw.getSelectionTool();if(t&&t.is_visible){t.drawLines(t.points_selection);var e=t.getCanvas();this.ctx_canvas.drawImage(e,0,0,e.width,e.height)}}},{key:"renderCursor",value:function(){var t=this.main_context.brush_cursor;if(t.getIsVisible()){t.drawCursor();var e=t.getCanvasCursor(),i=t.getPositionCursor(),r=i.x,a=i.y,n=t.getSizeCursor(),s=Math.round(n/2);r-=s,a-=s,e&&e.width&&e.height&&this.ctx_canvas.drawImage(e,r,a,n,n)}}},{key:"renderTransformation",value:function(){var t=this.main_context.users_canvas.getMyUser().tools_draw.tools[J];if(t){var e=t.tool;if(e.is_active){e.drawArea();var i=e.getCanvas();i.width&&i.height&&this.ctx_canvas.drawImage(i,0,0,i.width,i.height)}}}},{key:"renderCrop",value:function(){var t=this.main_context.users_canvas.getMyUser().tools_draw.tools[X];if(t){var e=t.tool;if(e.is_active){e.drawCropArea();var i=e.getCanvas();this.ctx_canvas.drawImage(i,0,0,i.width,i.height)}}}}]),t}(),ft=function(){function t(e){var i=e.size_canvas;l(this,t),this.$canvas=s(i),this.ctx_canvas=this.$canvas.getContext("2d"),this.$tmp_canvas=s(i),this.tmp_ctx_canvas=this.$tmp_canvas.getContext("2d")}return _(t,[{key:"setSizeCanvas",value:function(t){var e=t.width,i=t.height;this.$canvas.width=e,this.$canvas.height=i,this.$tmp_canvas.width=e,this.$tmp_canvas.height=i}},{key:"getCanvas",value:function(){return this.$canvas}},{key:"getSizeCanvas",value:function(){return{width:this.$canvas.width,height:this.$canvas.height}}},{key:"clearCanvas",value:function(){this.ctx_canvas.clearRect(0,0,this.$canvas.width,this.$canvas.height)}},{key:"renderLayers",value:function(t){var e,i=this,r=t.slice().reverse();this.clearCanvas(),r.forEach((function(t){i.renderOneLayer(t,e),e=t}))}},{key:"renderOneLayer",value:function(t,e){var i=t.$layer,r=t.params,a=i.width,n=i.height,s=this.ctx_canvas;if(!r.hide){r.blending&&(s.globalCompositeOperation=r.blending);var o=s.globalAlpha;if(s.globalAlpha=r.opacity/100,r.is_mask&&e){var c=this.renderMaskTmpCanvas(i,e.$layer);s.drawImage(c,0,0,a,n)}else s.drawImage(i,0,0,a,n);s.globalAlpha=o,s.globalCompositeOperation="source-over"}}},{key:"renderMaskTmpCanvas",value:function(t,e){var i=this.tmp_ctx_canvas;return i.clearRect(0,0,this.$tmp_canvas.width,this.$tmp_canvas.height),i.drawImage(t,0,0,this.$tmp_canvas.width,this.$tmp_canvas.height),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0,this.$tmp_canvas.width,this.$tmp_canvas.height),i.globalCompositeOperation="source-over",this.$tmp_canvas}}]),t}();function pt(){this.setToIdentity()}pt.prototype.setToIdentity=function(){this.m=[1,0,0,1,0,0]},pt.prototype.multiply=function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],r=this.m[0]*t.m[2]+this.m[2]*t.m[3],a=this.m[1]*t.m[2]+this.m[3]*t.m[3],n=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=r,this.m[3]=a,this.m[4]=n,this.m[5]=s},pt.prototype.preMultiply=function(t){var e=t.m[0]*this.m[0]+t.m[2]*this.m[1],i=t.m[1]*this.m[0]+t.m[3]*this.m[1],r=t.m[0]*this.m[2]+t.m[2]*this.m[3],a=t.m[1]*this.m[2]+t.m[3]*this.m[3],n=t.m[0]*this.m[4]+t.m[2]*this.m[5]+t.m[4],s=t.m[1]*this.m[4]+t.m[3]*this.m[5]+t.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=r,this.m[3]=a,this.m[4]=n,this.m[5]=s},pt.prototype.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,r=-this.m[2]*t,a=this.m[0]*t,n=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=r,this.m[3]=a,this.m[4]=n,this.m[5]=s},pt.prototype.getInverted=function(){var t=new pt;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t.invert(),t},pt.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.m[0]*e+this.m[2]*i,a=this.m[1]*e+this.m[3]*i,n=this.m[0]*-i+this.m[2]*e,s=this.m[1]*-i+this.m[3]*e;this.m[0]=r,this.m[1]=a,this.m[2]=n,this.m[3]=s},pt.prototype.rotateAroundPoint=function(t,e,i){this.translate(e,i),this.rotate(t),this.translate(-e,-i)},pt.prototype.translate=function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},pt.prototype.scale=function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},pt.prototype.scaleAroundPoint=function(t,e,i,r){this.translate(i,r),this.scale(t,e),this.translate(-i,-r)},pt.prototype.shear=function(t,e){var i=this.m[0]+this.m[2]*e,r=this.m[1]+this.m[3]*e,a=this.m[2]+this.m[0]*t,n=this.m[3]+this.m[1]*t;this.m[0]=i,this.m[1]=r,this.m[2]=a,this.m[3]=n},pt.prototype.getTransformedPoint=function(t){return{x:t.x*this.m[0]+t.y*this.m[2]+this.m[4],y:t.x*this.m[1]+t.y*this.m[3]+this.m[5]}},pt.prototype.transformPoints=function(t){for(var e=0;e<t.length;e++)t[e]=this.getTransformedPoint(t[e])},pt.prototype.getTranslateX=function(){return this.m[4]},pt.prototype.getTranslateY=function(){return this.m[5]},pt.prototype.clone=function(){var t=new pt;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t},pt.prototype.getDeterminant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]},pt.prototype.decompose=function(){var t=this.getDeterminant(),e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return{translate:{x:this.m[4],y:this.m[5]},rotate:Math.sign(this.m[1])*Math.acos(this.m[0]/e),scale:{x:e,y:t/e},shear:{x:Math.atan((this.m[0]*this.m[2]+this.m[1]*this.m[3])/(e*e)),y:0}}},pt.prototype.toString=function(){return"["+this.m[0].toFixed(2)+" "+this.m[2].toFixed(2)+" "+this.m[4].toFixed(2)+"]\n["+this.m[1].toFixed(2)+" "+this.m[3].toFixed(2)+" "+this.m[5].toFixed(2)+"]\n[0.00 0.00 1.00]"},Math.sign=Math.sign||function(t){return 0==(t=+t)||isNaN(t)?t:t>0?1:-1};var gt=function(){function t(e){var i=e.main_context;l(this,t),this.main_context=i,this.transform=new pt,this.offsets={x:0,y:0},this.zoom=1,this.rotate=0,this.flip_horizontally=!1,this.step_rotate=(0,n.F6)(15),this.initElems(),this.initHandlers()}return _(t,[{key:"init",value:function(){this.centerCanvas(),this.visibleZoomCanvas()}},{key:"initElems",value:function(){this.$rotate_left=document.querySelector(".js--rotate-left"),this.$rotate_right=document.querySelector(".js--rotate-right"),this.$transform_reset=document.querySelector(".js--transform-reset"),this.$transform_flip_horizontally=document.querySelector(".js--transform-flip-horizontally"),this.$current_zoom=document.querySelector(".js--current-zoom"),this.$zoom_in=document.querySelector(".js--zoom-in"),this.$zoom_out=document.querySelector(".js--zoom-out")}},{key:"initHandlers",value:function(){var t=this;this.$rotate_left.addEventListener("click",(function(){t.clickRotateLeft()})),this.$rotate_right.addEventListener("click",(function(){t.clickRotateRight()})),this.$transform_reset.addEventListener("click",(function(){t.clickTransformReset()})),this.$transform_flip_horizontally.addEventListener("click",(function(){t.clickFlipHorizontally()})),this.$zoom_in.addEventListener("click",(function(){t.clickZoomInOut(-1)})),this.$zoom_out.addEventListener("click",(function(){t.clickZoomInOut(1)}))}},{key:"clickRotateLeft",value:function(){var t=this.transform.clone();this.rotateAroundCenter(this.rotate,-1*this.step_rotate,t)}},{key:"clickRotateRight",value:function(){var t=this.transform.clone();this.rotateAroundCenter(this.rotate,this.step_rotate,t)}},{key:"rotateAroundCenter",value:function(t,e,i){var r=this.main_context.work_canvas.getSizeCanvas(),a=new pt;a.rotateAroundPoint(e,r.width/2,r.height/2),a.multiply(i),this.setRotate(t+e),this.setOffsets({x:~~a.getTranslateX(),y:~~a.getTranslateY()})}},{key:"clickTransformReset",value:function(){this.setRotate(0),this.centerCanvas(),this.visibleZoomCanvas()}},{key:"clickFlipHorizontally",value:function(){var t=!this.flip_horizontally,e=this.main_context.work_canvas.getSizeCanvas(),i={x:Math.round(e.width/2),y:Math.round(e.height/2)},r=this.transform.clone(),a=new pt;a.scaleAroundPoint(-1,1,i.x,i.y),a.multiply(r),this.setFlipHorizontally(t),this.setOffsets({x:~~a.getTranslateX(),y:~~a.getTranslateY()}),this.$transform_flip_horizontally.classList.toggle("btn-bottom-panel--active",t)}},{key:"clickZoomInOut",value:function(t){var e=this.main_context.work_canvas.getSizeCanvas(),i={x:Math.round(e.width/2),y:Math.round(e.height/2)};this.scaleLayers(i,this.getDiffScale(t))}},{key:"getRotate",value:function(){return this.rotate}},{key:"setRotate",value:function(t){this.rotate=t,this.updateTransform()}},{key:"getFlipHorizontally",value:function(){return this.flip_horizontally}},{key:"setFlipHorizontally",value:function(t){this.flip_horizontally=!!t,this.updateTransform()}},{key:"updateTransform",value:function(){var t=this.transform;t.setToIdentity(),t.translate(this.offsets.x,this.offsets.y),t.scale((this.flip_horizontally?-1:1)*this.zoom,this.zoom),t.rotate(this.rotate),this.main_context.scrollbar_canvas&&this.main_context.scrollbar_canvas.updateValues(),this.main_context.updateArtCanvas()}},{key:"getTransform",value:function(){return this.transform.m}},{key:"setOffsets",value:function(t){var e=t.x,i=t.y;void 0!==e&&(this.offsets.x=e),void 0!==i&&(this.offsets.y=i),this.updateTransform()}},{key:"getOffsets",value:function(){return this.offsets}},{key:"setZoom",value:function(t){this.zoom=t,this.updateTransform()}},{key:"getZoom",value:function(){return this.zoom}},{key:"getDiffScale",value:function(t){var e,i=this.getZoom();return e=i<2?.2:i<4?.4:i<8?.8:i<16?1.6:2.2,t>0&&(e*=-1),i+e}},{key:"scaleLayers",value:function(t,e){e<.2?e=.2:e>12&&(e=12);var i=this.getOffsets(),r=1-e/this.getZoom(),a=~~((t.x-i.x)*r),n=~~((t.y-i.y)*r);this.setOffsets({x:i.x+a,y:i.y+n}),this.setZoom(e),this.setCurrentZoom(e),this.main_context.work_canvas.toggleSmoothing(e<=1.8),this.main_context.brush_cursor.setPositionCursor(t)}},{key:"setCurrentZoom",value:function(t){var e=Math.round(100*t);this.$current_zoom.innerHTML=e+"%"}},{key:"centerCanvas",value:function(){var t=this.getOffsets(),e=this.main_context.work_canvas.getSizeCanvas(),i=this.main_context.art_canvas.getSizeCanvas(),r=this.coordsToDisplay({x:i.width/2,y:i.height/2}),a=Math.round(t.x+e.width/2-r.x),n=Math.round(t.y+e.height/2-r.y);this.setOffsets({x:a,y:n})}},{key:"visibleZoomCanvas",value:function(){var t=this.main_context.work_canvas.getSizeCanvas(),e={x:Math.round(t.width/2),y:Math.round(t.height/2)};for(this.scaleLayers(e,1);!this.fitViewCanvas()&&this.getZoom()>.2;)this.clickZoomInOut(1)}},{key:"fitViewCanvas",value:function(){var t=this.getVisibleArtArea(),e=this.main_context.work_canvas.getSizeCanvas();return t.width<=e.width&&t.height<=e.height}},{key:"coordsToDisplay",value:function(t){return this.transform.getTransformedPoint(t)}},{key:"coordsToDisplayInt",value:function(t){var e=this.coordsToDisplay(t);return e.x=Math.round(e.x),e.y=Math.round(e.y),e}},{key:"coordsToDocument",value:function(t){this.transform.getInverted().getTransformedPoint(t)}},{key:"coordsToDocumentInt",value:function(t){var e=this.transform.getInverted().getTransformedPoint(t);return e.x=Math.round(e.x),e.y=Math.round(e.y),e}},{key:"getVisibleArtArea",value:function(){var t=this.main_context.art_canvas.getSizeCanvas(),e=t.width,i=t.height,r=this.coordsToDisplayInt({x:0,y:0}),a=this.coordsToDisplayInt({x:0,y:i}),n=this.coordsToDisplayInt({x:e,y:0}),s=this.coordsToDisplayInt({x:e,y:i}),o=Math.min(Math.min(r.x,a.x),Math.min(n.x,s.x)),c=Math.min(Math.min(r.y,a.y),Math.min(n.y,s.y));return{x:o,y:c,width:Math.max(Math.max(r.x,a.x),Math.max(n.x,s.x))-o,height:Math.max(Math.max(r.y,a.y),Math.max(n.y,s.y))-c}}}]),t}(),mt="abort_history",xt="repeat_history",kt="draw",wt="set_tool",Ct=function(){function e(t){var i=t.main_context,r=t.$box;l(this,e),this.main_context=i,this.$box=r}return _(e,[{key:"init",value:function(){this.registerUserActions(),this.initHandlers()}},{key:"getContainerWork",value:function(){return this.$box}},{key:"getSizeContainerWork",value:function(){return{width:this.$box.offsetWidth,height:this.$box.offsetHeight}}},{key:"registerUserActions",value:function(){var t=this,e=this.main_context.user_actions;e.registerAction(kt,{is_promise:!0,event:function(e,i){t.drawMoveUp(e,i)}}),e.registerAction(wt,{event:function(e){t.setCurTool(e)}})}},{key:"initHandlers",value:function(){var t=this;this.main_context.users_canvas.getMyUser(),(0,n.aM)(this.$box,"down",(function(e){t.clickDrawLayers(e)})),this.$box.oncontextmenu=function(t){t.preventDefault()},(0,n.aM)(this.$box,"enter",(function(e){t.mouseEnter(e)})),(0,n.aM)(this.$box,"move",(function(e){t.mouseMove(e)})),(0,n.aM)(this.$box,"leave",(function(e){t.mouseLeave(e)})),this.$box.addEventListener("wheel",(function(e){t.onWheelLayers(e)}))}},{key:"clickDrawLayers",value:function(e){var i,r,a=this,n=this.main_context.users_canvas.getMyUser(),s=n.getIdUser(),o=n.user_layers.getActiveLayer(),c=n.tools_draw.getNameCurrentTool();if(o){if(!this.main_context.layer_actions.checkLockLayerAction(s,o.index)){var l=[et,Q,rt,at];if(!o.params.hide||l.includes(c)){if(2==e.which?r=Q:3==e.which&&(r=et),r&&(e.preventDefault(),i=c,!this.main_context.user_actions.trigger(wt,{name_tool:r,is_hotkey:!0})))return;var h=this.main_context.user_actions.trigger(kt,{e:e});h&&h.then((function(){i&&a.setCurTool({name_tool:i,is_hotkey:!0})}))}}}else alert(t("draw.tooltip_not_select_layer"))}},{key:"drawMoveUp",value:function(t,e){var i=this,r=t.e;this.forceUp(),this.mouseDown(r),this.move_up=(0,n.Io)(document,(function(t){i.mouseDrawMove(t)}),(function(t){try{i.mouseUp(t)}catch(t){window.scriptError(t)}e(),i.move_up=null}))}},{key:"forceUp",value:function(){this.move_up&&this.move_up.skipUpFunc()}},{key:"onWheelLayers",value:function(t){t.preventDefault();var e=(0,n.Sz)(t,this.$box),i=this.main_context.transform_canvas;i.scaleLayers(e,i.getDiffScale(t.deltaY))}},{key:"mouseEnter",value:function(t){var e=this.main_context.users_canvas.getMyUser(),i=this.main_context.transformCoords(t);e.user_events.trigger(p,i)}},{key:"mouseMove",value:function(t){var e=this.main_context.users_canvas.getMyUser(),i=this.main_context.transformCoords(t);e.user_events.trigger(f,i)}},{key:"mouseLeave",value:function(t){var e=this.main_context.users_canvas.getMyUser(),i=this.main_context.transformCoords(t);e.user_events.trigger(g,i)}},{key:"mouseDown",value:function(t){var e=this.main_context.transformCoords(t),i=this.main_context.users_canvas.getMyUser(),r=i.tools_draw.getNameCurrentTool(),a=this.main_context.config_tools.getConfigsDrawing(),n=i.user_layers.getActiveIndexLayer();i.user_events.trigger(m,{name_tool:r,coords:e,configs_drawing:a,index_layer:n})}},{key:"mouseDrawMove",value:function(t){var e=this.main_context.transformCoords(t),i=this.main_context.users_canvas.getMyUser(),r=i.tools_draw.getNameCurrentTool();i.user_events.trigger(x,{name_tool:r,coords:e})}},{key:"mouseUp",value:function(t){var e=this.main_context.transformCoords(t),i=this.main_context.users_canvas.getMyUser(),r=i.tools_draw.getNameCurrentTool();i.user_events.trigger(k,{name_tool:r,coords:e})}},{key:"setCurTool",value:function(t){this.main_context.users_canvas.getMyUser().tools_draw.setCurTool(t)}}]),e}(),bt=function(){function e(t,i){l(this,e),this.parent_context=t,this.$elem=i,this.$dialog_canvas_edit_size=document.getElementById("dialog-canvas-edit-size"),this.$dialog_canvas_edit_size&&(this.$edit_size_width=this.$dialog_canvas_edit_size.querySelector(".js--edit-size-width"),this.$edit_size_height=this.$dialog_canvas_edit_size.querySelector(".js--edit-size-height"),this.$edit_size_btn=this.$dialog_canvas_edit_size.querySelector(".js--edit-size-btn"),this.dialog_canvas_edit_size=(0,n.ON)(this.$dialog_canvas_edit_size.id,{width:400})),this.$dialog_help_hotkeys=document.getElementById("dialog-help-hotkeys"),this.dialog_help_hotkeys=(0,n.ON)(this.$dialog_help_hotkeys.id,{width:400}),this.CLASS_MENU_ITEM="menu-draw__item",this.CLASS_MENU_ITEM_BOX="menu-draw__item-box",this.CLASS_MENU_DROPDOWN="menu-draw__dropdown",this.CLASS_SUBITEM="menu-draw__sub-item",this.CLASS_SUBITEM_INACTIVE="menu-draw__sub-item--inactive",this.CLASS_EDIT_SIZE_ERROR="canvas-edit-size__input-error",this.ACTION_NEW="new",this.ACTION_SAVE="save",this.ACTION_OPEN_KEPT="open_kept",this.ACTION_SAVE_KEPT="save_kept",this.ACTION_SAVE_DISK="save_disk",this.ACTION_RESIZE="resize",this.ACTION_LAYERS_ADD="layers_add",this.ACTION_LAYERS_SAFE_ALL="layers_safe_all",this.ACTION_SELECTION_REMOVE="selection_remove",this.ACTION_SELECTION_CUT="selection_cut",this.ACTION_SELECTION_COPY="selection_copy",this.ACTION_VIEW_ZOOM_IN="view_zoom_in",this.ACTION_VIEW_ZOOM_OUT="view_zoom_out",this.ACTION_VIEW_ROTATE_LEFT="view_rotate_left",this.ACTION_VIEW_ROTATE_RIGHT="view_rotate_right",this.ACTION_VIEW_ROTATE_RESET="view_rotate_reset",this.ACTION_VIEW_FLIP_HORIZONTALLY="view_flip_horizontally",this.ACTION_VIEW_FULLSCREEN="view_fullscreen",this.ACTION_HELP_HOTKEYS="help_hotkeys",this.initHandlers()}return _(e,[{key:"initHandlers",value:function(){var t=this;(0,n.dQ)("click",this.$elem,this.CLASS_MENU_ITEM,(function(e){t.clickMenuItem(e)})),document.addEventListener("click",(function(e){t.clickDocument(e)})),(0,n.dQ)("click",this.$elem,this.CLASS_SUBITEM,(function(e){t.clickSubItem(e)})),this.$edit_size_btn&&this.$edit_size_btn.addEventListener("click",(function(){t.clickEditSizeBtn()}))}},{key:"clickMenuItem",value:function(t){var e=t.closest("."+this.CLASS_MENU_ITEM_BOX);if(e){var i=e.querySelector("."+this.CLASS_MENU_DROPDOWN);if(i){var r=i.classList.contains("hidden");this.hideAllDropdown(),i.classList.toggle("hidden",!r)}}}},{key:"clickDocument",value:function(t){t.target.closest("."+this.CLASS_MENU_DROPDOWN)||this.hideAllDropdown()}},{key:"hideAllDropdown",value:function(){V(this.$elem.querySelectorAll("."+this.CLASS_MENU_DROPDOWN)).forEach((function(t){t.classList.add("hidden")}))}},{key:"clickSubItem",value:function(t){if(!t.classList.contains(this.CLASS_SUBITEM_INACTIVE))switch(this.hideAllDropdown(),t.getAttribute("data-action")){case this.ACTION_NEW:this.clickMenuPictureNew();break;case this.ACTION_SAVE:this.clickMenuPictureSave();break;case this.ACTION_OPEN_KEPT:this.clickMenuPictureOpenKept();break;case this.ACTION_SAVE_KEPT:this.clickMenuPictureSaveKept();break;case this.ACTION_SAVE_DISK:this.clickMenuPictureSaveDisk();break;case this.ACTION_RESIZE:this.clickMenuCanvasEditSize();break;case this.ACTION_LAYERS_ADD:this.clickMenuLayersAdd();break;case this.ACTION_LAYERS_SAFE_ALL:this.clickMenuLayersSafeAll();break;case this.ACTION_SELECTION_REMOVE:this.clickMenuSelectionRemove();break;case this.ACTION_SELECTION_CUT:this.clickMenuSelectionCut();break;case this.ACTION_SELECTION_COPY:this.clickMenuSelectionCopy();break;case this.ACTION_VIEW_ZOOM_IN:this.clickMenuViewZoomIn();break;case this.ACTION_VIEW_ZOOM_OUT:this.clickMenuViewZoomOut();break;case this.ACTION_VIEW_ROTATE_LEFT:this.clickMenuViewRotateLeft();break;case this.ACTION_VIEW_ROTATE_RIGHT:this.clickMenuViewRotateRight();break;case this.ACTION_VIEW_ROTATE_RESET:this.clickMenuViewRotateReset();break;case this.ACTION_VIEW_FLIP_HORIZONTALLY:this.clickMenuViewFlipHorizontally();break;case this.ACTION_VIEW_FULLSCREEN:this.clickMenuViewFullscreen();break;case this.ACTION_HELP_HOTKEYS:this.clickMenuHelpHotkeys()}}},{key:"clickMenuPictureNew",value:function(){confirm(t("draw.confirm_reset_canvas"))&&(this.parent_context.local_save_canvas&&this.parent_context.local_save_canvas.clear(),this.parent_context.id_kept=0,window.onbeforeunload=void 0,window.location.reload())}},{key:"clickMenuPictureSave",value:function(){this.parent_context.clickBtnSave&&this.parent_context.clickBtnSave()}},{key:"clickMenuPictureOpenKept",value:function(){this.parent_context.openKept&&this.parent_context.openKept()}},{key:"clickMenuPictureSaveKept",value:function(){this.parent_context.clickSaveKept&&this.parent_context.clickSaveKept(!0)}},{key:"clickMenuPictureSaveDisk",value:function(){this.parent_context.saveCanvasOnDisk&&this.parent_context.saveCanvasOnDisk(!0)}},{key:"clickMenuCanvasEditSize",value:function(){this.$edit_size_width.value=this.parent_context.width_canvas,this.$edit_size_height.value=this.parent_context.height_canvas,this.clearErrorEditSize(),this.dialog_canvas_edit_size.show()}},{key:"clickEditSizeBtn",value:function(){var t=parseInt(this.$edit_size_width.value),e=parseInt(this.$edit_size_height.value);this.clearErrorEditSize(),this.checkInputEditSize({width:t,height:e})&&(this.editSizeCanvas({width:t,height:e}),this.dialog_canvas_edit_size.hide())}},{key:"clearErrorEditSize",value:function(){this.$edit_size_width.classList.remove(this.CLASS_EDIT_SIZE_ERROR),this.$edit_size_height.classList.remove(this.CLASS_EDIT_SIZE_ERROR)}},{key:"checkInputEditSize",value:function(t){var e=t.width,i=t.height,r=this.parent_context.max_width_canvas,a=this.parent_context.min_width_canvas,n=this.parent_context.max_height_canvas,s=this.parent_context.min_height_canvas;return isNaN(e)||e<a||e>r?(this.$edit_size_width.classList.add(this.CLASS_EDIT_SIZE_ERROR),!1):!(isNaN(i)||i<s||i>n)||(this.$edit_size_height.classList.add(this.CLASS_EDIT_SIZE_ERROR),!1)}},{key:"editSizeCanvas",value:function(t){var e=t.width,i=t.height,r=this.parent_context.width_canvas,a=this.parent_context.height_canvas,n=Math.round((e-r)/2),s=Math.round((i-a)/2);this.parent_context.users_canvas.getMyUser().user_events.trigger(q,{crop_left:n,crop_top:s,width:e,height:i})}},{key:"clickMenuLayersAdd",value:function(){this.parent_context.users_canvas.getMyUser().events_layer.clickAddLayer()}},{key:"clickMenuLayersSafeAll",value:function(){this.parent_context.users_canvas.getMyUser().events_layer.clickSafeLayers()}},{key:"clickMenuSelectionRemove",value:function(){this.parent_context.hotkeyClearSelection&&this.parent_context.hotkeyClearSelection()}},{key:"clickMenuSelectionCut",value:function(){this.parent_context.users_canvas.getMyUser().events_layer.clickSelectionCut()}},{key:"clickMenuSelectionCopy",value:function(){this.parent_context.users_canvas.getMyUser().events_layer.clickSelectionCopy()}},{key:"clickMenuViewZoomIn",value:function(){this.parent_context.transform_canvas.clickZoomInOut(-1)}},{key:"clickMenuViewZoomOut",value:function(){this.parent_context.transform_canvas.clickZoomInOut(1)}},{key:"clickMenuViewRotateLeft",value:function(){this.parent_context.transform_canvas.clickRotateLeft()}},{key:"clickMenuViewRotateRight",value:function(){this.parent_context.transform_canvas.clickRotateRight()}},{key:"clickMenuViewRotateReset",value:function(){this.parent_context.transform_canvas.clickTransformReset()}},{key:"clickMenuViewFlipHorizontally",value:function(){this.parent_context.transform_canvas.clickFlipHorizontally()}},{key:"clickMenuViewFullscreen",value:function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen()}},{key:"clickMenuHelpHotkeys",value:function(){this.dialog_help_hotkeys.show()}}]),e}();function Lt(t,e){return Lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Lt(t,e)}function St(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lt(t,e)}function Tt(t,e){if(e&&("object"===(0,h.Z)(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Et(t){return Et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Et(t)}function It(t,e,i){return(e=u(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Ot=function(){function t(){l(this,t),It(this,"key_storage",""),It(this,"timeout_save",null),It(this,"time_timeout",1500),It(this,"cache_storage",null)}var e;return _(t,[{key:"timeoutSave",value:function(){var t=this;this.timeout_save&&clearTimeout(this.timeout_save),this.timeout_save=setTimeout((function(){t.save(),t.timeout_save=null}),this.time_timeout)}},{key:"save",value:(e=i(a().mark((function t(){var e,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getData();case 2:e=t.sent;try{i=JSON.stringify(e),window.localStorage.setItem(this.key_storage,i)}catch(t){}case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"getData",value:function(){}},{key:"getLocalData",value:function(){if(this.cache_storage)return this.cache_storage;var t;try{t=window.localStorage.getItem(this.key_storage)}catch(t){return!1}if(!t)return!1;try{return this.cache_storage=JSON.parse(t),this.cache_storage}catch(t){return!1}}},{key:"applyLocal",value:function(){var t=this.getLocalData();t&&this.setData(t)}},{key:"setData",value:function(t){}},{key:"clear",value:function(){try{window.localStorage.removeItem(this.key_storage),this.clearCache()}catch(t){}}},{key:"clearCache",value:function(){this.cache_storage=null}}]),t}();var Mt=function(t){St(a,t);var e,i,r=(e=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=Et(e);if(i){var a=Et(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return Tt(this,t)});function a(t){var e;return l(this,a),(e=r.call(this)).$box=t,e.key_storage="palette_colors",e}return _(a,[{key:"getData",value:function(){var t=this.$box.querySelectorAll(".one_clr"),e=[];return V(t).forEach((function(t){var i=t.getAttribute("data-clr");i&&e.push(i)})),e}}]),a}(Ot),Rt=function(){function t(e){var i=e.main_context,r=e.$box;l(this,t),this.main_context=i,this.$box=r,this.local_save_palette_colors=new Mt(this.$box),this.initSaveColor(),this.initHandlers()}return _(t,[{key:"initHandlers",value:function(){var t=this;this.$box.addEventListener("click",(function(e){t.clickChoiceSaveColor(e)})),this.$box.addEventListener("contextmenu",(function(e){t.clickChangeSaveColor(e)}))}},{key:"initSaveColor",value:function(){for(var t=this.local_save_palette_colors.getLocalData(),e=this.$box.querySelectorAll(".one_clr"),i=0;i<t.length;i++)e[i]&&e[i].setAttribute("data-clr",t[i]);for(var r=0;r<e.length;r++)e[r].style.backgroundColor="rgb("+e[r].getAttribute("data-clr")+")"}},{key:"clickChoiceSaveColor",value:function(t){var e=t.target;if(e.classList.contains("one_clr")){var i=e.getAttribute("data-clr");i&&this.main_context.color_picker.setColorRgb(i)}}},{key:"clickChangeSaveColor",value:function(t){t.preventDefault();var e=t.target;if(e.classList.contains("one_clr")){var i=this.main_context.config_tools.getOnlyColor();e.setAttribute("data-clr",i),e.style.backgroundColor="rgb("+i+")"}this.local_save_palette_colors&&this.local_save_palette_colors.timeoutSave()}},{key:"getOneColor",value:function(t){var e=this.$box.querySelectorAll(".one_clr")[t];return e&&e.getAttribute("data-clr")||!1}}]),t}(),Pt=function(){function t(e){var i=e.main_context,r=e.$box_vertical,a=e.$box_horizontal;l(this,t),this.main_context=i,this.$box_vertical=r,this.$box_horizontal=a,this.$line_box_vertical=this.$box_vertical.querySelector(".js--scrollbar-line-box"),this.$line_box_horizontal=this.$box_horizontal.querySelector(".js--scrollbar-line-box"),this.CLASS_LINE_ACTIVE="scrollbar-canvas__line-box--active",this.offsets={x:0,y:0},this.visible_range={w:1,h:1},this.min={w:0,h:0},this.max={w:1,h:1},this.last_coords={x:0,y:0},this.updateValues(),this.initHandlers()}return _(t,[{key:"initHandlers",value:function(){var t=this;(0,n.aM)(this.$line_box_vertical,"down",(function(e){t.downLineBox(e,!0)})),(0,n.aM)(this.$line_box_horizontal,"down",(function(e){t.downLineBox(e,!1)}))}},{key:"downLineBox",value:function(t,e){var i=this,r=this.getCoordsScroll(t,e);this.setLastCoords(e,r),this.toggleLineActive(e,!0),(0,n.Io)(document,(function(t){i.moveLineBox(t,e)}),(function(t){i.upLineBox(t,e)}))}},{key:"moveLineBox",value:function(t,e){var i=this.getCoordsScroll(t,e),r=this.getDiffValue(e,i),a=this.getOffsets(e),n=this.getVisibleRange(e),s=this.getMin(e),o=this.getMax(e),c=this.getSizeBar(e),l=a+r*(o-s)/(c-n/(o-s)*c);l=Math.min(Math.max(l,s),o),this.setLastCoords(e,i),this.updateBar(e);var h={};h[e?"y":"x"]=-1*l,this.main_context.transform_canvas.setOffsets(h)}},{key:"setLastCoords",value:function(t,e){var i=t?"y":"x";this.last_coords[i]=e[i]}},{key:"getLastOffsets",value:function(t){var e=t?"y":"x";return this.last_coords[e]}},{key:"getDiffValue",value:function(t,e){return e[t?"y":"x"]-this.getLastOffsets(t)}},{key:"upLineBox",value:function(t,e){this.toggleLineActive(e,!1)}},{key:"toggleLineActive",value:function(t,e){this.getLineElem(t).classList.toggle(this.CLASS_LINE_ACTIVE,e)}},{key:"getCoordsScroll",value:function(t,e){var i=this.getBoxElem(e);return(0,n.Sz)(t,i)}},{key:"getMaxPosition",value:function(t){var e=this.getBoxElem(t),i=this.getLineElem(t),r=t?"offsetHeight":"offsetWidth";return e[r]-i[r]}},{key:"getSizeBar",value:function(t){var e=t?"offsetHeight":"offsetWidth";return this.getBoxElem(t)[e]}},{key:"getLineElem",value:function(t){return t?this.$line_box_vertical:this.$line_box_horizontal}},{key:"getBoxElem",value:function(t){return t?this.$box_vertical:this.$box_horizontal}},{key:"setLineScroll",value:function(t,e){var i=t?"top":"left";this.getLineElem(t).style[i]=e+"px"}},{key:"setLineSize",value:function(t,e){var i=t?"height":"width";this.getLineElem(t).style[i]=e+"px"}},{key:"updateBar",value:function(t){var e=this.getOffsets(t),i=this.getVisibleRange(t),r=this.getMin(t),a=this.getMax(t),n=this.getSizeBar(t),s=i/(a-r)*n,o=(e-r)/(a-r)*(n-s);this.setLineSize(t,s),this.setLineScroll(t,o)}},{key:"updateValues",value:function(){var t=this.main_context.transform_canvas.getOffsets(),e=this.main_context.work_canvas.getSizeCanvas(),i=this.main_context.transform_canvas.getVisibleArtArea();this.updateValuesScroll(!0,i.y,i.height,e.height,t.y),this.updateValuesScroll(!1,i.x,i.width,e.width,t.x)}},{key:"updateValuesScroll",value:function(t,e,i,r,a){var n=e-r-a+r/3,s=e+i-a-r/3;r=Math.min(r,i),this.setOffsets(t,-1*a),this.setVisibleRange(t,r),this.setMin(t,n),this.setMax(t,s),this.updateBar(t)}},{key:"setOffsets",value:function(t,e){var i=t?"y":"x";this.offsets[i]=e}},{key:"getOffsets",value:function(t){var e=t?"y":"x";return this.offsets[e]}},{key:"setVisibleRange",value:function(t,e){var i=t?"h":"w";this.visible_range[i]=e}},{key:"getVisibleRange",value:function(t){var e=t?"h":"w";return this.visible_range[e]}},{key:"setMin",value:function(t,e){var i=t?"h":"w";this.min[i]=e}},{key:"getMin",value:function(t){var e=t?"h":"w";return this.min[e]}},{key:"setMax",value:function(t,e){var i=t?"h":"w";this.max[i]=e}},{key:"getMax",value:function(t){var e=t?"h":"w";return this.max[e]}}]),t}(),Dt=function(){function t(e){var i=e.main_context;l(this,t),this.main_context=i,this.$canvas_cursor=null,this.ctx_cursor=null,this.position_cursor={x:0,y:0},this.is_visible=!1}return _(t,[{key:"init",value:function(){this.createCursor(),this.initHandlers()}},{key:"initHandlers",value:function(){var t=this,e=this.main_context.users_canvas.getMyUser().user_events;e.listener(p,(function(e){t.moveBrushCursor(e)})),e.listener(g,(function(e){t.hideBrushCursor(e)})),e.listener(f,(function(e){t.moveBrushCursor(e)}))}},{key:"moveBrushCursor",value:function(t){var e=this.main_context.transform_canvas.coordsToDisplayInt(t),i=this.checkVisibleBrushCursor();this.setIsVisible(i),this.setPositionCursor(e),this.drawCursor(),i&&this.main_context.updateArtCanvas()}},{key:"hideBrushCursor",value:function(t){this.setIsVisible(!1),this.main_context.updateArtCanvas()}},{key:"checkVisibleBrushCursor",value:function(){return!this.main_context.users_canvas.getMyUser().tools_draw.getTool().cursor}},{key:"createCursor",value:function(){this.$canvas_cursor=document.createElement("canvas"),this.ctx_cursor=this.$canvas_cursor.getContext("2d")}},{key:"getCanvasCursor",value:function(){return this.$canvas_cursor}},{key:"getPositionCursor",value:function(){return this.position_cursor}},{key:"setPositionCursor",value:function(t){this.position_cursor=t}},{key:"getSizeCursor",value:function(){var t=this.main_context.transform_canvas.getZoom(),e=this.main_context.config_tools.getParamTool("line_width")*t+4;return e<1&&(e=1),e}},{key:"getIsVisible",value:function(){return this.is_visible}},{key:"setIsVisible",value:function(t){this.is_visible=!!t}},{key:"drawCursor",value:function(){var t=this.getSizeCursor(),e=Math.round(t/2),i=this.ctx_cursor;this.$canvas_cursor.width=t,this.$canvas_cursor.height=t,i.lineWidth=1,i.beginPath(),i.strokeStyle="rgba(255,255,255,0.3)",i.arc(e,e,e-2,0,2*Math.PI),i.stroke(),i.closePath();var r=e<1?1:e,a=r-3<1?1:r-3;i.beginPath(),i.strokeStyle="rgba(0,0,0,0.3)",i.arc(r,r,a,0,2*Math.PI),i.stroke(),i.closePath()}}]),t}(),Nt=function(){function t(){l(this,t),It(this,"is_lock",!1),It(this,"current_action",""),It(this,"action_events",{})}return _(t,[{key:"getIsLock",value:function(){return this.is_lock}},{key:"setIsLock",value:function(t){this.is_lock=!!t}},{key:"getCurrentAction",value:function(){return this.current_action}},{key:"setCurrentAction",value:function(t){this.current_action=t}},{key:"checkExistAction",value:function(t){return!!this.action_events[t]}},{key:"registerAction",value:function(t,e){this.action_events[t]=e}},{key:"getAction",value:function(t){return this.action_events[t]}},{key:"trigger",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!!this.checkExistAction(t)&&!(this.getIsLock()&&!this.checkRepeatPromiseAction(t))&&this.doAction(t,e)}},{key:"checkRepeatPromiseAction",value:function(t){var e=this.getAction(t),i=this.getCurrentAction();return!!e.is_promise&&t===i}},{key:"doAction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.setCurrentAction(t),this.getAction(t).is_promise?this.doActionPromise(t,e):this.doActionSimple(t,e)}},{key:"doActionSimple",value:function(t,e){this.setIsLock(!0);var i=this.getAction(t);try{i.event(e)}catch(t){}return this.setIsLock(!1),!0}},{key:"doActionPromise",value:function(t,e){var i=this;this.setIsLock(!0);var r=this.getAction(t),a=new Promise((function(t){r.event(e,t)}));return a.then((function(){i.setIsLock(!1)})).catch((function(){i.setIsLock(!1)})),a}}]),t}(),zt=function(){function t(e){var i=e.main_context,r=e.$bot_panel;l(this,t),this.main_context=i,this.$bot_panel=r}return _(t,[{key:"init",value:function(){this.registerUserActions(),this.initElems(),this.initHandlers()}},{key:"initElems",value:function(){this.$abort_history=this.$bot_panel.querySelector(".js--abort-history"),this.$repeat_history=this.$bot_panel.querySelector(".js--repeat-history")}},{key:"initHandlers",value:function(){var t=this.main_context.user_actions;this.$abort_history.addEventListener("click",(function(){t.trigger(mt)})),this.$repeat_history.addEventListener("click",(function(){t.trigger(xt)}))}},{key:"registerUserActions",value:function(){var t=this.main_context.user_actions,e=this.main_context.users_canvas.getMyUser().user_events;t.registerAction(mt,{event:function(){e.trigger(w)}}),t.registerAction(xt,{event:function(){e.trigger(C)}})}}]),t}(),Bt="circle",Ut="square",Ht="star",$t="heart",qt="horizontal-lines",Kt="vertical-lines",jt="small-squares",Vt="big-squares",Wt="cross-lines",Ft="bristles",Yt="chalk",Gt="fluff",Zt="blot",Jt="crumb";var Qt=function(t){St(a,t);var e,i,r=(e=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=Et(e);if(i){var a=Et(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return Tt(this,t)});function a(t){var e;return l(this,a),(e=r.call(this)).parent_context=t,e.key_storage="config_brush",e.cache_storage=null,e.applyLocal(),e}return _(a,[{key:"getData",value:function(){var t=this.parent_context.users_canvas.getMyUser().tools_draw.tools,e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=Object.assign({},t[i].values));return e}},{key:"getLocalConfig",value:function(t,e){var i=this.getLocalData();if(!i||!i[t])return e;var r=i[t];for(var a in e)e.hasOwnProperty(a)&&void 0===r[a]&&(r[a]=e[a]);return r}},{key:"setData",value:function(t){var e=this.parent_context.users_canvas.getMyUser().tools_draw.tools;for(var i in t)t.hasOwnProperty(i)&&e[i]&&(e[i].values=Object.assign(e[i].values,t[i]))}}]),a}(Ot),Xt=function(){function t(e){var i=e.main_context;l(this,t),It(this,"configs_drawing",{color:"0,0,0"}),this.main_context=i}return _(t,[{key:"init",value:function(){this.initElems(),this.initHandlers(),this.initLocalSave()}},{key:"initElems",value:function(){this.$cont_tools=document.getElementById("cont_tools"),this.$cont_config=document.getElementById("cont_config"),this.$sliders=this.$cont_config.getElementsByClassName("move_slider"),this.$close_dialog_texture_sub=document.querySelector(".js--close-dialog-texture-sub"),this.dialog_texture_sub=(0,n.ON)("dialog-texture-sub",{width:400})}},{key:"initLocalSave",value:function(){this.local_save_config_brush=new Qt(this.main_context)}},{key:"initHandlers",value:function(){var t=this;this.$cont_tools.addEventListener("click",(function(e){t.clickContTools(e)}));for(var e=0;e<this.$sliders.length;e++)this.initHandlersSlider(this.$sliders[e]);(0,n.dQ)("click",this.$cont_config,"js--pressure-checkbox",(function(e){t.clickPressureCheckbox(e)})),(0,n.dQ)("click",this.$cont_config,"js--texture-btn",(function(e){t.clickTextureBrush(e)})),document.addEventListener("click",(function(e){t.clickOutOfTexture(e)})),(0,n.dQ)("click",this.$cont_config,"texture-list__item",(function(e){t.clickTextureItem(e)})),this.$close_dialog_texture_sub.addEventListener("click",(function(){t.dialog_texture_sub.hide()}))}},{key:"initHandlersSlider",value:function(t){var e=this;(0,n.aM)(t,"down",(function(i){e.mouseDownSlider(i,t)})),t.addEventListener("wheel",(function(i){e.wheelSlider(i,t)}))}},{key:"clickOutOfTexture",value:function(t){var e=this;t.target.closest(".texture-choice")||document.querySelectorAll(".texture-choice__window").forEach((function(t){e.toggleTextureWindow(t,!1)}))}},{key:"clickContTools",value:function(t){var e=t.target;e.classList.contains("one_tool")&&this.selectTool(e.getAttribute("data-tool"))}},{key:"clickPressureCheckbox",value:function(t){var e=!t.classList.contains("pressure-checkbox--checked"),i=t.getAttribute("data-conf"),r=t.closest(".one_config").getAttribute("data-conftool");this.setConfTool(r,i,e),this.togglePressureCheckbox(t,e)}},{key:"togglePressureCheckbox",value:function(t,e){t.classList.toggle("pressure-checkbox--checked",e);var i=t.closest(".one_config"),r="";switch(t.getAttribute("data-type-pressure")){case"size":r="js--slider-min-size";break;case"density":r="js--slider-min-density"}var a=i.querySelector("."+r);a&&a.classList.toggle("hidden",!e)}},{key:"clickTextureBrush",value:function(t){var e=t.closest(".texture-choice");if(e){var i=e.querySelector(".texture-choice__window");if(i){var r=i.classList.contains("hidden");this.toggleTextureWindow(i,r)}}}},{key:"toggleTextureWindow",value:function(t,e){t.classList.toggle("hidden",!e)}},{key:"clickTextureItem",value:function(t){var e=t.closest(".texture-list__item");if(e){var i=e.closest(".one_config");if(i){var r=i.querySelector(".texture-choice"),a=r.querySelector(".texture-choice__window"),n=i.getAttribute("data-conftool"),s=e.getAttribute("data-texture-type");this.checkAccessSubTexture(s)?(this.setConfTool(n,"texture",s),this.toggleTextureWindow(a,!1),this.choiceCurrentTexture(r,s)):this.showDialogTextureSub(a)}}}},{key:"checkAccessSubTexture",value:function(t){return!![Bt,Ut,Ht,$t].includes(t)||!!this.main_context.is_privilege}},{key:"showDialogTextureSub",value:function(t){this.toggleTextureWindow(t,!1),this.dialog_texture_sub.show()}},{key:"choiceCurrentTexture",value:function(t,e){var i=t.querySelector(".js--texture-btn");i&&i.setAttribute("data-texture-type",e),t.querySelectorAll(".texture-list__item").forEach((function(t){t.classList.remove("texture-list__item--active")}));var r=t.querySelector('.texture-list__item[data-texture-type="'+e+'"]');r&&r.classList.add("texture-list__item--active")}},{key:"selectTool",value:function(t){if(this.main_context.users_canvas.getMyUser().tools_draw.checkExistsTool(t)){var e=document.querySelector('.one_tool[data-tool="'+t+'"]');if(this.main_context.user_actions.trigger(wt,{name_tool:t})){for(var i=this.$cont_tools.getElementsByClassName("active_tool"),r=0;r<i.length;r++)i[r].classList.remove("active_tool");e.classList.add("active_tool"),this.setConfigsTool(t)}}}},{key:"setConfigsTool",value:function(t){for(var e=this,i=this,r=this.$cont_config.getElementsByClassName("active_config"),a=0;a<r.length;a++)r[a].classList.remove("active_config");var n=this.$cont_config.querySelector('div[data-conftool="'+t+'"]');if(n){n.classList.add("active_config");var s,o,c,l,h=n.getElementsByClassName("move_slider"),u=this.main_context.users_canvas.getMyUser().tools_draw.getTool();for(a=0;a<h.length;a++)s=this.getWidthSlider(h[a]),c=h[a].getAttribute("data-conf"),o=this.getMaxValConf(c),l=u.values[c]/o*s,this.sliderMove({x:l},h[a],function(e){return function(r){i.setConfTool(t,e,r)}}(c));n.querySelectorAll(".pressure-checkbox").forEach((function(i){var r=i.getAttribute("data-conf"),a=u.values[r];e.setConfTool(t,r,a),e.togglePressureCheckbox(i,a)}));var A=n.querySelector(".texture-choice");if(A){var _="texture",y=u.values[_];this.checkAccessSubTexture(y)||(y=Bt),this.setConfTool(t,_,y),this.choiceCurrentTexture(A,y)}}}},{key:"getMaxValConf",value:function(t){return"angle"===t?180:"stabilization"===t?15:100}},{key:"setConfTool",value:function(t,e,i){var r=this.main_context.users_canvas.getMyUser();r.tools_draw.checkExistsTool(t)&&(r.tools_draw.getToolByName(t).values[e]=i,"opacity"==e?this.setOpacity(i):this.setParamTool(e,i),this.local_save_config_brush.timeoutSave())}},{key:"mouseDownSlider",value:function(t,e){var i=this,r=(0,n.Sz)(t,e),a=e.getAttribute("data-conf"),s=e.parentNode.parentNode.getAttribute("data-conftool");this.sliderMove(r,e),(0,n.aM)(document,"move",(function(t){var r=(0,n.Sz)(t,e);i.sliderMove(r,e)}),!0),(0,n.aM)(document,"up",(function(t){var r=(0,n.Sz)(t,e);i.sliderMove(r,e,(function(t){i.setConfTool(s,a,t)})),(0,n._M)(document,"move",(function(){}),!0),(0,n._M)(document,"up",(function(){}),!0)}),!0)}},{key:"selectValueTool",value:function(t,e,i){if(this.main_context.users_canvas.getMyUser().tools_draw.checkExistsTool(t)){var r=this,a=document.querySelector('.one_config[data-conftool="'+t+'"]').querySelector('.move_slider[data-conf="'+e+'"]'),n=this.getWidthSlider(a),s=this.getMaxValConf(e),o=i/s*n;i<0||i>s||this.sliderMove({x:o},a,(function(i){r.setConfTool(t,e,i)}))}}},{key:"getWidthSlider",value:function(t){var e,i=window.getComputedStyle(t).getPropertyValue("width");if(-1!==i.indexOf("%")){var r=t.closest(".one_config");if(!r)return 0;e=r.offsetWidth*(parseInt(i)/100)}else e=parseInt(i);return e}},{key:"sliderMove",value:function(t,e,i){var r=e.getAttribute("data-conf"),a=e.querySelector(".cur_slider"),n=e.querySelector(".val_slider"),s=t.x,o=this.getWidthSlider(e),c=this.getMaxValConf(r),l=Math.round(s/o*c);l<1?(l=1,s=Math.round(o/c*l)):l>c&&(l=c,s=o),n.innerHTML=l,s<1?s=1:s>o&&(s=o),a.style.width=Math.round(s/o*100)+"%",i&&i(l)}},{key:"wheelSlider",value:function(t,e){t.preventDefault();var i,r=this,a=t.deltaY,n=e.querySelector(".val_slider"),s=parseInt(n.innerHTML),o=e.getAttribute("data-conf"),c=e.parentNode.parentNode.getAttribute("data-conftool"),l=this.getMaxValConf(o),h=l>100?2:1,u=this.getWidthSlider(e);i=a<0?s+h:s-h;var A=Math.round(i/l*u);this.sliderMove({x:A},e,(function(t){r.setConfTool(c,o,t)}))}},{key:"getColor",value:function(){return"rgba("+this.configs_drawing.color+","+this.configs_drawing.opacity+")"}},{key:"getOnlyColor",value:function(){return this.configs_drawing.color}},{key:"setColor",value:function(t){t&&(this.configs_drawing.color=t)}},{key:"getParamTool",value:function(t){return this.configs_drawing[t]}},{key:"setParamTool",value:function(t,e){void 0!==e&&(this.configs_drawing[t]=e)}},{key:"setOpacity",value:function(t){void 0!==t&&(t/=100,this.configs_drawing.opacity=t,this.main_context.color_picker&&this.main_context.color_picker.setOpacityColor(t))}},{key:"getConfigsDrawing",value:function(){return this.configs_drawing}}]),t}(),te=function(){function t(){l(this,t),It(this,"listener_callback",{}),It(this,"listener_all_callbacks",[])}return _(t,[{key:"trigger",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];this.doCallback.apply(this,[t].concat(i)),this.doAllCallback.apply(this,[t].concat(i))}},{key:"listener",value:function(t,e){var i=this.getCallbacks(t);"function"==typeof e&&i.push(e)}},{key:"listenerAll",value:function(t){var e=this.getAllCallbacks();"function"==typeof t&&e.push(t)}},{key:"getAllCallbacks",value:function(){return this.listener_all_callbacks}},{key:"getCallbacks",value:function(t){return this.listener_callback[t]||(this.listener_callback[t]=[]),this.listener_callback[t]}},{key:"doCallback",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];this.getCallbacks(t).forEach((function(t){try{t.apply(void 0,i)}catch(t){window.scriptError(t)}}))}},{key:"doAllCallback",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];this.getAllCallbacks().forEach((function(e){try{e.apply(void 0,[t].concat(i))}catch(t){window.scriptError(t)}}))}}]),t}(),ee=function(){function t(e){var i=e.main_context,r=e.user_context;l(this,t),this.main_context=i,this.user_context=r}return _(t,[{key:"init",value:function(){var t=this,e=this.user_context.user_events;e.listener(m,(function(e){t.startDraw(e)})),e.listener(x,(function(e){t.moveDraw(e)})),e.listener(k,(function(e){t.finishDraw(e)})),e.listener(b,(function(){t.resetSelection()})),e.listener(L,(function(e){t.setTransformArea(e)})),e.listener(q,(function(e){t.resizeCanvas(e)}))}},{key:"startDraw",value:function(t){var e=t.name_tool,i=t.coords,r=t.configs_drawing,a=t.index_layer;this.user_context.tools_draw.setCurTool({name_tool:e});var n=this.user_context.tools_draw.getToolByName(e);n&&(this.user_context.user_layers.setActiveLayer(a),n.tool.startDraw(i,r))}},{key:"moveDraw",value:function(t){var e=t.name_tool,i=t.coords,r=this.user_context.tools_draw.getToolByName(e);r&&r.tool.moveDraw(i)}},{key:"finishDraw",value:function(t){var e=t.name_tool,i=t.coords,r=this.user_context.tools_draw.getToolByName(e);r&&r.tool.finishDraw(i)}},{key:"resetSelection",value:function(){var t=this.getSelectionTool();t&&t.reset()}},{key:"setTransformArea",value:function(t){var e=this.user_context.tools_draw.getToolByName(J);e&&e.tool.setTransformArea(t)}},{key:"getNameSelectionTool",value:function(){var t=this.getSelectionTool();return!!t&&t.getName()}},{key:"getSelectionTool",value:function(){var t=this.user_context.tools_draw.tools[G];if(t){var e=t.tool;if(e.points_selection.length)return e}var i=this.user_context.tools_draw.tools[Z];if(i){var r=i.tool;if(r.points_selection.length)return r}return!1}},{key:"getSelectionPoints",value:function(){var t=this.getSelectionTool();return!!t&&t.points_selection}},{key:"setSelectionPoints",value:function(t,e){var i=this.user_context.tools_draw.getToolByName(t);i&&e&&(i.tool.points_selection=e)}},{key:"setDraw",value:function(){this.user_context.events_history.saveHistory()}},{key:"setCursor",value:function(t){this.user_context.checkMyUser()&&this.main_context.setCursorLayers(t)}},{key:"resizeCanvas",value:function(t){var e=t.crop_left,i=t.crop_top,r=t.width,a=t.height,n=this.main_context.width_canvas,s=this.main_context.height_canvas,o=this.main_context.resizeCanvas({crop_left:e,crop_top:i,width_canvas:r,height_canvas:a});this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_CROP_LAYER,data_action:{crop_left:e,crop_top:i,width_canvas:r,height_canvas:a,old_width_canvas:n,old_height_canvas:s,data_layers:o}})}}]),t}();function ie(){At.apply(this,arguments)}function re(){At.apply(this,arguments)}function ae(){At.apply(this,arguments)}function ne(){At.apply(this,arguments)}function se(){At.apply(this,arguments),this.init()}function oe(){se.apply(this,arguments)}function ce(){At.apply(this,arguments),this.init()}function le(){At.apply(this,arguments)}function he(){At.apply(this,arguments),this.init()}function ue(){At.apply(this,arguments)}function Ae(){At.apply(this,arguments)}ie.prototype=Object.create(At.prototype),ie.prototype.start=function(t){this.ctx;var e=this.canva;this.user_context.events_draw.setCursor("grabbing"),this.start_coords=e.transform_canvas.coordsToDisplayInt(t),this.start_offsets=Object.assign({},e.transform_canvas.getOffsets())},ie.prototype.move=function(t){this.ctx;var e=this.canva,i=e.transform_canvas.coordsToDisplayInt(t),r=this.start_offsets.x-(this.start_coords.x-i.x),a=this.start_offsets.y-(this.start_coords.y-i.y);e.transform_canvas.setOffsets({x:r,y:a})},ie.prototype.finish=function(t){this.user_context.events_draw.setCursor("grab")},re.prototype=Object.create(At.prototype),re.prototype.start=function(t){this.stabilization=this.getConfigTool("stabilization"),this.points=[t],this.draw()},re.prototype.move=function(t){this.points.push(t),this.draw()},re.prototype.draw=function(){this.drawSpacing(this.stabilization)},re.prototype.drawPoint=function(t){var e=this.getPressureLineWidth(t),i=this.ctx,r=e/2,a=t.x,n=t.y,s=this.getPressureDensity(t);i.fillStyle=r<1?this.getColorDensity(s):this.getRadialGradient(a,n,r,s),i.beginPath(),i.arc(a,n,r,0,2*Math.PI),i.fill()},re.prototype.renderCanvas=function(){if(this.$canvas_source.width&&this.$canvas_source.height&&this.$canvas_over.width&&this.$canvas_over.height){var t=this.obj_layer.$layer,e=t.width,i=t.height,r=this.obj_layer.ctx;r.clearRect(0,0,e,i),r.drawImage(this.$canvas_source,0,0,e,i);var a=r.globalCompositeOperation;r.globalCompositeOperation="destination-out",r.drawImage(this.$canvas_over,0,0,e,i),r.globalCompositeOperation=a}},re.prototype.finish=function(t){this.tmp_layer=null,this.user_context.events_draw.setDraw()},ae.prototype=Object.create(At.prototype),ae.prototype.start=function(t){this.getColor(t)},ae.prototype.getColor=function(t){var e=this.canva,i=e.art_canvas.ctx_canvas.getImageData(t.x,t.y,1,1),r=i.data[0]+","+i.data[1]+","+i.data[2]+","+i.data[3],a=[255,255,255,255],n=r.split(","),s=n[3]/255;r=(1-s)*a[0]+s*n[0]+","+((1-s)*a[1]+s*n[1])+","+((1-s)*a[2]+s*n[2])+","+s,e.color_picker.setColorRgb(r)},ae.prototype.move=function(t){this.getColor(t)},ae.prototype.finish=function(t){},ne.prototype=Object.create(At.prototype),ne.prototype.start=function(t){},ne.prototype.move=function(t){},ne.prototype.finish=function(t){if(t){this.canva;var e=this.obj_layer.ctx;if(this.pixel_stack=[[t.x,t.y]],this.image_data=e.getImageData(0,0,e.canvas.width,e.canvas.height),this.new_image_data=e.createImageData(e.canvas.width,e.canvas.height),this.old_color=this.getPixel(t.x,t.y),this.tolerance=Math.floor(this.getConfigTool("tolerance")),this.fill_color=this.getConfigTool("color").split(","),this.fill_color.push(Math.round(255*this.getConfigTool("opacity"))),!this.colorsMatch(this.old_color,this.fill_color,this.tolerance)){this.floodFill();var i=document.createElement("canvas");i.width=this.$canvas_over.width,i.height=this.$canvas_over.height,i.getContext("2d").putImageData(this.new_image_data,0,0),this.ctx_canvas_over.drawImage(i,0,0),this.renderCanvas(),this.user_context.events_draw.setDraw()}}},ne.prototype.colorsMatch=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t[0]==e[0]&&t[1]==e[1]&&t[2]==e[2]&&t[3]==e[3]||this.checkTolerance(t,e,i)},ne.prototype.checkTolerance=function(t,e,i){var r=Math.abs(t[0]-e[0]),a=Math.abs(t[1]-e[1]),n=Math.abs(t[2]-e[2]),s=Math.abs(t[3]-e[3]);return Math.pow(r*r+a*a+n*n+s*s,.5)<=Math.pow(i*i*4,.5)},ne.prototype.getOffset=function(t,e){return 4*(e*this.image_data.width+t)},ne.prototype.getPixel=function(t,e){var i=this.getOffset(t,e),r=this.image_data.data;return[r[i],r[i+1],r[i+2],r[i+3]]},ne.prototype.setPixel=function(t,e,i){var r=this.getOffset(t,e);this.image_data.data[r]=i[0],this.image_data.data[r+1]=i[1],this.image_data.data[r+2]=i[2],this.image_data.data[r+3]=i[3],this.new_image_data.data[r]=i[0],this.new_image_data.data[r+1]=i[1],this.new_image_data.data[r+2]=i[2],this.new_image_data.data[r+3]=i[3]},ne.prototype.floodFill=function(){for(var t,e,i,r,a=0;this.pixel_stack.length>0;){if(++a>5e3){console.log("slowwww",a);break}e=(t=this.pixel_stack.pop())[0],i=t[1],r=this.getBottomBorder(e,i,this.tolerance),r=this.entryFromBotToTop(e,r,this.tolerance)}},ne.prototype.getBottomBorder=function(t,e,i){for(var r=e;r>=0&&this.colorsMatch(this.getPixel(t,r),this.old_color,i);)r--;return++r},ne.prototype.entryFromBotToTop=function(t,e,i){for(var r=0,a=0;e<this.image_data.height&&this.colorsMatch(this.getPixel(t,e),this.old_color,i);)this.setPixel(t,e,this.fill_color),0===r&&t>0&&this.colorsMatch(this.getPixel(t-1,e),this.old_color,i)?(this.pixel_stack.push([t-1,e]),r=1):1===r&&t>0&&!this.colorsMatch(this.getPixel(t-1,e),this.old_color,i)&&(r=0),0===a&&t<this.image_data.width-1&&this.colorsMatch(this.getPixel(t+1,e),this.old_color,i)?(this.pixel_stack.push([t+1,e]),a=1):1===a&&t<this.image_data.width&&!this.colorsMatch(this.getPixel(t+1,e),this.old_color,i)&&(a=0),e++;return e},se.prototype=Object.create(At.prototype),se.prototype.init=function(){this.points_selection=[],this.is_visible=!0,this.user_context.checkMyUser()&&this.createCanvasSelection()},se.prototype.getName=function(){return G},se.prototype.createCanvasSelection=function(){this.$layer=document.createElement("canvas"),this.ctx_selection=this.$layer.getContext("2d"),this.updateSizeLayer()},se.prototype.updateSizeLayer=function(){var t=this.canva.drawing_area.getSizeContainerWork(),e=t.width,i=t.height;this.$layer.width=e,this.$layer.height=i},se.prototype.choice=function(t){var e=this.user_context.events_draw.getSelectionTool();e&&!t&&e.reset(),this.user_context.checkMyUser()&&(this.updateSizeLayer(),this.points_selection.length&&this.drawLines(this.points_selection))},se.prototype.getCanvas=function(){return this.$layer},se.prototype.start=function(t){this.points_selection=[],this.start_coords=t},se.prototype.move=function(t){this.draw(t)},se.prototype.draw=function(t){t=this.processCoords(t);var e=this.start_coords,i={x:t.x,y:this.start_coords.y},r=t,a={x:this.start_coords.x,y:t.y};this.points_selection=[e,i,r,a,e],this.drawLines(this.points_selection)},se.prototype.processCoords=function(t){var e=t.x,i=t.y,r=this.ctx.canvas.width,a=this.ctx.canvas.height;return e<0&&(e=0),i<0&&(i=0),e>r&&(e=r),i>a&&(i=a),{x:e,y:i}},se.prototype.reset=function(){this.clearCanvas(),this.clearPoints()},se.prototype.clearCanvas=function(){this.user_context.checkMyUser()&&this.ctx_selection.clearRect(0,0,this.$layer.width,this.$layer.height)},se.prototype.clearPoints=function(){this.points_selection=[]},se.prototype.drawLines=function(t){if(this.user_context.checkMyUser()){var e,i=this.scalePointsSelection(t);this.clearCanvas(),e=0,this.drawColorLines(i,8,e,"rgba(0,0,0,1)"),e=-8,this.drawColorLines(i,8,e,"rgba(255,255,255,1)")}},se.prototype.scalePointsSelection=function(t){for(var e=[],i=0;i<t.length;i++){var r=this.canva.transform_canvas.coordsToDisplayInt(t[i]);e.push(r)}return e},se.prototype.setIsVisible=function(t){this.is_visible=!!t},se.prototype.startMoveSelection=function(t){this.start_coords=t,this.start_points=[];for(var e=0;e<this.points_selection.length;e++)this.start_points.push(Object.assign({},this.points_selection[e]))},se.prototype.moveSelection=function(t){for(var e=this.start_coords.x-t.x,i=this.start_coords.y-t.y,r=0;r<this.points_selection.length;r++){var a=this.points_selection[r],n=this.start_points[r];a.x=n.x-e,a.y=n.y-i}this.drawLines(this.points_selection)},se.prototype.startResizeSelection=function(){this.clearCanvas(),this.setIsVisible(!1)},se.prototype.resizeSelection=function(t,e){for(var i=Math.abs(e.width/t.width),r=Math.abs(e.height/t.height),a=[],n=!1,s=!1,o=0;o<this.points_selection.length;o++){var c=this.points_selection[o],l=c.x*i,h=c.y*r;a.push({x:l,y:h}),(!1===n||l<n)&&(n=l),(!1===s||h<s)&&(s=h)}for(var u=e.width<0?Math.abs(e.width):0,A=e.height<0?Math.abs(e.height):0,_=n-t.x-(e.x-t.x)+u,y=s-t.y-(e.y-t.y)+A,d=0;d<a.length;d++){var v=a[d];v.x=v.x-_,v.y=v.y-y}this.points_selection=a,this.drawLines(this.points_selection),this.setIsVisible(!0)},se.prototype.drawColorLines=function(t,e,i,r){var a,n=this.ctx_selection;n.beginPath(),n.lineWidth=1,n.setLineDash([e,e]),n.strokeStyle=r,n.lineDashOffset=i,a=t[0],n.moveTo(a.x+.5,a.y+.5);for(var s=1;s<t.length;s++)n.lineTo(t[s].x+.5,t[s].y+.5),a=t[s];n.stroke(),n.closePath()},se.prototype.finish=function(t){this.is_draw.move||this.reset(),this.user_context.events_draw.setDraw()},oe.prototype=Object.create(se.prototype),oe.prototype.getName=function(){return Z},oe.prototype.start=function(t){this.points_selection=[],this.start_coords=t},oe.prototype.draw=function(t){t=this.processCoords(t),this.points_selection.push(t),this.drawLines(this.points_selection)},oe.prototype.finish=function(){this.is_draw.move&&(this.points_selection.push(this.start_coords),this.drawLines(this.points_selection)),se.prototype.finish.apply(this,arguments)},ce.prototype=Object.create(At.prototype),ce.prototype.startDraw=function(){},ce.prototype.moveDraw=function(){},ce.prototype.finishDraw=function(){},ce.prototype.init=function(){this.points_area=[],this.rect_path={},this.$transform_layer=null,this.index_transform_layer=null,this.rect_area={},this.start_rect_area=null,this.$transform_source=null,this.is_active=!1,this.is_down_area=!1,this.is_shift_key=!1,this.user_context.checkMyUser()&&(this.createCanvasTransform(),this.initHandlers())},ce.prototype.choice=function(t){if(this.is_active=!0,!t){var e=this.calcRectArea();this.setStartRectArea(e),this.setRectArea(e)}this.user_context.checkMyUser()&&(this.drawArea(),this.canva.updateArtCanvas())},ce.prototype.unchoice=function(t){this.is_active=!1,t||this.setTransform()},ce.prototype.getCanvas=function(){return this.$layer},ce.prototype.calcRectArea=function(){var t,e,i,r,a=this.getSelectionArea();return a?(t=a.x,e=a.y,i=a.width,r=a.height):(t=0,e=0,i=this.canva.width_canvas,r=this.canva.height_canvas),{x:t,y:e,width:i,height:r,radians:0}},ce.prototype.setRectArea=function(t){this.rect_area=Object.assign({},t)},ce.prototype.setStartRectArea=function(t){this.start_rect_area=Object.assign({},t)},ce.prototype.setIndexTransformLayer=function(t){this.index_transform_layer=t},ce.prototype.getSelectionArea=function(){var t=this.user_context.events_draw.getSelectionPoints();if(!t||!t.length)return!1;for(var e=t[0],i=e.x,r=e.y,a=e.x,n=e.y,s=1;s<t.length;s++)(e=t[s]).x>i&&(i=e.x),e.y>r&&(r=e.y),e.x<a&&(a=e.x),e.y<n&&(n=e.y);return{x:a,y:n,width:i-a,height:r-n}},ce.prototype.setTransform=function(){this.$transform_layer=null,this.clearArea(),this.canva.updateArtCanvas()},ce.prototype.setTransformArea=function(t){this.drawTransformArea(t),this.user_context.events_draw.setSelectionPoints(t.name_tool_selection,t.points_selection),this.user_context.events_draw.setDraw()},ce.prototype.drawTransformArea=function(t){var e=t.start_rect_area,i=t.rect_area;this.saveTransformLayer(e),this.restoreTransformSource(),this.drawTransformLayer(i),this.renderCanvas()},ce.prototype.saveTransformLayer=function(t){if(!this.checkTransformLayer()){var e=this.user_context.user_layers.getActiveLayer();this.saveCanvasTemp(e.$layer),this.$transform_source=this.saveTransformSource(e.$layer),this.$transform_layer=this.copyArea(t),this.clearLayerFromTransform(t),this.setIndexTransformLayer(this.user_context.user_layers.getActiveIndexLayer())}},ce.prototype.checkTransformLayer=function(){return!!this.$transform_layer&&this.index_transform_layer==this.user_context.user_layers.getActiveIndexLayer()},ce.prototype.copyArea=function(t){var e=s({width:t.width,height:t.height});return this.copyToTransformLayer(e,t),e},ce.prototype.copyToTransformLayer=function(t,e){var i=e.x,r=e.y,a=e.width,n=e.height,s=t.getContext("2d"),o=this.user_context.events_draw.getSelectionTool();s.save(),s.translate(-i,-r),o&&At.prototype.clipContext.apply(this,[s,o.points_selection]),s.drawImage(this.$transform_source,i,r,a,n,i,r,a,n),s.restore()},ce.prototype.createCanvasTransformLayer=function(t){var e=t.width,i=t.height,r=document.createElement("canvas");return r.width=e,r.height=i,r},ce.prototype.clearLayerFromTransform=function(t){if(this.$transform_layer&&this.$transform_layer.width&&this.$transform_layer.height){var e=t.x,i=t.y,r=t.width,a=t.height,n=this.$transform_source.getContext("2d");n.save(),n.globalCompositeOperation="destination-out",n.drawImage(this.$transform_layer,e-1.5,i-1.5,r+3,a+3);var s=this.user_context.events_draw.getSelectionTool();s&&At.prototype.clipContext.apply(this,[n,s.points_selection]),n.clearRect(e,i,r,a),n.restore()}},ce.prototype.createTransformSource=function(t){var e=t.width,i=t.height,r=document.createElement("canvas");return r.width=e,r.height=i,r},ce.prototype.saveTransformSource=function(t){var e=s({width:t.width,height:t.height});return e.getContext("2d").drawImage(t,0,0,t.width,t.height),e},ce.prototype.restoreTransformSource=function(){if(this.$transform_source&&this.$transform_source.width&&this.$transform_source.height){var t=this.ctx_canvas_source;t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(this.$transform_source,0,0)}},ce.prototype.drawTransformLayer=function(t){if(this.$transform_layer&&this.$transform_layer.width&&this.$transform_layer.height){var e=this.ctx_canvas_over,i=t.x,r=t.y,a=t.width,n=t.height,s=t.radians;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.translate(i+a/2,r+n/2),e.rotate(s);var o=-a/2,c=-n/2;e.drawImage(this.$transform_layer,o,c,a,n),e.setTransform(1,0,0,1,0,0)}},ce.prototype.initHandlers=function(){var t=this,e=this.canva.drawing_area.getContainerWork();e.addEventListener("pointermove",(function(e){t.is_active&&!t.is_down_area&&t.moveLayers(e)})),e.addEventListener("pointerdown",(function(e){t.is_active&&2!=e.which&&3!=e.which&&t.downLayers(e)})),document.addEventListener("keydown",(function(e){t.is_active&&t.keyDownTransform(e)})),document.addEventListener("keyup",(function(e){t.is_active&&t.keyUpTransform(e)}))},ce.prototype.moveLayers=function(t){this.canva;var e={x:t.offsetX,y:t.offsetY},i=this.checkPointOnCoords(e);i?this.user_context.events_draw.setCursor(i.cursor):this.checkRectOnCoords(e)?this.user_context.events_draw.setCursor("move"):this.user_context.events_draw.setCursor("rotate")},ce.prototype.checkPointOnCoords=function(t){for(var e=0;e<this.points_area.length;e++){var i=this.points_area[e];if(i.path&&this.ctx_transform.isPointInPath(i.path,t.x,t.y))return i}return!1},ce.prototype.checkRectOnCoords=function(t){return!!this.rect_path&&this.ctx_transform.isPointInPath(this.rect_path,t.x,t.y)},ce.prototype.downLayers=function(t){var e={x:t.offsetX,y:t.offsetY},i=this.checkPointOnCoords(e);i?this.downPoint(t,i):this.checkRectOnCoords(e)?this.downRect(t):this.downRotate(t)},ce.prototype.downPoint=function(t,e){var i=this;this.is_down_area=!0;var r=this.canva.transformCoords(t),a=this.canva.config_tools.getConfigsDrawing(),s=Object.assign({},this.rect_area);At.prototype.startDraw.apply(this,[r,a]);var o=this.user_context.events_draw.getSelectionTool();o&&o.startResizeSelection(),(0,n.Io)(document,(function(t){i.resizeArea(t,e.label,r,s)}),(function(t){At.prototype.finishDraw.apply(i,[{}]),o&&o.resizeSelection(s,i.rect_area),i.triggerTransformArea(),i.is_down_area=!1}))},ce.prototype.resizeArea=function(t,e,i,r){var a=this.canva.transformCoords(t),n=i.x-a.x,s=i.y-a.y,o=this.getEditParams(e),c=this.getDiffsArea(o,r,n,s);if(At.prototype.moveDraw.apply(this,[a]),c.x&&(this.rect_area.x=r.x-c.x),c.y&&(this.rect_area.y=r.y-c.y),c.width&&(this.rect_area.width=r.width-c.width),c.height&&(this.rect_area.height=r.height-c.height),this.is_shift_key){var l;l=["center_top","center_bot"].includes(e)?this.rect_area.height/r.height:["center_left","center_right"].includes(e)?this.rect_area.width/r.width:Math.min(this.rect_area.width/r.width,this.rect_area.height/r.height);var h=r.width*l,u=r.height*l;c.x&&(this.rect_area.x-=h-this.rect_area.width),c.y&&(this.rect_area.y-=u-this.rect_area.height),this.rect_area.width=h,this.rect_area.height=u}this.drawArea(),this.drawTransformArea({start_rect_area:this.start_rect_area,rect_area:this.rect_area})},ce.prototype.triggerTransformArea=function(){var t=this.user_context.events_draw.getNameSelectionTool(),e=this.user_context.events_draw.getSelectionPoints();this.user_context.user_events.trigger(L,{start_rect_area:this.start_rect_area,rect_area:this.rect_area,name_tool_selection:t,points_selection:e})},ce.prototype.getDiffsArea=function(t,e,i,r){var a={};return t.edit_x&&t.edit_width?(a.x=i,a.width=-1*i):!t.edit_x&&t.edit_width&&(a.width=i),t.edit_y&&t.edit_height?(a.y=r,a.height=-1*r):!t.edit_y&&t.edit_height&&(a.height=r),a},ce.prototype.getEditParams=function(t){var e={edit_x:!1,edit_y:!1,edit_width:!1,edit_height:!1};return["left_top","left_bot","center_left"].includes(t)&&(e.edit_x=!0),["left_top","center_top","right_top"].includes(t)&&(e.edit_y=!0),["left_top","right_top","center_right","right_bot","left_bot","center_left"].includes(t)&&(e.edit_width=!0),["left_top","center_top","right_top","right_bot","center_bot","left_bot"].includes(t)&&(e.edit_height=!0),e},ce.prototype.downRect=function(t){var e=this;this.is_down_area=!0;var i=this.canva.transformCoords(t),r=this.canva.config_tools.getConfigsDrawing(),a=Object.assign({},this.rect_area);At.prototype.startDraw.apply(this,[i,r]);var s=this.user_context.events_draw.getSelectionTool();s&&s.startMoveSelection(i),(0,n.Io)(document,(function(t){e.moveArea(t,a,i),s&&s.moveSelection(e.canva.transformCoords(t))}),(function(t){At.prototype.finishDraw.apply(e,[{}]),e.triggerTransformArea(),e.is_down_area=!1}))},ce.prototype.moveArea=function(t,e,i){var r=this.canva.transformCoords(t),a=i.x-r.x,n=i.y-r.y;this.rect_area.x=e.x-a,this.rect_area.y=e.y-n,At.prototype.moveDraw.apply(this,[r]),this.drawArea(),this.drawTransformArea({start_rect_area:this.start_rect_area,rect_area:this.rect_area})},ce.prototype.downRotate=function(t){var e=this;this.is_down_area=!0;var i=this.canva.transformCoords(t),r=this.canva.config_tools.getConfigsDrawing(),a=Object.assign({},this.rect_area);At.prototype.startDraw.apply(this,[i,r]),(0,n.Io)(document,(function(t){e.rotateArea(t,a,i)}),(function(t){At.prototype.finishDraw.apply(e,[{}]),e.triggerTransformArea(),e.is_down_area=!1}))},ce.prototype.rotateArea=function(t,e,i){var r=this.canva.transformCoords(t),a=r.x,n=r.y,s=i.x,o=i.y,c=e.x+e.width/2,l=e.y+e.height/2,h=Math.atan2(s-c,o-l),u=Math.atan2(a-c,n-l);At.prototype.moveDraw.apply(this,[r]),this.rect_area.radians=e.radians+(h-u),this.drawTransformArea({start_rect_area:this.start_rect_area,rect_area:this.rect_area})},ce.prototype.keyDownTransform=function(t){13===t.keyCode?(this.setTransform(),this.canva.config_tools.selectTool("brush")):t.shiftKey&&(this.is_shift_key=!0)},ce.prototype.keyUpTransform=function(t){t.shiftKey||(this.is_shift_key=!1)},ce.prototype.createCanvasTransform=function(){this.$layer=document.createElement("canvas"),this.ctx_transform=this.$layer.getContext("2d"),this.updateSizeLayer()},ce.prototype.calcPointsArea=function(t){var e=this.getTransformArea(t),i=e.coords1,r=e.coords2,a=e.coords3,n=e.coords4,s={x:i.x,y:i.y,label:"left_top",cursor:"nw-resize"},o={x:r.x,y:r.y,label:"right_top",cursor:"ne-resize"},c={x:a.x,y:a.y,label:"right_bot",cursor:"se-resize"},l={x:n.x,y:n.y,label:"left_bot",cursor:"sw-resize"},h=this.getCenterPoint(i,r),u={x:h.x,y:h.y,label:"center_top",cursor:"n-resize"},A=this.getCenterPoint(r,a),_={x:A.x,y:A.y,label:"center_right",cursor:"e-resize"},y=this.getCenterPoint(a,n),d={x:y.x,y:y.y,label:"center_bot",cursor:"s-resize"},v=this.getCenterPoint(n,i);return[s,o,c,l,u,_,d,{x:v.x,y:v.y,label:"center_left",cursor:"w-resize"}]},ce.prototype.getCenterPoint=function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}},ce.prototype.getTransformArea=function(t){var e=t.x,i=t.y,r=t.width,a=t.height,n=this.canva.transform_canvas;return{coords1:n.coordsToDisplayInt({x:e,y:i}),coords2:n.coordsToDisplayInt({x:e+r,y:i}),coords3:n.coordsToDisplayInt({x:e+r,y:i+a}),coords4:n.coordsToDisplayInt({x:e,y:i+a})}},ce.prototype.createSquarePath=function(t){var e=new Path2D,i=Math.ceil(4);return e.lineWidth=1,e.strokeStyle="rgba(0,0,0,1)",e.rect(t.x-i+.5,t.y-i+.5,8,8),e},ce.prototype.createRectPath=function(t){var e=new Path2D,i=this.getTransformArea(t),r=i.coords1,a=i.coords2,n=i.coords3,s=i.coords4;return e.lineWidth=1,e.strokeStyle="rgba(0,0,0,1)",e.moveTo(r.x,r.y),e.lineTo(a.x,a.y),e.lineTo(n.x,n.y),e.lineTo(s.x,s.y),e.lineTo(r.x,r.y),e},ce.prototype.drawArea=function(){if(this.user_context.checkMyUser()){this.updateSizeLayer(),this.clearArea(),this.points_area=this.calcPointsArea(this.rect_area),this.rect_path=this.createRectPath(this.rect_area),this.drawRect(this.rect_path);for(var t=0;t<this.points_area.length;t++){var e=this.points_area[t],i=this.createSquarePath(e);e.path=i,this.drawSquare(i)}}},ce.prototype.getPointOnLabel=function(t){return this.points_area.find((function(e){return e.label===t}))},ce.prototype.drawRect=function(t){var e=this.ctx_transform,i=t.lineWidth;e.shadowColor="rgba(255,255,255,0.7)",e.shadowBlur=0,e.shadowOffsetX=-i,e.shadowOffsetY=-i,e.stroke(t)},ce.prototype.drawSquare=function(t){var e=this.ctx_transform,i=t.lineWidth;e.shadowColor="rgba(255,255,255,0.7)",e.shadowBlur=0,e.shadowOffsetX=-i,e.shadowOffsetY=-i,e.stroke(t)},ce.prototype.updateSizeLayer=function(){var t=this.canva.drawing_area.getSizeContainerWork(),e=t.width,i=t.height;this.$layer.width=e,this.$layer.height=i},ce.prototype.clearArea=function(){this.ctx_transform&&this.ctx_transform.clearRect(0,0,this.$layer.width,this.$layer.height)},ce.prototype.start=function(t){},ce.prototype.move=function(t){},ce.prototype.finish=function(){},le.prototype=Object.create(At.prototype),le.prototype.drawTransformLayer=ce.prototype.drawTransformLayer,le.prototype.restoreTransformSource=ce.prototype.restoreTransformSource,le.prototype.setIndexTransformLayer=ce.prototype.setIndexTransformLayer,le.prototype.clearLayerFromTransform=ce.prototype.clearLayerFromTransform,le.prototype.copyToTransformLayer=ce.prototype.copyToTransformLayer,le.prototype.copyArea=ce.prototype.copyArea,le.prototype.saveTransformSource=ce.prototype.saveTransformSource,le.prototype.checkTransformLayer=ce.prototype.checkTransformLayer,le.prototype.saveTransformLayer=ce.prototype.saveTransformLayer,le.prototype.drawTransformArea=ce.prototype.drawTransformArea,le.prototype.setStartRectArea=ce.prototype.setStartRectArea,le.prototype.setRectArea=ce.prototype.setRectArea,le.prototype.getSelectionArea=ce.prototype.getSelectionArea,le.prototype.calcRectArea=ce.prototype.calcRectArea,le.prototype.choice=function(){var t=this.calcRectArea();this.setStartRectArea(t),this.setRectArea(t)},le.prototype.unchoice=function(){this.$transform_layer=null},le.prototype.start=function(t){var e=this.user_context.events_draw.getSelectionTool();this.start_coords=t,this.start_area=Object.assign({},this.rect_area),e&&e.startMoveSelection(t)},le.prototype.move=function(t){var e=this.start_coords.x-t.x,i=this.start_coords.y-t.y,r=this.user_context.events_draw.getSelectionTool();this.rect_area.x=this.start_area.x-e,this.rect_area.y=this.start_area.y-i,r&&r.moveSelection(t),this.drawTransformArea({start_rect_area:this.start_rect_area,rect_area:this.rect_area})},le.prototype.finish=function(){this.user_context.events_draw.setDraw()},he.prototype=Object.create(At.prototype),he.prototype.getTransformArea=ce.prototype.getTransformArea,he.prototype.calcPointsArea=ce.prototype.calcPointsArea,he.prototype.getCenterPoint=ce.prototype.getCenterPoint,he.prototype.getEditParams=ce.prototype.getEditParams,he.prototype.getDiffsArea=ce.prototype.getDiffsArea,he.prototype.init=function(){this.is_active=!1,this.click_set_crop=!1,this.is_shift_key=!1,this.crop_area={},this.$btn_set_crop=document.getElementById("btn_set_crop"),this.user_context.checkMyUser()&&(this.createCanvasCrop(),this.initHandlers())},he.prototype.createCanvasCrop=function(){this.$layer=document.createElement("canvas"),this.ctx_crop=this.$layer.getContext("2d"),this.updateSizeLayer()},he.prototype.updateSizeLayer=function(){var t=this.canva.drawing_area.getSizeContainerWork(),e=t.width,i=t.height;this.$layer.width=e,this.$layer.height=i},he.prototype.getCanvas=function(){return this.$layer},he.prototype.initCropArea=function(){var t=this.canva.art_canvas.getSizeCanvas(),e=t.width,i=t.height;this.crop_area={x:0,y:0,width:e,height:i}},he.prototype.choice=function(){this.user_context.user_events.trigger(b),this.updateSizeLayer(),this.initCropArea(),this.drawCropArea(),this.setIsActive(!0),this.canva.updateArtCanvas()},he.prototype.unchoice=function(){!this.click_set_crop&&confirm(t("draw.confirm_crop"))&&this.clickSetCrop(),this.click_set_crop=!1,this.setIsActive(!1),this.canva.updateArtCanvas()},he.prototype.setIsActive=function(t){this.is_active=!!t,this.$btn_set_crop.style.display=t?"inline-block":"none"},he.prototype.drawCropArea=function(){this.clearArea(),this.drawBackground(),this.drawPoints()},he.prototype.clearArea=function(){this.ctx_crop.clearRect(0,0,this.$layer.width,this.$layer.height)},he.prototype.drawBackground=function(){var t=new Path2D,e=this.getTransformArea(this.crop_area),i=e.coords1,r=e.coords2,a=e.coords3,n=e.coords4;t.lineWidth=2,t.moveTo(i.x,i.y),t.lineTo(r.x,r.y),t.lineTo(a.x,a.y),t.lineTo(n.x,n.y),t.lineTo(i.x,i.y),this.rect_path=t,this.ctx_crop.fillStyle="rgba(0,0,0,0.2)",this.ctx_crop.strokeStyle="rgba(0,0,0,0.6)",this.ctx_crop.fill(this.rect_path),this.ctx_crop.stroke(this.rect_path)},he.prototype.drawPoints=function(){this.points_area=this.calcPointsArea(this.crop_area);for(var t=0;t<this.points_area.length;t++){var e=this.points_area[t],i=this.createSquarePath(e);e.path=i,this.drawSquare(i)}},he.prototype.createSquarePath=function(t){var e=new Path2D,i=Math.ceil(4);return e.lineWidth=1,e.strokeStyle="rgba(0,0,0,0.8)",e.rect(t.x-i+.5,t.y-i+.5,8,8),e},he.prototype.drawSquare=function(t){this.ctx_crop.stroke(t)},he.prototype.initHandlers=function(){var t=this,e=this.canva.drawing_area.getContainerWork();e.addEventListener("pointermove",(function(e){t.is_active&&!t.is_down_area&&t.moveLayers(e)})),e.addEventListener("pointerdown",(function(e){t.is_active&&2!=e.which&&3!=e.which&&t.downLayers(e)})),document.addEventListener("keydown",(function(e){t.is_active&&t.keyDown(e)})),document.addEventListener("keyup",(function(e){t.is_active&&t.keyUp(e)})),this.$btn_set_crop&&this.$btn_set_crop.addEventListener("click",(function(){t.clickSetCrop()}))},he.prototype.moveLayers=function(t){this.ctx_crop,this.canva;var e={x:t.offsetX,y:t.offsetY},i=this.checkPointOnCoords(e);i?this.user_context.events_draw.setCursor(i.cursor):this.checkRectOnCoords(e)?this.user_context.events_draw.setCursor("move"):this.user_context.events_draw.setCursor("default")},he.prototype.checkPointOnCoords=function(t){for(var e,i=this.ctx_crop,r=0;r<this.points_area.length;r++)if((e=this.points_area[r]).path&&i.isPointInPath(e.path,t.x,t.y))return e;return!1},he.prototype.checkRectOnCoords=function(t){if(this.rect_path)return this.ctx_crop.isPointInPath(this.rect_path,t.x,t.y)},he.prototype.downLayers=function(t){var e={x:t.offsetX,y:t.offsetY},i=this.checkPointOnCoords(e);i?this.downPoint(t,i):this.checkRectOnCoords(e)&&this.downRect(t)},he.prototype.downPoint=function(t,e){var i=this;this.is_down_area=!0;var r=this.canva.transformCoords(t),a=this.canva.config_tools.getConfigsDrawing(),s=Object.assign({},this.crop_area);At.prototype.startDraw.apply(this,[r,a]),(0,n.Io)(document,(function(t){i.resizeArea(t,e.label,r,s)}),(function(t){At.prototype.finishDraw.apply(i,[{}]),i.is_down_area=!1}))},he.prototype.resizeArea=function(t,e,i,r){var a=this.canva.transformCoords(t),n=i.x-a.x,s=i.y-a.y,o=this.getEditParams(e),c=this.getDiffsArea(o,r,n,s);if(At.prototype.moveDraw.apply(this,[a]),c.x&&(this.crop_area.x=r.x-c.x),c.y&&(this.crop_area.y=r.y-c.y),c.width&&(this.crop_area.width=r.width-c.width),c.height&&(this.crop_area.height=r.height-c.height),this.is_shift_key){var l;l=["center_top","center_bot"].includes(e)?this.crop_area.height/r.height:["center_left","center_right"].includes(e)?this.crop_area.width/r.width:Math.min(this.crop_area.width/r.width,this.crop_area.height/r.height);var h=r.width*l,u=r.height*l;c.x&&(this.crop_area.x-=h-this.crop_area.width),c.y&&(this.crop_area.y-=u-this.crop_area.height),this.crop_area.width=h,this.crop_area.height=u}this.crop_area.width>this.canva.max_width_canvas&&(this.crop_area.width=this.canva.max_width_canvas,c.x&&(this.crop_area.x=r.x-(this.canva.max_width_canvas-r.width))),this.crop_area.width<this.canva.min_width_canvas&&(this.crop_area.width=this.canva.min_width_canvas,c.x&&(this.crop_area.x=r.x+(r.width-this.canva.min_width_canvas))),this.crop_area.height>this.canva.max_height_canvas&&(this.crop_area.height=this.canva.max_height_canvas,c.y&&(this.crop_area.y=r.y-(this.canva.max_height_canvas-r.height))),this.crop_area.height<this.canva.min_height_canvas&&(this.crop_area.height=this.canva.min_height_canvas,c.y&&(this.crop_area.y=r.y+(r.height-this.canva.min_height_canvas))),this.drawCropArea()},he.prototype.downRect=function(t){var e=this;this.is_down_area=!0;var i=this.canva.transformCoords(t),r=this.canva.config_tools.getConfigsDrawing(),a=Object.assign({},this.crop_area);At.prototype.startDraw.apply(this,[i,r]),(0,n.Io)(document,(function(t){e.moveArea(t,a,i)}),(function(t){At.prototype.finishDraw.apply(e,[{}]),e.is_down_area=!1}))},he.prototype.moveArea=function(t,e,i){var r=this.canva.transformCoords(t),a=i.x-r.x,n=i.y-r.y;this.crop_area.x=e.x-a,this.crop_area.y=e.y-n,At.prototype.moveDraw.apply(this,[r]),this.drawCropArea()},he.prototype.keyDown=function(t){t.shiftKey&&(this.is_shift_key=!0)},he.prototype.keyUp=function(t){t.shiftKey||(this.is_shift_key=!1)},he.prototype.clickSetCrop=function(){var t=-1*this.crop_area.x,e=-1*this.crop_area.y,i=this.crop_area.width,r=this.crop_area.height;this.user_context.user_events.trigger(q,{crop_left:t,crop_top:e,width:i,height:r}),this.click_set_crop=!0,this.canva.config_tools.selectTool("brush")},ue.prototype=Object.create(At.prototype),ue.prototype.start=function(t){this.ctx;var e=this.canva;this.move_mouse=!1,this.start_coords=e.transform_canvas.coordsToDisplayInt(t),this.start_zoom=e.transform_canvas.getZoom()},ue.prototype.move=function(t){this.ctx;var e=this.canva,i=e.transform_canvas.coordsToDisplayInt(t),r=this.start_coords.y-i.y,a=this.start_zoom+r/60;e.transform_canvas.scaleLayers(this.start_coords,a),this.move_mouse=!0},ue.prototype.finish=function(){var t=this.canva;if(!this.move_mouse&&this.start_coords){var e=t.transform_canvas.getDiffScale(-1);t.transform_canvas.scaleLayers(this.start_coords,e)}this.start_coords=null},Ae.prototype=Object.create(At.prototype),Ae.prototype.start=function(t){var e=this.canva;this.start_angle=e.transform_canvas.getRotate(),this.start_transform=e.transform_canvas.transform.clone(),this.start_coords=e.transform_canvas.coordsToDisplayInt(t)},Ae.prototype.move=function(t){var e=this.canva,i=e.transform_canvas.coordsToDisplayInt(t),r=e.drawing_area.getSizeContainerWork(),a=r.width/2,n=r.height/2,s=Math.atan2(i.y-n,i.x-a)-Math.atan2(this.start_coords.y-n,this.start_coords.x-a);e.transform_canvas.rotateAroundCenter(this.start_angle,s,this.start_transform)},Ae.prototype.finish=function(){};var _e=function(){function t(){l(this,t)}return _(t,null,[{key:"draw",value:function(e,i){switch(e){case Bt:t.drawCircle(i);break;case Ut:t.drawSquare(i);break;case Ht:t.drawStar(i);break;case $t:t.drawHeart(i);break;case"random-circle":t.drawRandomCircle(i);break;case"random-color-circle":t.drawRandomColorCircle(i);break;case qt:t.drawHorizontalLines(i);break;case Kt:t.drawVerticalLines(i);break;case jt:t.drawSmallSquares(i);break;case Vt:t.drawBigSquares(i);break;case Wt:t.drawCrossLines(i);break;case Ft:t.drawBristles(i);break;case Yt:t.drawChalk(i);break;case Gt:t.drawFluff(i);break;case Zt:t.drawBlot(i);break;case Jt:t.drawCrumb(i)}}},{key:"drawCircle",value:function(t){var e=t.ctx,i=t.line_width,r=t.color,a=t.pressure_density,n=t.coords,s=i/2,o=n.x,c=n.y,l=r+","+a/100,h=1-2/s;h<0&&(h=0);var u=e.createRadialGradient(o,c,0,o,c,Math.ceil(s));u.addColorStop(0,"rgba("+l+")"),u.addColorStop(h,"rgba("+l+")"),u.addColorStop(1,"rgba("+r+",0)"),e.fillStyle=u,e.beginPath(),e.arc(o,c,s,0,2*Math.PI),e.fill()}},{key:"drawSquare",value:function(t){var e=t.ctx,i=t.line_width,r=t.color_density,a=t.coords,n=t.angle;if(void 0!==n){var s=i/2,o=a.x,c=a.y;e.fillStyle=r,e.save(),e.beginPath(),e.translate(o,c),e.rotate(-n),e.fillRect(-s,-s,i,i),e.restore()}}},{key:"drawStar",value:function(t){var e=t.ctx,i=t.line_width,r=t.color_density,a=t.coords,n=t.angle;if(void 0!==n){var s=i/2,o=a.x,c=a.y;e.fillStyle=r,e.save(),e.beginPath(),e.translate(o,c),e.rotate(-n),e.moveTo(0,0-s);for(var l=0;l<5;l++)e.rotate(Math.PI/5),e.lineTo(0,0-.4*s),e.rotate(Math.PI/5),e.lineTo(0,0-s);e.closePath(),e.fill(),e.restore()}}},{key:"drawHeart",value:function(t){var e=t.ctx,i=t.line_width,r=t.color_density,a=t.coords,n=t.angle;if(void 0!==n){var s=a.x,o=a.y,c=i/2;e.save(),e.beginPath(),e.translate(s,o),e.rotate(-n);var l=.35*i;e.moveTo(0,-c+l),e.bezierCurveTo(0,-c,-c,-c,-c,-c+l),e.bezierCurveTo(-c,c/2,.2*-c,c-.2*c,0,c),e.bezierCurveTo(.2*c,c-.2*c,c,c/2,c,-c+l),e.bezierCurveTo(c,-c,0,-c,0,-c+l),e.closePath(),e.fillStyle=r,e.fill(),e.restore()}}},{key:"drawRandomCircle",value:function(t){var e=t.ctx,i=t.line_width,r=t.color_density,a=t.coords,s=Math.ceil(i/2),o=(0,n.sZ)(4,8),c=Math.ceil(.1*s),l=Math.ceil(.4*s),h=l,u=i-l,A=a.x-s,_=a.y-s;e.fillStyle=r;for(var y=0;y<o;y++){var d=(0,n.sZ)(h,u),v=(0,n.sZ)(h,u),f=(0,n.sZ)(c,l);e.beginPath(),e.arc(A+d,_+v,f,0,2*Math.PI),e.fill()}}},{key:"drawRandomColorCircle",value:function(t){for(var e=t.ctx,i=t.line_width,r=t.coords,a=t.pressure_density,s=Math.ceil(i/2),o=(0,n.sZ)(4,8),c=Math.ceil(.1*s),l=Math.ceil(.4*s),h=l,u=i-l,A=r.x-s,_=r.y-s,y=a/100,d=0;d<o;d++){var v=(0,n.sZ)(h,u),f=(0,n.sZ)(h,u),p=(0,n.sZ)(c,l),g=(0,n.sZ)(0,255),m=(0,n.sZ)(0,255),x=(0,n.sZ)(0,255);e.fillStyle="rgba(".concat(g,", ").concat(m,", ").concat(x,", ").concat(y,")"),e.beginPath(),e.arc(A+v,_+f,p,0,2*Math.PI),e.fill()}}},{key:"drawHorizontalLines",value:function(e){t.drawPattern(qt,e,(function(){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=t.height=8,i.fillStyle=e.color_density,i.beginPath(),i.fillRect(0,0,8,4),e.ctx.createPattern(t,"repeat")}))}},{key:"drawVerticalLines",value:function(e){t.drawPattern(Kt,e,(function(){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=t.height=8,i.fillStyle=e.color_density,i.beginPath(),i.fillRect(0,0,4,8),e.ctx.createPattern(t,"repeat")}))}},{key:"drawSmallSquares",value:function(e){t.drawPattern(jt,e,(function(){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=t.height=4,i.fillStyle=e.color_density,i.beginPath(),i.fillRect(0,0,2,2),i.fillRect(2,2,2,2),e.ctx.createPattern(t,"repeat")}))}},{key:"drawBigSquares",value:function(e){t.drawPattern(Vt,e,(function(){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=t.height=12,i.fillStyle=e.color_density,i.beginPath(),i.fillRect(0,0,6,6),i.fillRect(6,6,6,6),e.ctx.createPattern(t,"repeat")}))}},{key:"drawCrossLines",value:function(e){t.drawPattern(Wt,e,(function(){var t=document.createElement("canvas"),i=t.getContext("2d");t.width=t.height=8,i.fillStyle=e.color_density,i.beginPath();for(var r=0;r<8;r++)i.fillRect(r,r,1,1),r<7&&i.fillRect(8-r-2,r,1,1);return e.ctx.createPattern(t,"repeat")}))}},{key:"drawPattern",value:function(e,i,r){var a=t.getCachePattern(e,i);a||(a=r(),t.saveCachePattern(e,a,i));var n=i.line_width/2,s=i.coords.x,o=i.coords.y;i.ctx.fillStyle=a,i.ctx.beginPath(),i.ctx.arc(s,o,n,0,2*Math.PI),i.ctx.fill()}},{key:"getCachePattern",value:function(e,i){var r=t.cache_pattern[e];return!!r&&r.params.color_density===i.color_density&&r.pattern}},{key:"saveCachePattern",value:function(e,i,r){t.cache_pattern[e]={pattern:i,params:r}}},{key:"drawBristles",value:function(e){if(void 0!==e.angle){(0,n.sZ)(0,1)&&(e.angle+=Math.PI);var i=t.getCacheImage(Ft,e,(function(){return"data:image/png;base64,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"}));t.drawImage(Ft,e,(function(){return t.getCanvasImage(i,e)}))}}},{key:"drawChalk",value:function(e){if(void 0!==e.angle){(0,n.sZ)(0,1)&&(e.angle+=Math.PI),e.angle+=Math.PI*((0,n.sZ)(-15,15)/100);var i=t.getCacheImage(Yt,e,(function(){return"data:image/png;base64,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"}));t.drawImage(Yt,e,(function(){return t.getCanvasImage(i,e)}))}}},{key:"drawFluff",value:function(e){if(void 0!==e.angle){(0,n.sZ)(0,1)&&(e.angle+=Math.PI);var i=t.getCacheImage(Gt,e,(function(){return"data:image/png;base64,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"}));t.drawImage(Gt,e,(function(){return t.getCanvasImage(i,e)}))}}},{key:"drawBlot",value:function(e){if(void 0!==e.angle){var i=t.getCacheImage(Zt,e,(function(){return"data:image/png;base64,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"}));t.drawImage(Zt,e,(function(){return t.getCanvasImage(i,e)}))}}},{key:"drawCrumb",value:function(e){e.angle=0;var i=t.getCacheImage(Jt,e,(function(){return"data:image/png;base64,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"}));t.drawImage(Jt,e,(function(){return t.getCanvasImage(i,e)}))}},{key:"getCanvasImage",value:function(t,e){var i=document.createElement("canvas"),r=i.getContext("2d");return!!(t&&t.complete&&t.width&&t.height)&&(i.width=t.width,i.height=t.height,r.fillStyle=e.color_density,r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="destination-in",r.drawImage(t,0,0,i.width,i.height),i)}},{key:"drawImage",value:function(e,i,r){var a=t.getCacheCanvasImage(e,i);if(a||(a=r(),t.saveCacheCanvasImage(e,a,i)),a&&a.width&&a.height){var n=i.ctx,s=i.line_width,o=i.coords,c=i.angle,l=s/2,h=o.x,u=o.y;n.save(),n.beginPath(),n.translate(h,u),n.rotate(-c),n.drawImage(a,-l,-l,s,s),n.restore()}}},{key:"getCacheImage",value:function(e,i,r){var a=t.cache_image[e];if(a)return a.image;var n=new Image;return n.src=r(),t.saveCacheImage(e,n,i),n}},{key:"saveCacheImage",value:function(e,i,r){t.cache_image[e]={image:i,params:r}}},{key:"getCacheCanvasImage",value:function(e,i){var r=t.cache_canvas_image[e];return!!r&&r.params.color_density===i.color_density&&r.canvas}},{key:"saveCacheCanvasImage",value:function(e,i,r){t.cache_canvas_image[e]={canvas:i,params:r}}}]),t}();function ye(){At.apply(this,arguments)}function de(){At.apply(this,arguments)}function ve(){At.apply(this,arguments)}function fe(){At.apply(this,arguments)}function pe(){At.apply(this,arguments)}function ge(){At.apply(this,arguments)}function me(){At.apply(this,arguments)}It(_e,"cache_pattern",{}),It(_e,"cache_image",{}),It(_e,"cache_canvas_image",{}),ye.prototype=Object.create(At.prototype),ye.prototype.start=function(t){this.stabilization=this.getConfigTool("stabilization"),this.points=[t]},ye.prototype.move=function(t){this.points.push(t),this.draw()},ye.prototype.draw=function(){this.drawSpacing(this.stabilization)},ye.prototype.drawPoint=function(t,e){var i=this.getPressureLineWidth(t),r=this.getPressureColorDensity(t),a=this.getPressureDensity(t),n=this.getConfigTool("texture"),s=this.getConfigTool("color");_e.draw(n,{ctx:this.ctx,line_width:i,color_density:r,coords:t,angle:e,color:s,pressure_density:a})},ye.prototype.finish=function(t){this.is_draw.move||this.drawPoint(t,0),this.user_context.events_draw.setDraw()},de.prototype=Object.create(At.prototype),de.prototype.start=function(t){this.stabilization=this.getConfigTool("stabilization"),this.points=[t],this.draw()},de.prototype.move=function(t){this.points.push(t),this.draw()},de.prototype.draw=function(){this.drawSpacing(this.stabilization)},de.prototype.drawPoint=function(t){var e=this.getPressureLineWidth(t),i=this.ctx,r=e/2,a=t.x,n=t.y,s=this.getPressureDensity(t);i.fillStyle=r<1?this.getColorDensity(s):this.getRadialGradient(a,n,r,s),i.beginPath(),i.arc(a,n,r,0,2*Math.PI),i.fill()},de.prototype.finish=function(t){this.user_context.events_draw.setDraw()},ve.prototype=Object.create(At.prototype),ve.prototype.start=function(t){this.stabilization=this.getConfigTool("stabilization"),this.points=[t],this.draw()},ve.prototype.move=function(t){this.points.push(t),this.draw()},ve.prototype.draw=function(){this.drawSpacing(this.stabilization)},ve.prototype.drawPoint=function(t){var e=this.getPressureLineWidth(t),i=this.ctx,r=Math.floor(e/2),a=Math.floor(t.x-r),n=Math.floor(t.y-r);i.fillStyle=this.getPressureColorDensity(t),i.beginPath(),i.fillRect(a,n,e,e)},ve.prototype.finish=function(t){this.user_context.events_draw.setDraw()},fe.prototype=Object.create(At.prototype),fe.prototype.start=function(t){this.stabilization=this.getConfigTool("stabilization"),this.points=[t],this.draw()},fe.prototype.getSizeLine=function(t){return t>20?Math.ceil(t/10):t>10?Math.ceil(t/5):2},fe.prototype.move=function(t){this.points.push(t),this.draw()},fe.prototype.draw=function(){this.drawSpacing(this.stabilization)},fe.prototype.drawPoint=function(t){var e=this.getPressureLineWidth(t),i=this.ctx,r=(this.canva,this.getConfigTool("angle")),a=r+180,s=Math.round(e/2),o=t.x+Math.cos((0,n.F6)(r))*s,c=t.y+Math.sin((0,n.F6)(r))*s,l=t.x+Math.cos((0,n.F6)(a))*s,h=t.y+Math.sin((0,n.F6)(a))*s;i.strokeStyle=this.getPressureColorDensity(t),i.lineCap="butt",i.lineWidth=this.getSizeLine(e),i.beginPath(),i.moveTo(o,c),i.lineTo(l,h),i.stroke()},fe.prototype.finish=function(t){this.user_context.events_draw.setDraw()},pe.prototype=Object.create(At.prototype),pe.prototype.start=function(t){var e=this.ctx;e.strokeStyle="rgba("+this.getConfigTool("color")+","+this.getConfigTool("opacity")/1+")",e.lineWidth=this.getConfigTool("line_width"),this.points=[],this.points.push(t)},pe.prototype.move=function(t){var e=this.ctx;e.beginPath(),e.strokeStyle="rgba("+this.getConfigTool("color")+","+this.getConfigTool("opacity")/1+")";for(var i,r,a,n=Math.ceil(this.getConfigTool("scatter")/2),s=this.points.length<=n?0:this.points.length-n,o=s;o<this.points.length;o+=Math.ceil(n/2))e.moveTo(t.x,t.y),i=this.points.length-Math.floor((this.points.length-s)/2)-1,r=this.points[i],a=this.points[o],e.quadraticCurveTo(r.x,r.y,a.x,a.y);e.stroke(),e.closePath(),this.points.push(t)},pe.prototype.finish=function(t){this.user_context.events_draw.setDraw()},ge.prototype=Object.create(At.prototype),ge.prototype.start=function(t){var e=this.ctx;this.points=[],this.points.push(t),e.strokeStyle="rgba("+this.getConfigTool("color")+","+this.getConfigTool("opacity")/1+")",e.lineWidth=this.getConfigTool("line_width"),this.draw(t)},ge.prototype.draw=function(t){var e=this.ctx;if(this.canva,!(this.points.length<10)){var i=this.points[this.points.length-1],r=this.points[this.points.length-10],a=i.x>r.x?i.x-r.x:r.x-i.x,s=i.y>r.y?i.y-r.y:r.y-i.y;if(i.x>r.x&&i.y>r.y||i.x<r.x&&i.y<r.y)var o=(0,n.ZY)(Math.atan(s/a));else o=(0,n.ZY)(Math.atan(a/s))+90;var c=this.getConfigTool("scatter"),l=(0,n.sZ)(-Math.round(c/2),Math.round(c/2)),h=(o+=l)+180+l,u=(i.x+r.x)/2,A=(i.y+r.y)/2,_=c,y={x:u+Math.cos((0,n.F6)(o))*_,y:A+Math.sin((0,n.F6)(o))*_},d={x:u+Math.cos((0,n.F6)(h))*_,y:A+Math.sin((0,n.F6)(h))*_};e.beginPath(),e.moveTo(y.x,y.y),e.lineTo(d.x,d.y),e.stroke(),e.closePath()}},ge.prototype.move=function(t){this.points.push(t),this.draw(t)},ge.prototype.finish=function(t){this.user_context.events_draw.setDraw()},me.prototype=Object.create(At.prototype),me.prototype.start=function(t){this.ctx,this.canva,this.points=[],this.points.push(this.transformPixelCoords(t)),this.draw()},me.prototype.transformPixelCoords=function(t){var e=this.getConfigTool("line_width");return{x:t.x-t.x%e,y:t.y-t.y%e}},me.prototype.draw=function(t){var e=this.ctx,i=this.getConfigTool("line_width");this.clearCanvasOver(),e.fillStyle="rgba("+this.getConfigTool("color")+","+this.getConfigTool("opacity")/1+")",e.beginPath();for(var r=0;r<this.points.length;r++){var a=this.points[r];e.fillRect(a.x,a.y,i,i)}e.fill(),e.closePath()},me.prototype.move=function(t){for(var e=this.points[this.points.length-1],i=this.getBetweenPoints(e,t),r=0;r<i.length;r++){var a=this.transformPixelCoords(i[r]);this.checkExistsCoords(a)||this.points.push(a)}this.draw()},me.prototype.getBetweenPoints=function(t,e){for(var i=this.distanceBetween(t,e),r=this.angleBetween(t,e),a=[],n=0;n<=i;n++){var s=this.getAnglePoint(t,e,r,n,i);a.push(s)}return a},me.prototype.checkExistsCoords=function(t){return this.points.find((function(e){return e.x===t.x&&e.y===t.y}))},me.prototype.finish=function(t){this.user_context.events_draw.setDraw()};var xe=function(){function t(e){var i=e.main_context,r=e.user_context;l(this,t),It(this,"name_current_tool","brush"),It(this,"tools",{}),this.main_context=i,this.user_context=r}return _(t,[{key:"getNameCurrentTool",value:function(){return this.name_current_tool}},{key:"setNameCurrentTool",value:function(t){this.name_current_tool=t}},{key:"setCurTool",value:function(t){var e=t.name_tool,i=t.is_hotkey,r=void 0!==i&&i;if(!this.checkExistsTool(e))return!1;var a=this.getNameCurrentTool(),n=this.tools[a],s=this.tools[e];if(a===e)return!1;n.tool.unchoiceTool(a,e,r),this.user_context.events_draw.setCursor(s.cursor),this.setNameCurrentTool(e),s.tool.choiceTool(a,e,r)}},{key:"checkExistsTool",value:function(t){return!!this.tools[t]}},{key:"getTool",value:function(){return this.getToolByName(this.getNameCurrentTool())}},{key:"getToolByName",value:function(t){return this.tools[t]}},{key:"getCurTool",value:function(){var t=this.getTool();return t?t.tool:ye}},{key:"initListTools",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.tools={},t.includes(Y)||(this.tools[Y]={tool:new le(this.main_context,this.user_context),cursor:"move",values:{}}),t.includes(G)||(this.tools[G]={tool:new se(this.main_context,this.user_context),cursor:"crosshair",values:{}}),t.includes(Z)||(this.tools[Z]={tool:new oe(this.main_context,this.user_context),cursor:"crosshair",values:{}}),t.includes(J)||(this.tools[J]={tool:new ce(this.main_context,this.user_context),cursor:"pointer",values:{}}),t.includes(Q)||(this.tools[Q]={tool:new ie(this.main_context,this.user_context),cursor:"grab",values:{}}),t.includes(X)||(this.tools[X]={tool:new he(this.main_context,this.user_context),cursor:"default",values:{}}),t.includes(tt)||(this.tools[tt]={tool:new re(this.main_context,this.user_context),values:{pressure_size:!1,line_width:10,min_size:1,opacity:100,soft:0,pressure_density:!1,density:100,min_density:1,spacing:1,stabilization:1}}),t.includes(et)||(this.tools[et]={tool:new ae(this.main_context,this.user_context),cursor:"pipet",values:{}}),t.includes(it)||(this.tools[it]={tool:new ne(this.main_context,this.user_context),cursor:"default",values:{tolerance:50,opacity:100}}),t.includes(rt)||(this.tools[rt]={tool:new ue(this.main_context,this.user_context),cursor:"zoom-in",values:{}}),t.includes(at)||(this.tools[at]={tool:new Ae(this.main_context,this.user_context),cursor:"rotate",values:{}}),t.includes(nt)||(this.tools[nt]={tool:new ye(this.main_context,this.user_context),values:{pressure_size:!1,line_width:10,min_size:1,opacity:100,pressure_density:!1,density:100,min_density:1,spacing:5,stabilization:2,texture:"circle"}}),t.includes(st)||(this.tools[st]={tool:new de(this.main_context,this.user_context),values:{pressure_size:!1,line_width:10,min_size:1,soft:50,opacity:100,pressure_density:!1,density:100,min_density:1,spacing:15,stabilization:1}}),t.includes(ot)||(this.tools[ot]={tool:new ve(this.main_context,this.user_context),values:{pressure_size:!1,line_width:5,min_size:1,opacity:100,pressure_density:!1,density:100,min_density:1,spacing:1,stabilization:1}}),t.includes(ct)||(this.tools[ct]={tool:new fe(this.main_context,this.user_context),values:{pressure_size:!1,line_width:10,min_size:1,angle:45,opacity:100,pressure_density:!1,density:100,min_density:1,spacing:1,stabilization:1}}),t.includes(lt)||(this.tools[lt]={tool:new pe(this.main_context,this.user_context),values:{line_width:1,opacity:15,scatter:28}}),t.includes(ht)||(this.tools[ht]={tool:new ge(this.main_context,this.user_context),values:{line_width:1,opacity:40,scatter:25}}),t.includes(ut)||(this.tools[ut]={tool:new me(this.main_context,this.user_context),values:{line_width:10,opacity:100}})}}]),t}();function ke(t){var e=t.parent_context,i=t.user_context,r=t.max_states;this.parent_context=e,this.user_context=i,this.states=[],this.current_index=0,this.MAX_STATES=r||70,this.STATE_DRAW="STATE_DRAW",this.STATE_LAYER="STATE_LAYER",this.ACTION_VISIBLE_LAYER="ACTION_VISIBLE_LAYER",this.ACTION_ACTIVE_LAYER="ACTION_ACTIVE_LAYER",this.ACTION_ADD_LAYER="ACTION_ADD_LAYER",this.ACTION_DEL_LAYER="ACTION_DEL_LAYER",this.ACTION_SAFE_LAYERS="ACTION_SAFE_LAYERS",this.ACTION_DND_LAYER="ACTION_DND_LAYER",this.ACTION_NAME_LAYER="ACTION_NAME_LAYER",this.ACTION_CROP_LAYER="ACTION_CROP_LAYER",this.ACTION_COPY_LAYER="ACTION_COPY_LAYER",this.ACTION_CLEAR_LAYER="ACTION_CLEAR_LAYER",this.ACTION_SELECTION_COPY_LAYER="ACTION_SELECTION_COPY_LAYER",this.ACTION_SELECTION_CUT_LAYER="ACTION_SELECTION_CUT_LAYER",this.ACTION_LOCK_LAYER="ACTION_LOCK_LAYER",this.ACTION_MASK_LAYER="ACTION_MASK_LAYER",this.DIRECTION_ABORT="DIRECTION_ABORT",this.DIRECTION_REPEAT="DIRECTION_REPEAT"}ke.prototype.save=function(t,e){t===this.STATE_DRAW?this.saveDraw():t===this.STATE_LAYER&&(this.saveLayer(e),this.saveDraw())},ke.prototype.saveDraw=function(){var t=this.user_context.user_layers.getActiveLayer();if(t){var e,i,r=this.createStateCanvas(t.$layer),a=this.user_context.events_draw.getSelectionPoints(),n=this.user_context.events_draw.getNameSelectionTool();if(a){e=[];for(var s=0;s<a.length;s++)e.push(Object.assign({},a[s]))}var o=this.user_context.tools_draw.tools[J];if(o){var c=o.tool;c.is_active&&(i=Object.assign({},c.rect_area))}var l={type_state:this.STATE_DRAW,data:{index_layer:t.index,image:r,points_selection:e,tool_selection:n,transform_area:i}};this.saveState(l)}},ke.prototype.createStateCanvas=function(t){var e=document.createElement("canvas"),i=e.getContext("2d");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),e},ke.prototype.saveLayer=function(t){var e={type_state:this.STATE_LAYER,data:t};this.saveState(e)},ke.prototype.saveState=function(t){this.states=this.states.slice(0,this.current_index+1);var e=this.states.length;this.states[e]=t,this.states.length>this.MAX_STATES?this.states.shift():this.current_index=e},ke.prototype.getCurrentState=function(){return this.states[this.current_index]},ke.prototype.clear=function(){this.states=[],this.current_index=0},ke.prototype.abort=function(){var t=this.current_index-1;return!(t<0)&&this.force(t,this.DIRECTION_ABORT)},ke.prototype.repeat=function(){var t=this.current_index+1;return!(t>=this.states.length)&&this.force(t,this.DIRECTION_REPEAT)},ke.prototype.force=function(t,e){var i=this.states[t];return this.current_index=t,!!i&&(i.type_state===this.STATE_DRAW?this.forceDraw(i.data):i.type_state===this.STATE_LAYER?this.forceLayer(i.data,e):void 0)},ke.prototype.forceDraw=function(t){var e=this.parent_context,i=this.user_context.getIdUser();return!!e.list_layers.getLayerOnId(i,t.index_layer)&&!!t.image&&(this.user_context.user_layers.getActiveIndexLayer()!=t.index_layer&&this.user_context.user_layers.setActiveLayer(t.index_layer),this.parent_context.layer_actions.clearCanvasAction(i,t.index_layer),this.parent_context.layer_actions.drawCanvasAction(i,t.index_layer,t.image),this.setSelection(t),this.setTransform(t),!0)},ke.prototype.setSelection=function(t){if(t.points_selection&&t.tool_selection){for(var e=[],i=0;i<t.points_selection.length;i++)e.push(Object.assign({},t.points_selection[i]));var r=this.user_context.tools_draw.getToolByName(t.tool_selection).tool;r.points_selection=e,r.clearCanvas(),r.drawLines(t.points_selection)}else this.user_context.user_events.trigger(b)},ke.prototype.setTransform=function(t){var e=this,i=this.user_context.tools_draw.tools[J];t.transform_area?(i.tool.rect_area=Object.assign({},t.transform_area),i.tool.clearArea(),i.tool.drawArea()):i&&(i.tool.clearArea(),i.tool.is_active&&this.user_context.checkMyUser()&&setTimeout((function(){e.parent_context.config_tools.selectTool(nt)}),0))},ke.prototype.forceLayer=function(t,e){var i=t.data_action;switch(t.type_action){case this.ACTION_VISIBLE_LAYER:this.actionVisibleLayer(i,e);break;case this.ACTION_ACTIVE_LAYER:this.actionActiveLayer(i,e);break;case this.ACTION_ADD_LAYER:this.actionAddLayer(i,e);break;case this.ACTION_DEL_LAYER:this.actionDelLayer(i,e);break;case this.ACTION_SAFE_LAYERS:this.actionSafeLayers(i,e);break;case this.ACTION_DND_LAYER:this.actionDndLayer(i,e);break;case this.ACTION_NAME_LAYER:this.actionNameLayer(i,e);break;case this.ACTION_CROP_LAYER:this.actionCropLayer(i,e);break;case this.ACTION_COPY_LAYER:this.actionCopyLayer(i,e);break;case this.ACTION_CLEAR_LAYER:this.actionClearLayer(i,e);break;case this.ACTION_SELECTION_COPY_LAYER:this.actionSelectionCopyLayer(i,e);break;case this.ACTION_SELECTION_CUT_LAYER:this.actionSelectionCutLayer(i,e);break;case this.ACTION_LOCK_LAYER:this.actionLockLayer(i,e);break;case this.ACTION_MASK_LAYER:this.actionMaskLayer(i,e)}switch(e){case this.DIRECTION_ABORT:this.abort();break;case this.DIRECTION_REPEAT:this.repeat()}return!0},ke.prototype.actionVisibleLayer=function(t,e){var i,r=t.index_layer,a=this.user_context.getIdUser();switch(e){case this.DIRECTION_ABORT:i=!t.is_visible;break;case this.DIRECTION_REPEAT:i=t.is_visible}this.parent_context.list_layers.changeParamsLayer(a,r,{hide:i})},ke.prototype.actionActiveLayer=function(t,e){var i;switch(e){case this.DIRECTION_ABORT:i=t.prev_index_layer;break;case this.DIRECTION_REPEAT:i=t.index_layer}this.user_context.user_layers.setActiveLayer(i)},ke.prototype.actionAddLayer=function(t,e){var i=this.user_context.getIdUser(),r=this.parent_context,a=t.index_layer,n=t.prev_index_layer;switch(e){case this.DIRECTION_ABORT:r.list_layers.getUserLayers(i).length>1&&(r.layer_actions.delLayer(i,a),this.user_context.user_layers.setActiveLayer(n));break;case this.DIRECTION_REPEAT:r.layer_actions.actionNewLayer(i,a,{name:t.name_layer})}},ke.prototype.actionDelLayer=function(t,e){var i=this.user_context.getIdUser(),r=this.parent_context,a=t.duplicate_layer,n=a.index_layer,s=a.position,o=a.image_layer,c=a.params,l=t.next_index_layer;switch(e){case this.DIRECTION_ABORT:r.layer_actions.actionNewLayer(i,n,Object.assign({},c)),r.list_layers.movePositionUserLayer(i,n,s),r.layer_actions.drawCanvasAction(i,n,o);break;case this.DIRECTION_REPEAT:r.layer_actions.delLayer(i,n),this.user_context.user_layers.setActiveLayer(l)}},ke.prototype.actionSafeLayers=function(t,e){var i=this.user_context.getIdUser(),r=this.parent_context,a=t.data_layers,n=t.positions_layers;switch(e){case this.DIRECTION_ABORT:for(var s=0;s<a.length;s++){var o=a[s],c=o.index_layer,l=o.image_layer,h=o.params;r.list_layers.checkExistsLayer(i,c)&&r.layer_actions.delLayer(i,c),r.layer_actions.actionNewLayer(i,c,Object.assign({},h)),r.layer_actions.drawCanvasAction(i,c,l)}r.list_layers.setPositionUserLayers(n);break;case this.DIRECTION_REPEAT:for(var u=a[0].index_layer,A=1;A<a.length;A++)r.layer_actions.safeTwoLayers(i,u,a[A].index_layer);r.layer_actions.savePreviewLayer(i,u)}},ke.prototype.actionDndLayer=function(t,e){var i=this.user_context.getIdUser(),r=this.parent_context,a=t.index_layer,n=t.start_position,s=t.end_position;switch(e){case this.DIRECTION_ABORT:r.list_layers.movePositionUserLayer(i,a,n);break;case this.DIRECTION_REPEAT:r.list_layers.movePositionUserLayer(i,a,s)}},ke.prototype.actionNameLayer=function(t,e){var i,r=this.user_context.getIdUser(),a=this.parent_context,n=t.index_layer,s=t.current_name,o=t.old_name;switch(e){case this.DIRECTION_ABORT:i=o;break;case this.DIRECTION_REPEAT:i=s}a.list_layers.changeParamsLayer(r,n,{name:i})},ke.prototype.actionCropLayer=function(t,e){var i=this.parent_context,r=t.crop_left,a=t.crop_top,n=t.width_canvas,s=t.height_canvas,o=t.old_width_canvas,c=t.old_height_canvas,l=t.data_layers;switch(e){case this.DIRECTION_ABORT:i.setSizeCanvas({width:o,height:c});for(var h=0;h<l.length;h++){var u=l[h],A=u.id_user,_=u.index_layer,y=u.image_layer,d=i.list_layers.getLayerOnId(A,_);d.$layer.width=o,d.$layer.height=c,i.layer_actions.clearCanvasAction(A,_),i.layer_actions.drawCanvasAction(A,_,y)}i.updateArtCanvas();break;case this.DIRECTION_REPEAT:i.resizeCanvas({crop_left:r,crop_top:a,width_canvas:n,height_canvas:s})}},ke.prototype.actionCopyLayer=function(t,e){var i=this.user_context.getIdUser(),r=this.parent_context,a=t.index_layer,n=t.copy_layer,s=n.index_layer,o=n.position,c=n.image_layer,l=n.params;switch(e){case this.DIRECTION_ABORT:r.layer_actions.delLayer(i,s),this.user_context.user_layers.setActiveLayer(a);break;case this.DIRECTION_REPEAT:r.layer_actions.actionNewLayer(i,s,Object.assign({},l)),r.list_layers.movePositionUserLayer(i,s,o),r.layer_actions.drawCanvasAction(i,s,c)}},ke.prototype.actionClearLayer=function(t,e){var i=this.user_context.getIdUser(),r=this.parent_context,a=t.index_layer,n=t.layer;switch(e){case this.DIRECTION_ABORT:r.layer_actions.drawCanvasAction(i,a,n.image_layer);break;case this.DIRECTION_REPEAT:r.layer_actions.clearLayer(i,a)}},ke.prototype.actionSelectionCopyLayer=function(t,e){var i=this.user_context.getIdUser(),r=this.parent_context,a=t.duplicate_layer,n=t.duplicate_new_layer,s=n.index_layer,o=n.position,c=n.params,l=n.image_layer;switch(e){case this.DIRECTION_ABORT:r.layer_actions.delLayer(i,s),this.user_context.user_layers.setActiveLayer(a.index_layer);break;case this.DIRECTION_REPEAT:r.layer_actions.actionNewLayer(i,s,Object.assign({},c)),r.list_layers.movePositionUserLayer(i,s,o),r.layer_actions.clearCanvasAction(i,s),r.layer_actions.drawCanvasAction(i,s,l)}},ke.prototype.actionSelectionCutLayer=function(t,e){var i=this.user_context.getIdUser(),r=this.parent_context,a=t.duplicate_layer,n=t.duplicate_new_layer,s=n.index_layer,o=n.position,c=n.params,l=n.image_layer;switch(e){case this.DIRECTION_ABORT:r.layer_actions.delLayer(i,s),this.user_context.user_layers.setActiveLayer(a.index_layer),r.layer_actions.clearCanvasAction(i,a.index_layer),r.layer_actions.drawCanvasAction(i,a.index_layer,a.image_layer);break;case this.DIRECTION_REPEAT:r.layer_actions.actionNewLayer(i,s,Object.assign({},c)),r.list_layers.movePositionUserLayer(i,s,o),r.layer_actions.clearCanvasAction(i,s),r.layer_actions.drawCanvasAction(i,s,l),r.layer_actions.clearCanvasAction(i,a.index_layer),r.layer_actions.drawCanvasAction(i,a.index_layer,a.image_layer)}},ke.prototype.actionLockLayer=function(t,e){var i,r=this.user_context.getIdUser(),a=this.parent_context,n=t.index_layer,s=t.is_lock;switch(e){case this.DIRECTION_ABORT:i=!s;break;case this.DIRECTION_REPEAT:i=s}a.layer_actions.lockLayer(r,n,i)},ke.prototype.actionMaskLayer=function(t,e){var i,r=this.user_context.getIdUser(),a=this.parent_context,n=t.index_layer,s=t.is_mask;switch(e){case this.DIRECTION_ABORT:i=!s;break;case this.DIRECTION_REPEAT:i=s}a.layer_actions.maskLayer(r,n,i)};var we=function(){function t(e){var i=e.main_context,r=e.user_context;l(this,t),this.main_context=i,this.user_context=r}return _(t,[{key:"init",value:function(){var t=this,e=this.user_context.user_events;e.listener(w,(function(){t.abortHistory()})),e.listener(C,(function(){t.repeatHistory()}))}},{key:"abortHistory",value:function(){var t=this.user_context.states_history.abort();return this.actionsMoveHistory(),t}},{key:"repeatHistory",value:function(){var t=this.user_context.states_history.repeat();return this.actionsMoveHistory(),t}},{key:"actionsMoveHistory",value:function(){var t=this.user_context.getIdUser(),e=this.user_context.user_layers.getActiveIndexLayer();this.main_context.layer_actions.savePreviewLayer(t,e),this.main_context.local_save_canvas&&this.main_context.local_save_canvas.timeoutSave()}},{key:"saveHistory",value:function(){var t=this.user_context.states_history.STATE_DRAW;this.user_context.states_history.save(t,null),this.main_context.local_save_canvas&&this.main_context.local_save_canvas.timeoutSave(),this.user_context.checkMyUser()&&this.main_context.saveCurrentLayer&&this.main_context.saveCurrentLayer()}},{key:"saveHistoryLayer",value:function(t){if(!this.main_context.lock_history_layer){var e=this.user_context.states_history.STATE_LAYER;this.user_context.states_history.save(e,t),this.main_context.local_save_canvas&&this.main_context.local_save_canvas.timeoutSave()}}}]),t}(),Ce=function(){function t(e){var i=e.user_context,r=e.main_context;l(this,t),this.user_context=i,this.main_context=r}return _(t,[{key:"init",value:function(){var t=this,e=this.user_context.user_events,i=this.user_context.getIdUser();e.listener(k,(function(){t.main_context.layer_actions.savePreviewLayer(i,t.user_context.user_layers.getActiveIndexLayer())})),e.listener(S,(function(e,i){t.addLayer(e,i)})),e.listener(T,(function(e){t.delLayer(e)})),e.listener(E,(function(e){t.lockLayer(e)})),e.listener(I,(function(e){t.maskLayer(e)})),e.listener(O,(function(e){t.safeLayerDown(e)})),e.listener(M,(function(){t.safeLayers()})),e.listener(R,(function(e,i){t.copyLayer(e,i)})),e.listener(P,(function(e){t.clearLayer(e)})),e.listener(D,(function(e,i){t.clickVisibleLayer(e,i)})),e.listener(N,(function(e,i){t.clickActiveLayer(e,i)})),e.listener(z,(function(e){t.newPositionLayer(e)})),e.listener(B,(function(e,i,r){t.clickNewNameLayer(e,i,r)})),e.listener(U,(function(e,i,r){t.newConfigLayer(e,i,r)})),e.listener(H,(function(e,i,r){t.selectionCut(e,i,r)})),e.listener($,(function(e,i,r){t.selectionCopy(e,i,r)}))}},{key:"clickAddLayer",value:function(){var t=this.user_context.user_layers,e=t.getActiveIndexLayer(),i=t.incrementIndex();this.user_context.user_events.trigger(S,e,i)}},{key:"addLayer",value:function(t,e){var i=this.user_context.getIdUser(),r=this.main_context.layer_actions.newLayerWithName(i,e).name_layer;this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_ADD_LAYER,data_action:{index_layer:e,prev_index_layer:t,name_layer:r}})}},{key:"clickDelLayer",value:function(){var t=this.user_context.user_layers.getActiveIndexLayer();this.user_context.user_events.trigger(T,t)}},{key:"delLayer",value:function(t){var e=this.user_context.getIdUser(),i=this.main_context.layer_actions.delLayerAction(e,t);if(i){var r=i.next_index_layer,a=i.duplicate_layer;this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_DEL_LAYER,data_action:{next_index_layer:r,duplicate_layer:a}})}}},{key:"clickLockLayer",value:function(){var t=this.user_context.user_layers.getActiveIndexLayer();this.user_context.user_events.trigger(E,t)}},{key:"lockLayer",value:function(t){var e=this.user_context.getIdUser(),i=this.main_context.layer_actions.lockLayerAction(e,t);if(i){var r=i.is_lock;this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_LOCK_LAYER,data_action:{index_layer:t,is_lock:r}})}}},{key:"clickMaskLayer",value:function(){var t=this.user_context.user_layers.getActiveIndexLayer();this.user_context.user_events.trigger(I,t)}},{key:"maskLayer",value:function(t){var e=this.user_context.getIdUser(),i=this.main_context.layer_actions.maskLayerAction(e,t);if(i){var r=i.is_mask;this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_MASK_LAYER,data_action:{index_layer:t,is_mask:r}})}}},{key:"clickSafeLayerDown",value:function(){var t=this.user_context.user_layers.getActiveIndexLayer();this.user_context.user_events.trigger(O,t)}},{key:"safeLayerDown",value:function(t){var e=this.user_context.getIdUser(),i=this.main_context.layer_actions.safeLayerDownAction(e,t);if(i){var r=i.data_layers,a=i.positions_layers;this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_SAFE_LAYERS,data_action:{data_layers:r,positions_layers:a}})}}},{key:"clickSafeLayers",value:function(){this.user_context.user_events.trigger(M)}},{key:"safeLayers",value:function(){var t=this.user_context.getIdUser(),e=this.main_context.layer_actions.safeLayers(t);if(e){var i=e.data_layers,r=e.positions_layers;this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_SAFE_LAYERS,data_action:{data_layers:i,positions_layers:r}})}}},{key:"clickCopyLayer",value:function(){var t=this.user_context.user_layers,e=t.getActiveIndexLayer(),i=t.incrementIndex();this.user_context.user_events.trigger(R,e,i)}},{key:"copyLayer",value:function(t,e){var i=this.user_context.getIdUser(),r=this.main_context.layer_actions.copyLayerAction(i,t,e);if(r){var a=r.copy_layer;this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_COPY_LAYER,data_action:{index_layer:t,copy_layer:a}})}}},{key:"clickClearLayer",value:function(){var t=this.user_context.user_layers.getActiveIndexLayer();this.user_context.user_events.trigger(P,t)}},{key:"clearLayer",value:function(t){var e=this.user_context.getIdUser(),i=this.main_context.layer_actions.clearLayerAction(e,t);if(i){var r=i.layer;this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_CLEAR_LAYER,data_action:{index_layer:t,layer:r}})}}},{key:"clickVisibleLayer",value:function(t,e){var i=this.user_context.getIdUser();this.main_context.list_layers.changeParamsLayer(i,t,{hide:e}),this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_VISIBLE_LAYER,data_action:{index_layer:t,is_visible:e}})}},{key:"clickActiveLayer",value:function(t,e){t!=e&&(this.user_context.user_layers.setActiveLayer(e),this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_ACTIVE_LAYER,data_action:{index_layer:e,prev_index_layer:t}}))}},{key:"newPositionLayer",value:function(t){var e=t.index_layer,i=t.start_position_layer,r=t.end_position_layer,a=this.user_context.getIdUser();this.main_context.list_layers.movePositionLayer(a,e,r),this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_DND_LAYER,data_action:{index_layer:e,start_position:i,end_position:r}})}},{key:"clickNewNameLayer",value:function(t,e,i){var r=this.user_context.getIdUser();this.main_context.list_layers.changeParamsLayer(r,t,{name:e}),this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_NAME_LAYER,data_action:{index_layer:t,old_name:i,current_name:e}})}},{key:"newConfigLayer",value:function(t,e,i){var r=this.user_context.getIdUser(),a={};a[e]=i,this.main_context.list_layers.changeParamsLayer(r,t,a)}},{key:"clickSelectionCut",value:function(){var t=this.user_context.user_layers.getActiveIndexLayer(),e=this.user_context.events_draw.getSelectionPoints();if(e&&e.length){var i=this.user_context.user_layers.incrementIndex();this.user_context.user_events.trigger(H,t,i,e)}}},{key:"selectionCut",value:function(t,e,i){if(i&&i.length){var r=this.user_context.getIdUser(),a=this.main_context.layer_actions.selectionCutAction(r,t,e,i),n=a.duplicate_layer,s=a.duplicate_new_layer;this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_SELECTION_CUT_LAYER,data_action:{duplicate_layer:n,duplicate_new_layer:s}})}}},{key:"clickSelectionCopy",value:function(){var t=this.user_context.user_layers.getActiveIndexLayer(),e=this.user_context.events_draw.getSelectionPoints();if(e&&e.length){var i=this.user_context.user_layers.incrementIndex();this.user_context.user_events.trigger($,t,i,e)}}},{key:"selectionCopy",value:function(t,e,i){if(i&&i.length){var r=this.user_context.getIdUser(),a=this.main_context.layer_actions.selectionCopyAction(r,t,e,i),n=a.duplicate_layer,s=a.duplicate_new_layer;this.user_context.events_history.saveHistoryLayer({type_action:this.user_context.states_history.ACTION_SELECTION_COPY_LAYER,data_action:{duplicate_layer:n,duplicate_new_layer:s}})}}}]),t}(),be=function(){function t(e){var i=e.main_context,r=e.user_context;l(this,t),It(this,"active_index_layer",0),It(this,"increment_index",0),this.main_context=i,this.user_context=r,this.affect_active_layer=null}return _(t,[{key:"getActiveIndexLayer",value:function(){return this.active_index_layer}},{key:"setActiveLayer",value:function(t){this.active_index_layer=t,this.affect_active_layer&&this.affect_active_layer(t)}},{key:"getActiveLayer",value:function(){var t=this.user_context.getIdUser();return this.main_context.list_layers.getLayerOnId(t,this.active_index_layer)}},{key:"incrementIndex",value:function(){return++this.increment_index}},{key:"setIncrementIndex",value:function(t){this.increment_index=t}},{key:"affectActiveLayer",value:function(t){this.affect_active_layer=t}}]),t}(),Le=function(){function t(e){var i=e.id_user,r=e.main_context;l(this,t),It(this,"id_user",0),this.main_context=r,this.id_user=i,this.init()}return _(t,[{key:"init",value:function(){this.initUserEvents(),this.initEventsDraw(),this.initToolsDraw(),this.initStatesHistory(),this.initEventsHistory(),this.initEventsLayer(),this.initUserLayers()}},{key:"getIdUser",value:function(){return this.id_user}},{key:"initUserEvents",value:function(){this.user_events=new te}},{key:"initEventsDraw",value:function(){this.events_draw=new ee({main_context:this.main_context,user_context:this}),this.events_draw.init()}},{key:"initToolsDraw",value:function(){this.tools_draw=new xe({main_context:this.main_context,user_context:this}),this.tools_draw.initListTools(this.main_context.except_tools)}},{key:"initStatesHistory",value:function(){this.states_history=new ke({parent_context:this.main_context,user_context:this,max_states:this.main_context.max_states_history})}},{key:"initEventsHistory",value:function(){this.events_history=new we({main_context:this.main_context,user_context:this}),this.events_history.init()}},{key:"initEventsLayer",value:function(){this.events_layer=new Ce({user_context:this,main_context:this.main_context}),this.events_layer.init()}},{key:"initUserLayers",value:function(){var t=this;this.user_layers=new be({main_context:this.main_context,user_context:this}),this.user_layers.affectActiveLayer((function(e){t.checkMyUser()&&t.main_context.layer_list.activeLayerAction(e)}))}},{key:"checkMyUser",value:function(){return this.getIdUser()==this.main_context.users_canvas.getMyIdUser()}}]),t}(),Se=function(){function t(e){var i=e.main_context;l(this,t),It(this,"users",{}),It(this,"my_id_user",0),this.main_context=i}return _(t,[{key:"setMyIdUser",value:function(t){this.my_id_user=t}},{key:"getMyIdUser",value:function(){return this.my_id_user}},{key:"addUser",value:function(t){this.checkExistUser(t)||(this.users[t]=new Le({main_context:this.main_context,id_user:t}))}},{key:"checkExistUser",value:function(t){return!!this.users[t]}},{key:"getUser",value:function(t){return!!this.checkExistUser(t)&&this.users[t]}},{key:"getMyUser",value:function(){return this.getUser(this.my_id_user)}}]),t}();function Te(){this.init(),this.initHandlers()}Te.prototype.init=function(){this.initUserActions(),this.initDrawingArea(),this.initUsersCanvas(),this.initHotkeys(),this.initWorkCanvas(),this.initArtCanvas(),this.initListLayers(),this.initPanelLayers(),this.initLayerList(),this.initLayerActions(),this.initConfigLayers(),this.initBrushCursor(),this.initTransformCanvas(),this.initMenuDraw(),this.initColorPicker(),this.initPaletteColors(),this.initScrollbarCanvas(),this.initHistoryActions(),this.initConfigTools(),this.initialActions()},Te.prototype.initialActions=function(){this.users_canvas.setMyIdUser(this.id_user),this.users_canvas.addUser(this.id_user),this.drawing_area.init(),this.panel_layers&&this.panel_layers.init(),this.brush_cursor.init(),this.history_actions.init(),this.config_tools.init()},Te.prototype.initHandlers=function(){var t=this;this.handlersResize(),window.addEventListener("resize",(function(){t.timeoutWindowResize()})),document.addEventListener("keydown",(function(e){return e.ctrlKey&&e.shiftKey&&90===e.keyCode||e.ctrlKey&&89===e.keyCode?(e.preventDefault(),void t.user_actions.trigger(xt)):!e.ctrlKey||90!==e.keyCode||(e.preventDefault(),void t.user_actions.trigger(mt))})),window.onbeforeunload=function(t){t=t||window.event;var e=window.t("draw.tooltip_exit");return t&&(t.returnValue=e),e}},Te.prototype.timeoutWindowResize=function(){var t=this;clearTimeout(this.timeout_resize),this.timeout_resize=setTimeout((function(){t.actionWindowResize()}),500)},Te.prototype.actionWindowResize=function(){this.work_canvas.updateSizeCanvas(),this.transform_canvas.updateTransform()},Te.prototype.initUsersCanvas=function(){this.users_canvas=new Se({main_context:this})},Te.prototype.initDrawingArea=function(){var t=document.querySelector(".js--container-work-canvas");this.drawing_area=new Ct({main_context:this,$box:t})},Te.prototype.initUserActions=function(){this.user_actions=new Nt},Te.prototype.initHotkeys=function(){var t=this;document.addEventListener("keydown",(function(e){if(!e.target.tagName||!["input","textarea"].includes(e.target.tagName.toLowerCase())){var i=e.keyCode;66===i?t.config_tools.selectTool(nt):69===i?t.config_tools.selectTool(tt):80===i?t.config_tools.selectTool(ot):77===i?t.config_tools.selectTool(Y):83!==i||e.ctrlKey?76===i?t.config_tools.selectTool(Z):e.shiftKey&&84===i?t.config_tools.selectTool(J):e.ctrlKey&&68===i?t.hotkeyClearSelection(e):e.ctrlKey&&32===i?t.moveHotkeyTool(e,rt,i):32===i?t.moveHotkeyTool(e,Q,i):67!==i||e.ctrlKey?82===i?t.config_tools.selectTool(at):18===i?t.moveHotkeyTool(e,et,i):70===i?t.config_tools.selectTool(it):71===i?t.config_tools.selectTool(st):89===i?t.config_tools.selectTool(ct):74===i?t.config_tools.selectTool(lt):75===i?t.config_tools.selectTool(ht):85===i?t.config_tools.selectTool(ut):219!==i||e.shiftKey?221!==i||e.shiftKey?222===i?t.hotkeyOpacity(e,"down"):220===i?t.hotkeyOpacity(e,"up"):[49,50,51,52,53,54,55,56,57,48].includes(i)?t.hotkeyColor(i):219===i&&e.shiftKey?t.transform_canvas.clickRotateLeft():221===i&&e.shiftKey?t.transform_canvas.clickRotateRight():72===i&&t.transform_canvas.clickFlipHorizontally():t.hotkeySize("up"):t.hotkeySize("down"):t.config_tools.selectTool(X):t.config_tools.selectTool(G)}}))},Te.prototype.moveHotkeyTool=function(t,e,i){if(t.preventDefault(),!this.is_move_hotkey){var r=this.users_canvas.getMyUser(),a=r.tools_draw.getNameCurrentTool();if(this.user_actions.trigger(wt,{name_tool:e,is_hotkey:!0})){this.is_move_hotkey=!0,this.old_name_tool=a;var s=this;document.addEventListener("keyup",o),document.addEventListener("keydown",c),document.addEventListener("blur",l),document.addEventListener("visibilitychange",h)}}function o(e,a){if(a||s.is_move_hotkey&&e.keyCode===i){a||t.preventDefault();try{s.drawing_area.forceUp(),s.old_name_tool&&r.tools_draw.setCurTool({name_tool:s.old_name_tool,is_hotkey:!0})}catch(t){window.scriptError(t)}s.is_move_hotkey=!1,document.removeEventListener("keyup",o),document.removeEventListener("keydown",c),document.removeEventListener("blur",l),document.removeEventListener("visibilitychange",h),(0,n._M)(document,"move",(function(){}),!0)}}function c(t){s.is_move_hotkey&&t.keyCode!==i&&o(t,!0)}function l(t){o(t,!0)}function h(t){o(t,!0)}},Te.prototype.hotkeySize=function(t){var e=this.users_canvas.getMyUser(),i=e.tools_draw.getTool();if(i.values&&i.values.line_width){var r,a=i.values.line_width;r=a>=40&&"up"===t||a>40&&"down"===t?10:a>=20&&"up"===t||a>20&&"down"===t?5:a>=10&&"up"===t||a>10&&"down"===t?2:1,"down"===t&&(r*=-1),a+=r,this.config_tools.selectValueTool(e.tools_draw.getNameCurrentTool(),"line_width",a),this.updateArtCanvas()}},Te.prototype.hotkeyOpacity=function(t,e){t.preventDefault();var i=this.users_canvas.getMyUser(),r=i.tools_draw.getTool();if(r.values&&r.values.opacity){var a,n=r.values.opacity;a=n>=40&&"up"===e||n>40&&"down"===e?10:n>=20&&"up"===e||n>20&&"down"===e?5:n>=10&&"up"===e||n>10&&"down"===e?2:1,"down"===e&&(a*=-1),n+=a,this.config_tools.selectValueTool(i.tools_draw.getNameCurrentTool(),"opacity",n)}},Te.prototype.hotkeyColor=function(t){var e=[49,50,51,52,53,54,55,56,57,48].indexOf(t);if(-1!==e){var i=this.palette_colors.getOneColor(e);i&&this.color_picker.setColorRgb(i)}},Te.prototype.hotkeyClearSelection=function(t){t&&t.preventDefault(),this.users_canvas.getMyUser().user_events.trigger(b),this.updateArtCanvas()},Te.prototype.initListLayers=function(){var t=this;this.list_layers=new d,this.list_layers.affectLayers((function(){var e=t.list_layers.getLayers();t.layer_list.renderListLayers(e),t.updateArtCanvas()})),this.list_layers.affectParamsLayer((function(e,i){t.layer_list.renderParamsLayer(e,i),t.updateArtCanvas()}))},Te.prototype.initPanelLayers=function(){var t=document.querySelector(".js--panel-layers");this.panel_layers=new K({main_context:this,$panel:t})},Te.prototype.initLayerList=function(){var t=document.querySelector(".js--layer-list");this.layer_list=new W({main_context:this,$box:t,list_layers:this.list_layers})},Te.prototype.initLayerActions=function(){var t=this;this.layer_actions=new yt({main_context:this,list_layers:this.list_layers,handlers:{getSizeCanvas:function(){return t.getSizeCanvas()}}})},Te.prototype.initConfigLayers=function(){var t=document.querySelector(".js--config-layers");this.config_layers=new dt({main_context:this,$box:t})},Te.prototype.initTransformCanvas=function(){this.transform_canvas=new gt({main_context:this}),this.transform_canvas.init()},Te.prototype.initColorPicker=function(){var t=this,e=document.querySelector(".colorpicker");this.color_picker=new v(this,e),this.color_picker.affectColor((function(){var e=t.color_picker.getCurrentRgb();t.config_tools.setColor("".concat(e.r,", ").concat(e.g,", ").concat(e.b))}))},Te.prototype.transformCoords=function(t){if(!t)return{};var e=this.realCoords(t);return(e=this.transform_canvas.coordsToDocumentInt(e)).pressure=function(t){return"pen"!==t.pointerType?1:t.pressure}(t),e},Te.prototype.realCoords=function(t){var e=this.drawing_area.getContainerWork();return(0,n.Sz)(t,e)},Te.prototype.setCursorLayers=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.drawing_area&&this.drawing_area.getContainerWork().setAttribute("data-cursor",t)},Te.prototype.getDataLayers=i(a().mark((function t(){var e,i,r,n,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e={list_layers:[],w_canvas:this.width_canvas,h_canvas:this.height_canvas,id_user:this.id_user},i=this.list_layers.getLayers(),r=0;case 3:if(!(r<i.length)){t.next=12;break}return n=i[r],t.next=7,o(n.$layer);case 7:s=t.sent,e.list_layers.push({data_img:s,index:n.index,id_user:n.id_user,params:Object.assign({},n.params)});case 9:r++,t.next=3;break;case 12:return t.abrupt("return",e);case 13:case"end":return t.stop()}}),t,this)}))),Te.prototype.getJsonLayers=i(a().mark((function e(){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDataLayers();case 2:i=e.sent;try{i=JSON.stringify(i)}catch(e){i="",alert(t("draw.tooltip_error_save_layers"))}return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),Te.prototype.handlersResize=function(){var t=this;this.$resize_left_draw=document.getElementById("resize_left_draw"),this.$resize_right_draw=document.getElementById("resize_right_draw"),this.$toggle_left_draw=document.getElementById("toggle_left_draw"),this.$toggle_right_draw=document.getElementById("toggle_right_draw"),(0,n.aM)(this.$resize_left_draw,"down",(function(e){t.onResizeLeftDraw(e)})),(0,n.aM)(this.$resize_right_draw,"down",(function(e){t.onResizeRightDraw(e)})),this.$toggle_left_draw.addEventListener("click",(function(){t.toggleHiddenLeftDraw()})),this.$toggle_right_draw.addEventListener("click",(function(){t.toggleHiddenRightDraw()}))},Te.prototype.onResizeLeftDraw=function(t){this.mouseDownResizeBox(t,{$box:this.$left_draw,prop:"width",min_size:280,max_size:400,sign:-1,dependents:[{$box:this.$cont_layers,prop:"left",sign:-1,min_size:281,max_size:401},{$box:this.$bot_panel,prop:"left",sign:-1,min_size:281,max_size:401}]})},Te.prototype.onResizeRightDraw=function(t){this.mouseDownResizeBox(t,{$box:this.$right_draw,prop:"width",min_size:200,max_size:400,sign:1,dependents:[{$box:this.$cont_layers,prop:"right",sign:1,min_size:199,max_size:399},{$box:this.$bot_panel,prop:"right",sign:1,min_size:199,max_size:401}]})},Te.prototype.mouseDownResizeBox=function(t,e){var i=this;if(this.initResizeStartObj(t,e),e.dependents)for(var r=0;r<e.dependents.length;r++)this.initResizeStartObj(t,e.dependents[r]);document.onselectstart=function(){return!1},(0,n.aM)(document,"move",(function(t){i.mouseMoveResizeBox(t,e)}),!0),(0,n.aM)(document,"up",(function(t){i.mouseUpResizeBox(t,e)}),!0)},Te.prototype.initResizeStartObj=function(t,e){e.resize_start_coords=(0,n.Sz)(t,document.body),e.resize_start_obj=this.getResizeStartObj(e),e.$box.classList.add("no_transition")},Te.prototype.getResizeStartObj=function(t){var e={};switch(t.prop){case"width":e.start_size=t.$box.offsetWidth;var i=(s=window.getComputedStyle(t.$box,null)).getPropertyValue("border-left-width"),r=s.getPropertyValue("border-right-width");i&&(e.start_size=e.start_size-parseInt(i)),r&&(e.start_size=e.start_size-parseInt(r));break;case"height":e.start_size=t.$box.offsetHeight;var a=(s=window.getComputedStyle(t.$box,null)).getPropertyValue("border-top-width"),n=s.getPropertyValue("border-bottom-width");a&&(e.start_size=e.start_size-parseInt(a)),n&&(e.start_size=e.start_size-parseInt(n));break;default:var s,o=(s=window.getComputedStyle(t.$box,null)).getPropertyValue(t.prop);e.start_size=parseInt(o)}return e},Te.prototype.mouseMoveResizeBox=function(t,e,i){var r=(0,n.Sz)(t,document.body),a=this.getAxisProp(e.prop),s=e.sign&&1==e.sign?1:-1,o=0;switch(a){case"x":o=r.x-e.resize_start_coords.x;break;case"y":o=r.y-e.resize_start_coords.y}var c=e.resize_start_obj.start_size-s*o;if(void 0!==e.min_size&&c<e.min_size&&(c=e.min_size),void 0!==e.max_size&&c>e.max_size&&(c=e.max_size),e.$box.style[e.prop]=c+"px",e.dependents)for(var l=0;l<e.dependents.length;l++)this.mouseMoveResizeBox(t,e.dependents[l],!0);e.callback_move&&e.callback_move(o)},Te.prototype.getAxisProp=function(t){return-1!=["width","left","right"].indexOf(t)?"x":-1!=["height","top","bottom"].indexOf(t)?"y":""},Te.prototype.mouseUpResizeBox=function(t,e){e.callback_up&&e.callback_up(),e.$box.classList.remove("no_transition");for(var i=0;i<e.dependents.length;i++)e.dependents[i].$box.classList.remove("no_transition");this.actionWindowResize(),(0,n._M)(document,"move",(function(){}),!0),(0,n._M)(document,"up",(function(){}),!0),document.onselectstart=null},Te.prototype.toggleHiddenLeftDraw=function(){var t=this.$toggle_left_draw.classList.contains("is_hidden");this.$toggle_left_draw.classList.toggle("is_hidden",!t);var e=this.$left_draw.offsetWidth,i=t?0:-1*e,r=t?e:0;this.$left_draw.style.left=i+"px",this.$cont_layers.style.left=r+"px",this.$bot_panel.style.left=r+"px",this.actionWindowResize()},Te.prototype.toggleHiddenRightDraw=function(){var t=this.$toggle_right_draw.classList.contains("is_hidden");this.$toggle_right_draw.classList.toggle("is_hidden",!t);var e=this.$right_draw.offsetWidth,i=t?0:-1*e,r=t?e:0;this.$right_draw.style.right=i+"px",this.$cont_layers.style.right=r+"px",this.$bot_panel.style.right=r+"px",this.actionWindowResize()},Te.prototype.setKept=function(t){var e;try{e=JSON.parse(t)}catch(t){return}this.checkKeptUser(e.id_user)&&(this.list_layers.clearLayers(),e.w_canvas&&e.h_canvas&&(this.setSizeCanvas({width:e.w_canvas,height:e.h_canvas}),this.transform_canvas.init()),this.tmp_max_index=0,this.tmp_increment_index=0,this.setKeptOneLayer(e.list_layers,e.list_layers.length-1))},Te.prototype.checkKeptUser=function(t){return!t||0==t||t==this.id_user},Te.prototype.setKeptOneLayer=function(t,e){var i=this;if(e<0)this.endSetKept();else{var r=t[e],a=(r=this.reformConfigLayer(r)).id_user,n=r.index;if(this.users_canvas.checkExistUser(a)){this.layer_actions.actionNewLayer(a,n,{name:r.params.name}),this.list_layers.changeParamsLayer(a,n,Object.assign({},r.params));var s=this.users_canvas.getUser(a).user_layers.getActiveLayer();this.config_layers&&this.config_layers.setConfigLayer(n);var o=new Image;o.onload=function(){i.layer_actions.drawCanvas(s.ctx,o),setTimeout((function(){i.layer_actions.actionSavePreviewLayer(a,n)}),200),e--,i.setKeptOneLayer(t,e)},o.onerror=function(){e--,i.setKeptOneLayer(t,e)},o.src=t[e].data_img}else this.setKeptOneLayer(t,--e)}},Te.prototype.reformConfigLayer=function(t){return t.id_user&&0!=t.id_user||(t.id_user=this.id_user),t.index||(t.index=++this.tmp_increment_index),t.params||(t.params={},t.params.name=t.name_layer,t.params.hide=t.hide,t.params.opacity=t.opacity,t.params.is_lock=t.is_lock,t.params.is_mask=t.is_mask,t.params.blending=t.blending),t.index>this.tmp_max_index&&(this.tmp_max_index=t.index),t.params.name=t.params.name.replace(/\+/g," "),t},Te.prototype.endSetKept=function(){var t=this.users_canvas.getMyUser();t.states_history.clear(),t.user_layers.setIncrementIndex(this.tmp_max_index),t.events_history.saveHistory(),this.dialog_open&&this.dialog_open.hide(),this.updateArtCanvas()},Te.prototype.saveCanvasOnDisk=function(t){var e=document.createElement("canvas");e.width=this.width_canvas,e.height=this.height_canvas;var i=e.getContext("2d");this.fillWhiteBackground(i),i.drawImage(this.art_canvas.$canvas,0,0),window.open().document.write('<img src="'+e.toDataURL("image/png",1)+'" />')},Te.prototype.resizeCanvas=function(t){var e=t.crop_left,i=t.crop_top,r=t.width_canvas,a=t.height_canvas;r<this.min_width_canvas&&(r=this.min_width_canvas),r>this.max_width_canvas&&(r=this.max_width_canvas),a<this.min_height_canvas&&(a=this.min_height_canvas),a>this.max_height_canvas&&(a=this.max_height_canvas),this.setSizeCanvas({width:r,height:a});var n=[],s=this.list_layers.getLayers(),o=document.createElement("canvas"),c=o.getContext("2d");o.width=r,o.height=a;for(var l=0;l<s.length;l++){var h=s[l],u=new Image;u.src=h.$layer.toDataURL("image/png"),n.push({id_user:h.id_user,index_layer:h.index,image_layer:u}),c.clearRect(0,0,r,a),c.drawImage(h.$layer,e,i),h.$layer.width=r,h.$layer.height=a,h.ctx.drawImage(o,0,0,r,a),this.layer_actions.savePreviewLayer(h.id_user,h.index)}return this.updateArtCanvas(),n},Te.prototype.fillWhiteBackground=function(t){t.save(),t.beginPath(),t.fillStyle="rgb(255,255,255)",t.fillRect(0,0,this.width_canvas,this.height_canvas),t.closePath(),t.restore()},Te.prototype.getSizeCanvas=function(){return{width:this.width_canvas,height:this.height_canvas}},Te.prototype.setSizeCanvas=function(t){var e=t.width,i=t.height;this.width_canvas=e,this.height_canvas=i,this.art_canvas.setSizeCanvas({width:e,height:i})},Te.prototype.initWorkCanvas=function(){var t=document.querySelector(".js--work-canvas");this.work_canvas=new vt({main_context:this,$canvas:t})},Te.prototype.initArtCanvas=function(){this.art_canvas=new ft({size_canvas:this.getSizeCanvas()})},Te.prototype.updateArtCanvas=function(){this.work_canvas.render()},Te.prototype.initMenuDraw=function(){var t=document.querySelector(".js--menu-draw");this.menu_draw=new bt(this,t)},Te.prototype.initPaletteColors=function(){var t=document.querySelector(".js--palette-colors");this.palette_colors=new Rt({main_context:this,$box:t})},Te.prototype.initScrollbarCanvas=function(){var t=document.querySelector(".js--scrollbar-vertical"),e=document.querySelector(".js--scrollbar-horizontal");this.scrollbar_canvas=new Pt({main_context:this,$box_vertical:t,$box_horizontal:e})},Te.prototype.initBrushCursor=function(){this.brush_cursor=new Dt({main_context:this})},Te.prototype.initHistoryActions=function(){this.history_actions=new zt({main_context:this,$bot_panel:this.$bot_panel})},Te.prototype.initConfigTools=function(){this.config_tools=new Xt({main_context:this})};var Ee=function(t){St(o,t);var e,r,n,s=(r=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Et(r);if(n){var i=Et(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return Tt(this,t)});function o(t,e){var i;return l(this,o),(i=s.call(this)).parent_context=t,i.key_storage=e,i.id_kept=0,i.applyLocal(),i}return _(o,[{key:"setIdKept",value:function(t){this.id_kept=t,this.save()}},{key:"getData",value:(e=i(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.parent_context.getDataLayers();case 2:return(e=t.sent).id_kept=this.id_kept,t.abrupt("return",e);case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"setData",value:function(t){this.parent_context.id_kept=t.id_kept,this.parent_context.setKept(JSON.stringify(t))}}]),o}(Ot);function Ie(){this.$left_draw=document.querySelector(".js--left-draw"),this.$right_draw=document.querySelector(".js--right-draw"),this.$cont_layers=document.querySelector(".js--main-drawing-area"),this.$bot_panel=document.querySelector(".js--bottom-panel"),this.$btn_open=document.getElementById("btn_open"),this.$btn_save=document.getElementById("btn_save"),this.$save_ctrl_s=document.getElementById("save_ctrl_s"),this.$save_over=document.getElementById("save_over"),this.$canv_save=document.getElementById("canv_save"),this.$img_save=document.getElementById("img_save"),this.$comment_save=document.getElementById("comment_save"),this.$btn_save_kept=document.getElementById("btn_save_kept"),this.$btn_save_server=document.getElementById("btn_save_server"),this.$btn_reset_canvas=document.getElementById("btn_reset_canvas"),this.$save_disk=document.getElementById("save_disk"),this.$open_over=document.getElementById("open_over"),this.$list_kept=document.getElementById("list_kept"),this.$count_kept=document.querySelector(".js--count-kept"),this.$count_limit_kept=document.querySelector(".js--count-limit-kept"),this.id_user=window.id_user,this.is_privilege=window.is_privilege,this.except_tools=[],this.width_canvas=840,this.height_canvas=560,this.max_width_canvas=this.is_privilege?2400:1200,this.max_height_canvas=this.is_privilege?1800:900,this.min_width_canvas=400,this.min_height_canvas=400,this.id_kept=0,this.key_storage="pict",this.dialog_save=(0,n.ON)(this.$save_over.id,{width:400}),this.dialog_open=(0,n.ON)(this.$open_over.id,{width:610}),this.$ok_limits=document.querySelector(".js--ok-limits"),this.dialog_limits=(0,n.ON)("dialog-limits",{width:400}),this.$ok_limits_kept=document.querySelector(".js--ok-limits-kept"),this.dialog_limits_kept=(0,n.ON)("dialog-limits-kept",{width:400}),this.init()}(0,n.$)((function(){new Ie})),Ie.prototype=Object.create(Te.prototype),Ie.prototype.init=function(){Te.prototype.init.apply(this,arguments),this.initBrushTools(),this.initLayers(),this.initHandlers()},Ie.prototype.initBrushTools=function(){this.config_tools.selectTool(nt)},Ie.prototype.initHandlers=function(){Te.prototype.initHandlers.apply(this,arguments),this.handlersSave(),this.handlersDocument(),this.handlersLimits()},Ie.prototype.handlersSave=function(){var e=this,i=this;this.$btn_save.addEventListener("click",(function(){i.clickBtnSave()})),this.$btn_save_server&&this.$btn_save_server.addEventListener("click",(function(){i.clickSaveServer()})),this.$btn_save_kept&&(this.$btn_save_kept.addEventListener("click",(function(){i.clickSaveKept()})),this.$btn_open.addEventListener("click",(function(){i.openKept()})),this.$list_kept.addEventListener("click",(function(e){e.preventDefault();for(var r=e.target;r!=this;){if(r.classList.contains("del_kept"))return confirm(t("draw.kept_confirm_del"))&&i.delKept(r),!1;if(r.classList.contains("preview_kept"))return i.clickKept(r),!1;r=r.parentNode}}))),this.$btn_reset_canvas&&this.$btn_reset_canvas.addEventListener("click",(function(){e.menu_draw.clickMenuPictureNew()}))},Ie.prototype.handlersDocument=function(){var t=this;document.addEventListener("keydown",(function(e){return 83===e.keyCode&&e.ctrlKey&&(e.preventDefault(),t.clickSaveKept(!0)),!0}))},Ie.prototype.handlersLimits=function(){var t=this;this.$ok_limits.addEventListener("click",(function(){t.dialog_limits.hide()})),this.$ok_limits_kept.addEventListener("click",(function(){t.dialog_limits_kept.hide()}))},Ie.prototype.initLayers=function(){this.users_canvas.getMyUser().events_layer.clickAddLayer(),this.local_save_canvas=new Ee(this,this.key_storage)},Ie.prototype.clickBtnSave=function(){this.dialog_save.show(),this.$img_save.style.display="none",this.savePreviewImg(),this.$img_save.style.display="block"},Ie.prototype.savePreviewImg=function(){this.$canv_save.width=this.width_canvas,this.$canv_save.height=this.height_canvas;var t=this.$canv_save.getContext("2d");this.fillWhiteBackground(t),t.drawImage(this.art_canvas.$canvas,0,0);var e=this.$img_save.getElementsByTagName("img")[0],i=this.$canv_save.toDataURL("image/png",1);e.src=i,this.$save_disk.setAttribute("href",i)},Ie.prototype.clickSaveServer=function(){var e=this;if(!this.$btn_save_server.classList.contains("disable_btn")&&!this.cur_save_server){this.cur_save_server=!0;var i=this.$btn_save_server.innerHTML;this.$btn_save_server.innerHTML=t("draw.save_publishing"),this.$btn_save_server.classList.add("disable_btn");var r=this.$save_disk.getAttribute("href"),a=this.$comment_save.value;(0,n.hj)({url:"draw?save=picture",data:{data_img:r,comment:a,id_kept:this.id_kept},complete:function(r){try{"true"==(r=JSON.parse(r)).result?(e.local_save_canvas&&e.local_save_canvas.clear(),window.onbeforeunload=void 0,window.location.href=r.redirect_url):(e.$btn_save_server.innerHTML=i,e.$btn_save_server.classList.remove("disable_btn"),r.limits?e.showDialogLimits(r.limits):alert(r.error))}catch(r){e.$btn_save_server.innerHTML=i,e.$btn_save_server.classList.remove("disable_btn"),alert(t("draw.tooltip_error_save"))}},error:function(){e.$btn_save_server.innerHTML=i,e.$btn_save_server.classList.remove("disable_btn"),alert(t("draw.tooltip_error_save"))},always:function(){e.cur_save_server=!1}})}},Ie.prototype.clickSaveKept=function(){var e=i(a().mark((function e(i){var r,s,o,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this,this.$btn_save_kept&&!this.$btn_save_kept.classList.contains("disable_btn")&&!this.cur_save_server){e.next=3;break}return e.abrupt("return");case 3:return this.cur_save_server=!0,s=this.$btn_save_kept.innerHTML,this.$btn_save_kept.innerHTML=t("draw.kept_saving"),this.$btn_save_kept.classList.add("disable_btn"),i&&(this.savePreviewImg(),this.$save_ctrl_s.innerHTML=t("draw.kept_saving"),this.$save_ctrl_s.style.display="inline-block",clearTimeout(this.timeout_ctrl_s)),e.next=10,this.getJsonLayers();case 10:o=e.sent,c=this.$save_disk.getAttribute("href"),(0,n.hj)({url:"draw?save=kept",data:"json_layers="+o+"&preview_img="+c+"&id_kept="+this.id_kept,complete:function(e){try{"true"==(e=JSON.parse(e)).result?(0==r.id_kept&&(r.id_kept=e.id_kept,r.local_save_canvas&&r.local_save_canvas.setIdKept(e.id_kept)),i&&(r.$save_ctrl_s.innerHTML=t("draw.kept_saved")),r.dialog_save.hide()):"true"==e.limits_kept?r.dialog_limits_kept.show():alert(e.error)}catch(e){alert(t("draw.tooltip_error_save"))}i&&(r.timeout_ctrl_s=setTimeout((function(){r.$save_ctrl_s.style.display="none"}),2e3))},error:function(){alert(t("draw.tooltip_error_save"))},always:function(){r.cur_save_server=!1,r.$btn_save_kept.innerHTML=s,r.$btn_save_kept.classList.remove("disable_btn")}});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),Ie.prototype.openKept=function(){var e=this;this.cur_load_kept||(this.cur_load_kept=!0,this.dialog_open.show(),this.dialog_open.loading(!0),(0,n.hj)({url:"draw?get=kept",data:"",complete:function(i){e.cur_load_kept=!1;try{"true"==(i=JSON.parse(i)).result?(e.$list_kept.innerHTML=i.list,e.$count_kept.innerHTML=i.count_kept,e.$count_limit_kept.innerHTML=i.count_limit_kept,e.dialog_open.loading(!1)):alert(i.error)}catch(e){alert(t("draw.tooltip_error_request"))}}}))},Ie.prototype.clickKept=function(e){var i=this;if(!this.cur_load_kept){this.cur_load_kept=!0;var r=e.parentNode.getAttribute("data-id");this.dialog_open.loading(!0),(0,n.hj)({url:"draw?get=lnt",data:"id_kept="+r,complete:function(e){i.cur_load_kept=!1;try{"true"==(e=JSON.parse(e)).result?(i.id_kept=e.id_kept,i.setKept(e.json_kept),i.local_save_canvas&&i.local_save_canvas.setIdKept(i.id_kept)):alert(e.error)}catch(e){alert(t("draw.tooltip_error_request")+e.message)}}})}},Ie.prototype.delKept=function(e){var i=this;if(!this.cur_load_kept){this.cur_load_kept=!0;var r=e.parentNode.parentNode,a=r.getAttribute("data-id");(0,n.hj)({url:"draw?del=kept",data:"id_kept="+a,complete:function(e){i.cur_load_kept=!1;try{"true"==(e=JSON.parse(e)).result?r.style.display="none":alert(e.error)}catch(e){alert(t("draw.tooltip_error_request")+e.message)}}})}},Ie.prototype.clickResetCanvas=function(){confirm(t("draw.confirm_reset_canvas"))&&(this.local_save_canvas&&this.local_save_canvas.clear(),this.id_kept=0,window.onbeforeunload=void 0,window.location.reload())},Ie.prototype.showDialogLimits=function(t){this.dialog_limits.show()}}()})();